{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Counselor Reports | CalmConnect</title>
  <link rel="icon" type="image/x-icon" href="{% static 'mentalhealth/img/favicon.png' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-color: #2ecc71;
      --primary-dark: #27ae60;
      --secondary-blue: #3498db;
      --secondary-blue-dark: #2980b9;
      --secondary-purple: #9b59b6;
      --secondary-purple-dark: #8e44ad;
      --secondary-orange: #e67e22;
      --secondary-orange-dark: #d35400;
      --secondary-red: #e74c3c;
      --secondary-red-dark: #c0392b;
      --text-dark: #2c3e50;
      --text-medium: #666;
      --text-light: #999;
      --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --bg-light: #f8f9fa;
      --border-light: #e9ecef;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      color: var(--text-dark);
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);

      line-height: 1.6;
    }

    /* Header Styles */
    header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .hdr {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1400px;
      margin: 0 auto;
    }

    .hdr-logo h2 {
      color: var(--primary-color);
      font-size: 1.8rem;
      font-weight: 700;
    }

    .hdr-btns {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .prfl-bell {
      position: relative;
      cursor: pointer;
    }

    .prfl-bell i {
      font-size: 1.3rem;
      color: var(--text-medium);
      transition: color 0.3s ease;
    }

    .prfl-bell:hover i {
      color: var(--primary-color);
    }

    .prfl-name h4 {
      color: #333;
      font-weight: 600;
    }

    .prfl-container img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid var(--primary-color);
      object-fit: cover;
    }

    /* Notification Styles */
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: var(--secondary-red);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
    }

    .notification-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 1rem;
      min-width: 300px;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      display: none;
      z-index: 1001;
      margin-top: 0.5rem;
    }

    .notification-dropdown a {
      display: block;
      padding: 0.8rem 1rem;
      color: var(--text-dark);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-bottom: 0.5rem;
    }

    .notification-dropdown a:hover {
      background: rgba(46, 204, 113, 0.1);
      color: var(--primary-color);
    }

    .notification-dropdown a:last-child {
      margin-bottom: 0;
    }

    /* Dashboard Layout */
    .reports-dashboard {
      display: flex;
      max-width: 1400px;
      margin: 0 auto;
      gap: 2rem;
      padding: 2rem;
      min-height: calc(100vh - 120px);
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .sidebar-logo h3 {
      color: var(--primary-color);
      font-size: 1.4rem;
      margin-bottom: 2rem;
      text-align: center;
      font-weight: 700;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .sidebar-nav a {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      padding: 1rem 1.2rem;
      border-radius: 12px;
      text-decoration: none;
      color: var(--text-medium);
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .sidebar-nav a:hover,
    .sidebar-nav a.active {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      transform: translateX(5px);
      box-shadow: 0 2px 10px rgba(46, 204, 113, 0.3);
    }

    .sidebar-nav a i {
      font-size: 1.2rem;
    }

    /* Main Content */
    .reports-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    /* Page Header */
    .page-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .page-title {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .page-title h1 {
      color: var(--text-dark);
      font-size: 2rem;
      font-weight: 700;
    }

    .page-title i {
      font-size: 2.5rem;
      color: var(--secondary-blue);
    }

    .header-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .btn {
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      font-size: 0.9rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
    }

    .btn-secondary {
      background: var(--bg-light);
      color: var(--text-medium);
      border: 1px solid var(--border-light);
    }

    .btn-secondary:hover {
      background: #e9ecef;
      color: var(--text-dark);
    }

    /* Statistics Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 2rem;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    }

    .stat-card.blue::before {
      background: linear-gradient(90deg, var(--secondary-blue), var(--secondary-blue-dark));
    }

    .stat-card.purple::before {
      background: linear-gradient(90deg, var(--secondary-purple), var(--secondary-purple-dark));
    }

    .stat-card.orange::before {
      background: linear-gradient(90deg, var(--secondary-orange), var(--secondary-orange-dark));
    }

    .stat-card.red::before {
      background: linear-gradient(90deg, var(--secondary-red), var(--secondary-red-dark));
    }

    .stat-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.8;
    }

    .stat-card.blue .stat-icon { color: var(--secondary-blue); }
    .stat-card.purple .stat-icon { color: var(--secondary-purple); }
    .stat-card.orange .stat-icon { color: var(--secondary-orange); }
    .stat-card.red .stat-icon { color: var(--secondary-red); }

    .stat-card h3 {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      color: var(--text-medium);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .stat-card .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 0.5rem;
    }

    .stat-card .stat-change {
      font-size: 0.85rem;
      font-weight: 500;
    }

    .stat-change.positive {
      color: var(--primary-color);
    }

    .stat-change.negative {
      color: var(--secondary-red);
    }

    /* Filters Section */
    .filters-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .filters-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .filters-header h3 {
      color: var(--text-dark);
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .filter-group label {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-medium);
    }

    .filter-input {
      padding: 0.75rem;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .filter-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
    }

    .filter-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    /* Reports Table */
    .reports-table-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .table-header {
      padding: 2rem;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .table-header h3 {
      color: var(--text-dark);
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .table-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .search-box {
      position: relative;
    }

    .search-box input {
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      width: 250px;
      font-size: 0.9rem;
    }

    .search-box i {
      position: absolute;
      left: 0.8rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
    }

    .reports-table {
      width: 100%;
      border-collapse: collapse;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-medium);
    }

    .empty-state i {
      font-size: 4rem;
      color: var(--text-light);
      margin-bottom: 1rem;
    }

    .empty-state h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--text-dark);
    }

    .empty-state p {
      font-size: 1rem;
      color: var(--text-medium);
    }

    .no-reports {
      text-align: center;
    }

    .reports-table thead {
      background: var(--bg-light);
    }

    .reports-table th {
      padding: 1.2rem;
      text-align: left;
      font-weight: 600;
      color: var(--text-dark);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .reports-table td {
      padding: 1.2rem;
      border-bottom: 1px solid var(--border-light);
      vertical-align: middle;
    }

    .reports-table tbody tr {
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .reports-table tbody tr:hover {
      background: rgba(52, 152, 219, 0.05);
    }

    .report-type {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .report-type.assessment {
      background: rgba(52, 152, 219, 0.1);
      color: var(--secondary-blue);
    }

    .report-type.session {
      background: rgba(155, 89, 182, 0.1);
      color: var(--secondary-purple);
    }

    .report-type.urgent {
      background: rgba(231, 76, 60, 0.1);
      color: var(--secondary-red);
    }

    .report-type.progress {
      background: rgba(46, 204, 113, 0.1);
      color: var(--primary-color);
    }

    .priority-badge {
      padding: 0.3rem 0.8rem;
      border-radius: 15px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .priority-high {
      background: rgba(231, 76, 60, 0.1);
      color: var(--secondary-red);
    }

    .priority-medium {
      background: rgba(230, 126, 34, 0.1);
      color: var(--secondary-orange);
    }

    .priority-low {
      background: rgba(46, 204, 113, 0.1);
      color: var(--primary-color);
    }

    .status-badge {
      padding: 0.3rem 0.8rem;
      border-radius: 15px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .status-completed {
      background: rgba(46, 204, 113, 0.1);
      color: var(--primary-color);
    }

    .status-pending {
      background: rgba(230, 126, 34, 0.1);
      color: var(--secondary-orange);
    }

    .status-draft {
      background: rgba(149, 165, 166, 0.1);
      color: #7f8c8d;
    }

    .status-archived {
      background: rgba(52, 73, 94, 0.1);
      color: #34495e;
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .action-btn {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .action-btn.view {
      background: rgba(52, 152, 219, 0.1);
      color: var(--secondary-blue);
    }

    .action-btn.edit {
      background: rgba(230, 126, 34, 0.1);
      color: var(--secondary-orange);
    }

    .action-btn.delete {
      background: rgba(231, 76, 60, 0.1);
      color: var(--secondary-red);
    }

    .action-btn:hover {
      transform: scale(1.1);
    }

    /* Pagination */
    .pagination {
      padding: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid var(--border-light);
    }

    .pagination-info {
      color: var(--text-medium);
      font-size: 0.9rem;
    }

    .pagination-controls {
      display: flex;
      gap: 0.5rem;
    }

    .pagination-btn {
      width: 36px;
      height: 36px;
      border: 1px solid var(--border-light);
      background: white;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      color: var(--text-medium);
    }

    .pagination-btn:hover:not(.active) {
      background: var(--bg-light);
    }

    .pagination-btn.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 2.5rem;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-light);
    }

    .modal-header h2 {
      color: var(--text-dark);
      font-size: 1.5rem;
      font-weight: 600;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-light);
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .close-modal:hover {
      background: var(--bg-light);
      color: var(--text-dark);
    }

    .modal-body {
      color: var(--text-medium);
      line-height: 1.6;
    }

    .report-detail {
      margin-bottom: 1.5rem;
    }

    .report-detail h4 {
      color: var(--text-dark);
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .report-detail p {
      margin-bottom: 0.5rem;
    }

    .modal-actions {
      padding: 1.5rem;
      border-top: 1px solid var(--border-light);
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .modal-form {
      padding: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
    }

    .report-details {
      padding: 1.5rem;
    }

    .detail-group {
      margin-bottom: 1rem;
    }

    .detail-group label {
      font-weight: 600;
      color: var(--text-dark);
      display: block;
      margin-bottom: 0.25rem;
    }

    .detail-group span,
    .detail-group p {
      color: var(--text-medium);
    }

    .student-name {
      color: var(--text-light);
      font-size: 0.8rem;
      font-style: italic;
    }

    /* New styles for create report modal */
    .patient-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .patient-toggle label {
      margin-bottom: 0;
      cursor: pointer;
    }

    /* Enhanced Modal Styles */
    .enhanced-modal {
      max-width: 800px;
      width: 90vw;
      border-radius: 24px;
      box-shadow: 0 25px 80px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      animation: modalSlideIn 0.4s ease-out;
      /* Add scrollability */
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .enhanced-header {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      padding: 2.5rem 2rem;
      position: relative;
      border-bottom: 3px solid rgba(255, 255, 255, 0.1);
    }

    .header-content {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .header-icon {
      width: 65px;
      height: 65px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
      backdrop-filter: blur(10px);
    }

    .header-text h2 {
      margin: 0;
      font-size: 2.2rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .header-text p {
      margin: 0.5rem 0 0 0;
      opacity: 0.95;
      font-size: 1.1rem;
      font-weight: 300;
      line-height: 1.4;
    }

    .enhanced-close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .enhanced-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    .enhanced-form {
      padding: 2.5rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      /* Make form area scrollable if needed */
      overflow-y: auto;
      flex: 1 1 auto;
      min-height: 0;
    }

    .form-section {
      margin-bottom: 2.5rem;
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e8f5e8;
    }

    .section-header i {
      color: var(--primary-color);
      font-size: 1.2rem;
    }

    .section-header h3 {
      margin: 0;
      color: #2E7D32;
      font-size: 1.3rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .enhanced-group {
      margin-bottom: 1.5rem;
    }

    .enhanced-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-dark);
      font-size: 0.95rem;
    }

    .enhanced-label i {
      color: var(--primary-color);
      font-size: 1rem;
    }

    .select-wrapper {
      position: relative;
    }

    .enhanced-select {
      width: 100%;
      padding: 1rem 1.25rem;
      border: 2px solid #e0e0e0;
      border-radius: 16px;
      background: white;
      font-size: 1rem;
      transition: all 0.3s ease;
      appearance: none;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .enhanced-select:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.15);
      transform: translateY(-1px);
    }

    .select-arrow {
      position: absolute;
      right: 1.25rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-medium);
      pointer-events: none;
      transition: transform 0.3s ease;
    }

    .enhanced-select:focus + .select-arrow {
      transform: translateY(-50%) rotate(180deg);
    }

    .enhanced-input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--border-light);
      border-radius: 12px;
      background: white;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .enhanced-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
    }

    .enhanced-textarea {
      width: 100%;
      padding: 1.25rem;
      border: 2px solid #e0e0e0;
      border-radius: 16px;
      background: white;
      font-size: 1rem;
      transition: all 0.3s ease;
      resize: vertical;
      min-height: 140px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      line-height: 1.6;
    }

    .enhanced-textarea:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.15);
      transform: translateY(-1px);
    }

    .enhanced-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .no-students-notice {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem;
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      color: #856404;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }

    .no-students-notice i {
      color: #f39c12;
      font-size: 1.1rem;
    }

    .enhanced-actions {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      margin: 0 -2.5rem -2.5rem -2.5rem;
      padding: 2rem 2.5rem;
      border-top: 2px solid #e8f5e8;
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .enhanced-btn {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem 2rem;
      border-radius: 16px;
      font-weight: 700;
      font-size: 1rem;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .enhanced-btn i {
      font-size: 1rem;
    }

    .enhanced-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .enhanced-btn:active {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* Enhanced visual elements for better appeal */
    .enhanced-modal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #4CAF50, #66BB6A, #81C784, #A5D6A7);
      border-radius: 24px 24px 0 0;
    }

    .form-section:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      transition: all 0.3s ease;
    }

    .enhanced-label {
      position: relative;
    }

    .enhanced-label::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #4CAF50, #66BB6A);
      transition: width 0.3s ease;
    }

    .enhanced-label:focus-within::after {
      width: 100%;
    }

    /* --- Dropdown Styles from counselor-panel.html --- */
    .dropdown {
      position: relative;
    }
    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 1rem;
      min-width: 200px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      display: none;
      z-index: 1001;
    }
    .dropdown-menu a {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      padding: 0.5rem 0;
      color: var(--text-dark);
      text-decoration: none;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }
    .dropdown-menu a:hover {
      color: var(--primary-color);
      transform: translateX(3px);
    }
    .dropdown-menu a i {
      font-size: 1.1rem;
      width: 20px;
      text-align: center;
    }
    .divider {
      height: 1px;
      background: #eee;
      margin: 0.5rem 0;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .reports-dashboard {
        flex-direction: column;
        padding: 1rem;
      }

      .sidebar {
        width: 100%;
        position: static;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .filters-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .header-actions {
        width: 100%;
        justify-content: flex-start;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .sidebar-nav {
        flex-direction: row;
        overflow-x: auto;
        gap: 1rem;
        padding-bottom: 0.5rem;
      }

      .sidebar-nav a {
        white-space: nowrap;
      }

      .table-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .search-box input {
        width: 100%;
      }

      .reports-table-container {
        overflow-x: auto;
      }

      .reports-table {
        min-width: 800px;
      }

      .modal-content {
        margin: 1rem;
        padding: 1.5rem;
      }
    }
  </style>
  {% csrf_token %}
</head>
<body>
  <header>
    <div class="hdr">
      <div class="hdr-logo"><h2>CalmConnect</h2></div>
      <div class="hdr-btns">
        <div class="prfl-bell" id="notif-bell" aria-label="Notifications">
          <i class="bx bxs-bell" id="bell-icon"></i>
          <span class="notification-badge" id="notificationBadge" style="display:none;">0</span>
          <div class="notification-dropdown" id="notificationDropdown" style="display:none;"></div>
        </div>
        <div class="prfl-name"><h4>{{ counselor.name }}</h4></div>
        <div class="prfl-container dropdown">
          {% if counselor.image %}
            <img src="{{ counselor.image.url }}" alt="Profile picture of {{ counselor.name }}" id="profileDropdownToggle" />
          {% else %}
                            <img src="{% static 'mentalhealth/img/default.jpg' %}" alt="Default profile picture" id="profileDropdownToggle" />
          {% endif %}
          <div class="dropdown-menu" id="profileDropdown">
            <a href="{% url 'counselor_profile' %}"><i class="bx bxs-user-circle"></i> Profile</a>
            <a href="{% url 'update_schedule' %}"><i class="bx bxs-time"></i> Schedule</a>
            <div class="divider"></div>
            <a href="{% url 'logout' %}" id="logoutLink"><i class="bx bx-log-out"></i> Logout</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="reports-dashboard">
    <aside class="sidebar" aria-label="Counselor navigation">
      <div class="sidebar-logo"><h3>Counselor Panel</h3></div>
      <nav class="sidebar-nav">
        <a href="{% url 'counselor_dashboard' %}"><i class="bx bxs-dashboard"></i> Dashboard</a>
        <a href="{% url 'counselor_schedule' %}"><i class="bx bxs-calendar"></i> Schedule</a>
        <a href="{% url 'counselor_reports' %}" class="active" aria-current="page"><i class="bx bxs-report"></i> Reports</a>
        <a href="{% url 'counselor_archive' %}"><i class="bx bxs-archive"></i> Archive</a>
      </nav>
    </aside>

    <main class="reports-content">
      <!-- Page Header -->
      <section class="page-header">
        <div class="page-title">
          <i class="bx bxs-report"></i>
          <h1>Reports Dashboard</h1>
        </div>
        <div class="header-actions">
          <button class="btn btn-primary" id="createReportBtn">
            <i class="bx bxs-plus"></i>
            Create New Report
          </button>
          <button class="btn btn-secondary" id="exportReportsBtn">
            <i class="bx bxs-download"></i>
            Export Reports
          </button>
        </div>
      </section>

      <!-- Statistics Cards -->
      <section class="stats-grid" aria-label="Reports statistics">
        <div class="stat-card blue">
          <div class="stat-icon">
            <i class="bx bxs-file-doc"></i>
          </div>
          <h3>Total Reports</h3>
          <div class="stat-number">{{ total_reports }}</div>
          <div class="stat-change positive">All time</div>
        </div>
        <div class="stat-card purple">
          <div class="stat-icon">
            <i class="bx bxs-time-five"></i>
          </div>
          <h3>Pending Reviews</h3>
          <div class="stat-number">{{ pending_reports }}</div>
          <div class="stat-change negative">Requires attention</div>
        </div>
        <div class="stat-card orange">
          <div class="stat-icon">
            <i class="bx bxs-analyse"></i>
          </div>
          <h3>Completed This Month</h3>
          <div class="stat-number">{{ completed_this_month }}</div>
          <div class="stat-change positive">This month</div>
        </div>
        <div class="stat-card red">
          <div class="stat-icon">
            <i class="bx bxs-error-alt"></i>
          </div>
          <h3>Urgent Cases</h3>
          <div class="stat-number">{{ urgent_reports }}</div>
          <div class="stat-change">Requires attention</div>
        </div>
      </section>

      <!-- Filters Section -->
      <section class="filters-section">
        <div class="filters-header">
          <h3><i class="bx bxs-filter-alt"></i> Filter Reports</h3>
        </div>
        <div class="filters-grid">
          <div class="filter-group">
            <label for="reportType">Report Type</label>
            <select id="reportType" class="filter-input" name="report_type">
              <option value="">All Types</option>
              <option value="assessment" {% if filters.report_type == 'assessment' %}selected{% endif %}>Assessment</option>
              <option value="session" {% if filters.report_type == 'session' %}selected{% endif %}>Session Notes</option>
              <option value="urgent" {% if filters.report_type == 'urgent' %}selected{% endif %}>Urgent Report</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="dateRange">Date Range</label>
            <select id="dateRange" class="filter-input" name="date_range">
              <option value="">All Time</option>
              <option value="today" {% if filters.date_range == 'today' %}selected{% endif %}>Today</option>
              <option value="week" {% if filters.date_range == 'week' %}selected{% endif %}>This Week</option>
              <option value="month" {% if filters.date_range == 'month' %}selected{% endif %}>This Month</option>
              <option value="quarter" {% if filters.date_range == 'quarter' %}selected{% endif %}>This Quarter</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="status">Status</label>
            <select id="status" class="filter-input" name="status">
              <option value="">All Statuses</option>
              <option value="completed" {% if filters.status == 'completed' %}selected{% endif %}>Completed</option>
              <option value="pending" {% if filters.status == 'pending' %}selected{% endif %}>Pending</option>
              <option value="draft" {% if filters.status == 'draft' %}selected{% endif %}>Draft</option>
              <option value="archived" {% if filters.status == 'archived' %}selected{% endif %}>Archived</option>
            </select>
          </div>
        </div>
        <div class="filter-actions">
          <button class="btn btn-primary" id="applyFilters">
            <i class="bx bxs-search"></i>
            Apply Filters
          </button>
          <button class="btn btn-secondary" id="clearFilters">
            <i class="bx bxs-x"></i>
            Clear All
          </button>
        </div>
      </section>

      <!-- Reports Table -->
      <section class="reports-table-container">
        <div class="table-header">
          <h3><i class="bx bxs-data"></i> All Reports</h3>
          <div class="table-actions">
            <div class="search-box">
              <i class="bx bx-search"></i>
              <input type="text" placeholder="Search reports..." id="searchReports">
            </div>
          </div>
        </div>
        
        <table class="reports-table">
          <thead>
            <tr>
              <th>Title</th>
              <th>Report Type</th>
              <th>Date Created</th>
              <th>Status</th>
              <th>Last Modified</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if reports %}
              {% for report in reports %}
                <tr data-report-id="{{ report.id }}">
                  <td>
                    <div>
                      <strong>{{ report.title }}</strong>
                      {% if report.user %}
                        <br><small class="student-name">{{ report.user.full_name }}</small>
                      {% endif %}
                    </div>
                  </td>
                  <td>
                    <span class="report-type {{ report.report_type }}">
                      <i class="bx bxs-file-plus"></i> 
                      {{ report.get_report_type_display }}
                    </span>
                  </td>
                  <td>{{ report.created_at|date:"M d, Y" }}</td>
                  <td>
                    <span class="status-badge status-{{ report.status }}">
                      {{ report.get_status_display|default:report.status|title }}
                    </span>
                  </td>
                  <td>{{ report.updated_at|date:"M d, Y H:i" }}</td>
                  <td>
                    <div class="action-buttons">
                      <button class="action-btn view" onclick="viewReport({{ report.id }})" title="View Report">
                        <i class="bx bxs-show"></i>
                      </button>
                      <button class="action-btn edit" onclick="editReport({{ report.id }})" title="Edit Report">
                        <i class="bx bxs-edit"></i>
                      </button>
                      <button class="action-btn delete" onclick="deleteReport({{ report.id }})" title="Delete Report">
                        <i class="bx bxs-trash"></i>
                      </button>
                      <button class="action-btn" onclick="archiveReport({{ report.id }})" title="Archive Report">
                        <i class="bx bxs-archive"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="6" class="no-reports">
                  <div class="empty-state">
                    <i class="bx bxs-file-doc"></i>
                    <h3>No Reports Found</h3>
                    <p>You haven't created any reports yet. Click "Create New Report" to get started.</p>
                  </div>
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>

        <!-- Pagination -->
        {% if reports %}
          <div class="pagination">
            <div class="pagination-info">Showing {{ reports|length }} of {{ total_reports }} reports</div>
            <div class="pagination-controls">
              <!-- Simple pagination - can be enhanced later -->
              <button class="pagination-btn" disabled>
                <i class="bx bxs-chevron-left"></i>
              </button>
              <button class="pagination-btn active">1</button>
              <button class="pagination-btn" disabled>
                <i class="bx bxs-chevron-right"></i>
              </button>
            </div>
          </div>
        {% endif %}
      </section>
    </main>
  </div>

  <!-- Report Details Modal -->
  <div class="modal" id="reportModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Report Details</h2>
        <button class="close-modal" id="closeModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="report-detail">
          <h4>Report Information</h4>
          <p><strong>Type:</strong> <span class="report-type assessment">Assessment</span></p>
          <p><strong>Status:</strong> <span class="status-badge status-completed">Completed</span></p>
          <p><strong>Date Created:</strong> <span id="reportCreated"></span></p>
          <p><strong>Last Modified:</strong> <span id="reportUpdated"></span></p>
        </div>
        
        <div class="report-detail">
          <h4>Report Content</h4>
          <p id="reportDescription"></p>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary close-modal">Close</button>
        <button class="btn btn-primary" id="editReportBtn" style="display:none;">Edit</button>
        <button class="btn btn-secondary" id="archiveReportBtn" style="display:none;">Archive</button>
      </div>
    </div>
  </div>

  <!-- Create Report Modal -->
  <div id="createReportModal" class="modal">
    <div class="modal-content enhanced-modal">
      <div class="modal-header enhanced-header">
        <div class="header-content">
          <div class="header-icon">
            <i class="bx bxs-plus-circle"></i>
          </div>
          <div class="header-text">
            <h2>Create New Report</h2>
            <p>Fill in the details below to create a comprehensive report</p>
          </div>
        </div>
        <button class="close-modal enhanced-close" id="closeCreateModal">
          <i class="bx bx-x"></i>
        </button>
      </div>
      
      <form id="reportForm" class="modal-form enhanced-form">
        <div class="form-section">
          <div class="section-header">
            <i class="bx bxs-user-detail"></i>
            <h3>Student Information</h3>
          </div>
          <div class="form-group enhanced-group">
            <label for="student" class="enhanced-label">
              <i class="bx bxs-user"></i>
              Select Student
            </label>
            <div class="select-wrapper">
              <select id="student" name="student" required class="enhanced-select">
                <option value="">Choose a student from your appointments</option>
                {% for appointment in students_with_appointments %}
                  <option value="{{ appointment.user.id }}" data-student-name="{{ appointment.user.full_name }}">
                    {{ appointment.user.full_name }} ({{ appointment.user.student_id }}) - {{ appointment.get_status_display }}
                    {% if appointment.date %} [{{ appointment.date }}{% if appointment.time %} {{ appointment.time|time:'g:i A' }}{% endif %}]{% endif %}
                  </option>
                {% endfor %}
              </select>
              <i class="bx bxs-chevron-down select-arrow"></i>
            </div>
            {% if not students_with_appointments %}
              <div class="no-students-notice">
                <i class="bx bxs-info-circle"></i>
                <span>No students with appointments found. Students will appear here once they book appointments with you.</span>
              </div>
            {% endif %}
          </div>
        </div>

        <div class="form-section">
          <div class="section-header">
            <i class="bx bxs-file-doc"></i>
            <h3>Report Details</h3>
          </div>
          <div class="form-group enhanced-group">
            <label for="title" class="enhanced-label">
              <i class="bx bxs-edit"></i>
              Report Title
            </label>
            <input type="text" id="title" name="title" required placeholder="Enter a descriptive title for your report" class="enhanced-input">
          </div>
          
          <div class="form-group enhanced-group">
            <label for="description" class="enhanced-label">
              <i class="bx bxs-note"></i>
              Report Description
            </label>
            <textarea id="description" name="description" required placeholder="Provide detailed notes about the session, observations, and recommendations..." rows="5" class="enhanced-textarea"></textarea>
          </div>
        </div>

        <div class="form-section">
          <div class="section-header">
            <i class="bx bxs-cog"></i>
            <h3>Report Settings</h3>
          </div>
          <div class="form-row enhanced-row">
            <div class="form-group enhanced-group">
              <label for="report_type" class="enhanced-label">
                <i class="bx bxs-category"></i>
                Report Type
              </label>
              <div class="select-wrapper">
                <select id="report_type" name="report_type" required class="enhanced-select">
                  <option value="">Select report type</option>
                  <option value="assessment">📊 Assessment Report</option>
                  <option value="session">💬 Session Report</option>
                  <option value="urgent">⚠️ Urgent Report</option>
                </select>
                <i class="bx bxs-chevron-down select-arrow"></i>
              </div>
            </div>
            
            <div class="form-group enhanced-group">
              <label for="status" class="enhanced-label">
                <i class="bx bxs-time"></i>
                Status
                <small style="display: block; color: #666; font-weight: normal; margin-top: 0.2rem;">
                  All reports are automatically marked as completed
                </small>
              </label>
              <div class="select-wrapper">
                <select id="status" name="status" class="enhanced-select">
                  <option value="completed" selected>✅ Completed</option>
                  <option value="pending">⏳ Pending</option>
                  <option value="draft">📝 Draft</option>
                </select>
                <i class="bx bxs-chevron-down select-arrow"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-actions enhanced-actions">
          <button type="button" class="btn btn-secondary enhanced-btn" onclick="closeCreateModal()">
            <i class="bx bx-x"></i>
            Cancel
          </button>
          <button type="submit" class="btn btn-primary enhanced-btn">
            <i class="bx bxs-save"></i>
            Create Report
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal" id="confirmationModal">
    <div class="modal-content" style="max-width:400px;">
      <div class="modal-header">
        <h2>Report Created</h2>
        <button class="close-modal" id="closeConfirmationModal">&times;</button>
      </div>
      <div class="modal-body">
        <div style="text-align:center; padding:1rem 0 2rem;">
          <i class="bx bxs-check-circle" style="font-size:4rem; color:var(--primary-color);"></i>
          <h3 style="margin:1rem 0;">Report Successfully Created!</h3>
          <p id="confirmationMessage">Your report has been saved and is ready for review.</p>
        </div>
        <div class="filter-actions" style="justify-content:center;">
          <button class="btn btn-primary" id="viewNewReport">
            <i class="bx bxs-show"></i>
            View Report
          </button>
          <button class="btn btn-secondary" id="closeConfirmation">
            <i class="bx bxs-check"></i>
            Done
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Report Modal -->
  <div id="createReportModal" class="modal">
    <div class="modal-content enhanced-modal">
      <div class="modal-header enhanced-header">
        <div class="header-content">
          <div class="header-icon">
            <i class="bx bxs-plus-circle"></i>
          </div>
          <div class="header-text">
            <h2>Create New Report</h2>
            <p>Fill in the details below to create a comprehensive report</p>
          </div>
        </div>
        <button class="close-modal enhanced-close" id="closeCreateModal">
          <i class="bx bx-x"></i>
        </button>
      </div>
      
      <form id="reportForm" class="modal-form enhanced-form">
        <div class="form-section">
          <div class="section-header">
            <i class="bx bxs-user-detail"></i>
            <h3>Student Information</h3>
          </div>
          <div class="form-group enhanced-group">
            <label for="student" class="enhanced-label">
              <i class="bx bxs-user"></i>
              Select Student
            </label>
            <div class="select-wrapper">
              <select id="student" name="student" required class="enhanced-select">
                <option value="">Choose a student from your appointments</option>
                {% for appointment in students_with_appointments %}
                  <option value="{{ appointment.user.id }}" data-student-name="{{ appointment.user.full_name }}">
                    {{ appointment.user.full_name }} ({{ appointment.user.student_id }}) - {{ appointment.get_status_display }}
                    {% if appointment.date %} [{{ appointment.date }}{% if appointment.time %} {{ appointment.time|time:'g:i A' }}{% endif %}]{% endif %}
                  </option>
                {% endfor %}
              </select>
              <i class="bx bxs-chevron-down select-arrow"></i>
            </div>
            {% if not students_with_appointments %}
              <div class="no-students-notice">
                <i class="bx bxs-info-circle"></i>
                <span>No students with appointments found. Students will appear here once they book appointments with you.</span>
              </div>
            {% endif %}
          </div>
        </div>

        <div class="form-section">
          <div class="section-header">
            <i class="bx bxs-file-doc"></i>
            <h3>Report Details</h3>
          </div>
          <div class="form-group enhanced-group">
            <label for="title" class="enhanced-label">
              <i class="bx bxs-edit"></i>
              Report Title
            </label>
            <input type="text" id="title" name="title" required placeholder="Enter a descriptive title for your report" class="enhanced-input">
          </div>
          
          <div class="form-group enhanced-group">
            <label for="description" class="enhanced-label">
              <i class="bx bxs-note"></i>
              Report Description
            </label>
            <textarea id="description" name="description" required placeholder="Provide detailed notes about the session, observations, and recommendations..." rows="5" class="enhanced-textarea"></textarea>
          </div>
        </div>

        <div class="form-section">
          <div class="section-header">
            <i class="bx bxs-cog"></i>
            <h3>Report Settings</h3>
          </div>
          <div class="form-row enhanced-row">
            <div class="form-group enhanced-group">
              <label for="report_type" class="enhanced-label">
                <i class="bx bxs-category"></i>
                Report Type
              </label>
              <div class="select-wrapper">
                <select id="report_type" name="report_type" required class="enhanced-select">
                  <option value="">Select report type</option>
                  <option value="assessment">📊 Assessment Report</option>
                  <option value="session">💬 Session Report</option>
                  <option value="urgent">⚠️ Urgent Report</option>
                </select>
                <i class="bx bxs-chevron-down select-arrow"></i>
              </div>
            </div>
            
            <div class="form-group enhanced-group">
              <label for="status" class="enhanced-label">
                <i class="bx bxs-time"></i>
                Status
                <small style="display: block; color: #666; font-weight: normal; margin-top: 0.2rem;">
                  All reports are automatically marked as completed
                </small>
              </label>
              <div class="select-wrapper">
                <select id="status" name="status" class="enhanced-select">
                  <option value="completed" selected>✅ Completed</option>
                  <option value="pending">⏳ Pending</option>
                  <option value="draft">📝 Draft</option>
                </select>
                <i class="bx bxs-chevron-down select-arrow"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-actions enhanced-actions">
          <button type="button" class="btn btn-secondary enhanced-btn" onclick="closeCreateModal()">
            <i class="bx bx-x"></i>
            Cancel
          </button>
          <button type="submit" class="btn btn-primary enhanced-btn">
            <i class="bx bxs-save"></i>
            Create Report
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- View Report Modal -->
  <div id="reportModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="bx bxs-file-doc"></i> Report Details</h2>
        <button class="close-modal" id="closeModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="report-details">
          <div class="detail-group">
            <label>Title:</label>
            <span id="reportTitle"></span>
          </div>
          <div class="detail-group">
            <label>Student:</label>
            <span id="reportStudent"></span>
          </div>
          <div class="detail-group">
            <label>Type:</label>
            <span id="reportType"></span>
          </div>
          <div class="detail-group">
            <label>Status:</label>
            <span id="reportStatus"></span>
          </div>
          <div class="detail-group">
            <label>Created:</label>
            <span id="reportCreated"></span>
          </div>
          <div class="detail-group">
            <label>Last Updated:</label>
            <span id="reportUpdated"></span>
          </div>
          <div class="detail-group">
            <label>Description:</label>
            <p id="reportDescription"></p>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary close-modal">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Report CRUD operations
    function viewReport(reportId) {
      fetch(`/api/reports/${reportId}/`)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const report = data.report;
            document.getElementById('reportTitle').textContent = report.title;
            document.getElementById('reportStudent').textContent = report.user_name || 'Not specified';
            document.getElementById('reportType').textContent = report.report_type;
            document.getElementById('reportStatus').textContent = report.status;
            document.getElementById('reportCreated').textContent = report.created_at;
            document.getElementById('reportUpdated').textContent = report.updated_at;
            document.getElementById('reportDescription').textContent = report.description;
            // Show/hide archive/edit buttons
            const archiveBtn = document.getElementById('archiveReportBtn');
            const editBtn = document.getElementById('editReportBtn');
            if (report.status !== 'archived') {
              archiveBtn.style.display = 'inline-block';
              archiveBtn.onclick = function() { archiveReport(reportId); };
            } else {
              archiveBtn.style.display = 'none';
            }
            editBtn.style.display = 'inline-block';
            editBtn.onclick = function() { editReport(reportId); };
            const modal = document.getElementById('reportModal');
            modal.classList.add('active');
          } else {
            alert('Error loading report: ' + data.error);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error loading report');
        });
    }

    function editReport(reportId) {
      // Redirect to edit page or open edit modal
      window.location.href = `/reports/${reportId}/edit/`;
    }

    function deleteReport(reportId) {
      if (confirm('Are you sure you want to delete this report? This action cannot be undone.')) {
        fetch(`/api/reports/${reportId}/`, {
          method: 'DELETE',
          headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json',
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Remove the row from the table
            const row = document.querySelector(`tr[data-report-id="${reportId}"]`);
            if (row) {
              row.remove();
            }
            alert('Report deleted successfully');
            // Reload the page to update statistics
            location.reload();
          } else {
            alert('Error deleting report: ' + data.error);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error deleting report');
        });
      }
    }

    function archiveReport(reportId) {
      if (confirm('Are you sure you want to archive this report?')) {
        fetch(`/api/reports/${reportId}/`, {
          method: 'PUT',
          headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ status: 'archived' })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Report archived successfully!');
            location.reload();
          } else {
            alert('Error archiving report: ' + (data.error || data.message));
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error archiving report');
        });
      }
    }

    // Create new report
    function createReport() {
      const modal = document.getElementById('createReportModal');
      modal.classList.add('active');
    }

    function closeCreateModal() {
      const modal = document.getElementById('createReportModal');
      modal.classList.remove('active');
      document.getElementById('reportForm').reset();
    }

    // Submit new report form
    function submitReport(event) {
      event.preventDefault();
      
      const form = document.getElementById('reportForm');
      const formData = new FormData(form);
      
      const reportData = {
        user_id: formData.get('student'),
        title: formData.get('title'),
        description: formData.get('description'),
        report_type: formData.get('report_type'),
        status: formData.get('status') || 'completed'
      };

      fetch('/api/reports/', {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(reportData)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Report created successfully! All reports are automatically marked as completed.');
          closeCreateModal();
          location.reload();
        } else {
          alert('Error creating report: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error creating report');
      });
    }

    // Filter functionality
    function applyFilters() {
      const reportType = document.getElementById('reportType').value;
      const dateRange = document.getElementById('dateRange').value;
      const status = document.getElementById('status').value;
      const search = document.getElementById('searchReports').value;

      const params = new URLSearchParams();
      if (reportType) params.append('report_type', reportType);
      if (dateRange) params.append('date_range', dateRange);
      if (status) params.append('status', status);
      if (search) params.append('search', search);

      window.location.href = `{% url 'counselor_reports' %}?${params.toString()}`;
    }

    function clearFilters() {
      window.location.href = "{% url 'counselor_reports' %}";
    }

    // Export reports
    function exportReports() {
      const params = new URLSearchParams(window.location.search);
      window.open(`/api/reports/export/?${params.toString()}`, '_blank');
    }

    // Search functionality
    function searchReports() {
      const searchQuery = document.getElementById('searchReports').value;
      const params = new URLSearchParams(window.location.search);
      params.set('search', searchQuery);
      window.location.href = `{% url 'counselor_reports' %}?${params.toString()}`;
    }

    // Utility function to get CSRF token
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // Unified notification dropdown logic
    function showNotificationDropdown() {
        const dropdown = document.getElementById('notificationDropdown');
        dropdown.innerHTML = '<div style="text-align:center;padding:1.5rem 0;"><span class="ai-spinner" style="width:22px;height:22px;"></span> Loading...</div>';
        dropdown.style.display = 'block';
        
        fetch('/notifications/', {
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
            },
            credentials: 'same-origin'
        })
        .then(response => {
            if (!response.ok) {
                if (response.status === 401) {
                    window.location.href = '/login/';
                    return;
                }
                throw new Error(`HTTP ${response.status}`);
            }
            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
                window.location.href = '/login/';
                return;
            }
            return response.json();
        })
        .then(data => {
            dropdown.innerHTML = '';
            if (data.success && data.notifications && data.notifications.length > 0) {
                data.notifications.forEach(notif => {
                    const item = document.createElement('div');
                    item.className = 'notification-item';
                    item.style.cssText = 'display:flex;align-items:center;justify-content:space-between;padding:0.8rem;border-bottom:1px solid #eee;';
                    
                    const content = document.createElement('a');
                    content.href = notif.url;
                    content.style.cssText = 'flex:1;display:flex;align-items:center;gap:0.7rem;text-decoration:none;color:inherit;';
                    content.innerHTML = `
                        <i class='bx ${notif.type === 'appointment' ? 'bxs-calendar' : notif.type === 'report' ? 'bxs-report' : 'bxs-bell'}' style='color:#27ae60;font-size:1.2rem;'></i>
                        <span>${notif.message}</span>
                        <span style='margin-left:auto;font-size:0.85em;color:#888;'>${notif.time}</span>
                    `;
                    
                    const clearBtn = document.createElement('button');
                    clearBtn.innerHTML = '<i class="bx bx-x"></i>';
                    clearBtn.style.cssText = 'background:none;border:none;color:#e74c3c;cursor:pointer;padding:0.3rem;margin-left:0.5rem;font-size:1.1rem;';
                    clearBtn.title = 'Clear notification';
                    clearBtn.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        clearNotification(notif.id);
                    };
                    
                    item.appendChild(content);
                    item.appendChild(clearBtn);
                    dropdown.appendChild(item);
                });
                
                // Add clear all button
                const clearAllDiv = document.createElement('div');
                clearAllDiv.style.cssText = 'padding:0.8rem;border-top:2px solid #eee;text-align:center;';
                
                const clearAllBtn = document.createElement('button');
                clearAllBtn.innerHTML = '<i class="bx bx-trash"></i> Clear All';
                clearAllBtn.style.cssText = 'background:#e74c3c;color:white;border:none;padding:0.5rem 1rem;border-radius:4px;cursor:pointer;font-size:0.9rem;';
                clearAllBtn.onclick = function(e) {
                    e.preventDefault();
                    if (confirm('Clear all notifications?')) {
                        clearAllNotifications();
                    }
                };
                
                clearAllDiv.appendChild(clearAllBtn);
                dropdown.appendChild(clearAllDiv);
            } else {
                dropdown.innerHTML = '<div style="text-align:center;padding:2rem 0;color:#888;"><i class="bx bxs-bell" style="font-size:2.2rem;"></i><br>No notifications</div>';
            }
        })
        .catch((error) => {
            console.error('Notification error:', error);
            dropdown.innerHTML = '<div style="text-align:center;padding:2rem 0;color:#e74c3c;">Error loading notifications</div>';
        });
    }
    
    const bellIcon = document.getElementById('bell-icon');
    if (bellIcon) {
        bellIcon.addEventListener('click', function(e) {
            e.stopPropagation();
            const dropdown = document.getElementById('notificationDropdown');
            if (dropdown.style.display === 'block') {
                dropdown.style.display = 'none';
            } else {
                showNotificationDropdown();
            }
        });
    }
    
    document.addEventListener('click', function() {
        const notificationDropdown = document.getElementById('notificationDropdown');
        if (notificationDropdown) {
            notificationDropdown.style.display = 'none';
        }
    });

    // Function to clear individual notification
    function clearNotification(notificationId) {
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
        
        fetch(`/notifications/${notificationId}/clear/`, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': csrfToken
            },
            credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Refresh the notification dropdown
                showNotificationDropdown();
                // Update the badge
                updateNotificationBadge();
            } else {
                console.error('Error clearing notification:', data.error);
            }
        })
        .catch(error => {
            console.error('Error clearing notification:', error);
        });
    }

    // Function to clear all notifications
    function clearAllNotifications() {
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
        
        fetch('/notifications/clear-all/', {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': csrfToken
            },
            credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Refresh the notification dropdown
                showNotificationDropdown();
                // Update the badge
                updateNotificationBadge();
            } else {
                console.error('Error clearing all notifications:', data.error);
            }
        })
        .catch(error => {
            console.error('Error clearing all notifications:', error);
        });
    }

    // Function to update notification badge
    function updateNotificationBadge() {
        fetch('/notifications/', {
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
            },
            credentials: 'same-origin'
        })
        .then(response => {
            if (!response.ok) {
                return;
            }
            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
                return;
            }
            return response.json();
        })
        .then(data => {
            const badge = document.getElementById('notificationBadge');
            if (badge && data && data.count > 0) {
                badge.textContent = data.count;
                badge.style.display = 'flex';
            } else if (badge) {
                badge.style.display = 'none';
            }
        })
        .catch(error => {
            console.error('Error updating notification badge:', error);
        });
    }

    // Profile dropdown toggle
    const profileToggle = document.getElementById('profileDropdownToggle');
    const profileDropdown = document.getElementById('profileDropdown');
    profileToggle.addEventListener('click', function(e) {
      e.stopPropagation();
      profileDropdown.style.display = profileDropdown.style.display === 'block' ? 'none' : 'block';
    });
    document.addEventListener('click', function() {
      profileDropdown.style.display = 'none';
    });
    document.getElementById('logoutLink').addEventListener('click', function(e) {
      e.preventDefault();
      if (confirm('Are you sure you want to log out?')) {
        window.location.href = this.getAttribute('href');
      }
    });

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Create report button
      const createReportBtn = document.getElementById('createReportBtn');
      if (createReportBtn) {
        createReportBtn.addEventListener('click', createReport);
      }

      // Report form submission
      const reportForm = document.getElementById('reportForm');
      if (reportForm) {
        reportForm.addEventListener('submit', submitReport);
      }

      // Apply filters button
      const applyFiltersBtn = document.getElementById('applyFilters');
      if (applyFiltersBtn) {
        applyFiltersBtn.addEventListener('click', applyFilters);
      }

      // Clear filters button
      const clearFiltersBtn = document.getElementById('clearFilters');
      if (clearFiltersBtn) {
        clearFiltersBtn.addEventListener('click', clearFilters);
      }

      // Export reports button
      const exportReportsBtn = document.getElementById('exportReportsBtn');
      if (exportReportsBtn) {
        exportReportsBtn.addEventListener('click', exportReports);
      }

      // Search input
      const searchInput = document.getElementById('searchReports');
      if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            searchReports();
          }
        });
      }

      // Modal close buttons
      const closeButtons = document.querySelectorAll('.close-modal');
      closeButtons.forEach(button => {
        button.addEventListener('click', function() {
          const modal = this.closest('.modal');
          if (modal) {
            modal.classList.remove('active');
          }
        });
      });

      // Close modals when clicking outside
      window.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
          e.target.classList.remove('active');
        }
      });
    });
  </script>
</body>
</html>