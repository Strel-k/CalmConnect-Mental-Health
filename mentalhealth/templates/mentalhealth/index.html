{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css">
    <link rel="icon" type="image/x-icon" href="{% static 'mentalhealth/img/favicon.png' %}">

<link rel="stylesheet" href="{% static '/css/dass21-test.css' %}">

<!-- Include notification system -->
{% include 'mentalhealth/base_notifications.html' %}
    
 <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        min-height: 100vh;
    }

    /* Header Styles - Matching Admin Panel */
    header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding: 1rem 2rem;
        position: sticky;
        top: 0;
        z-index: 1000;
    }

    .hdr {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
    }

    .hdr-logo h2 {
        color: #2ecc71;
        font-size: 1.8rem;
        font-weight: 700;
    }

    .hdr-logo a {
        text-decoration: none;
    }

    .hdr-btns {
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }

    .prfl-bell {
        position: relative;
        cursor: pointer;
    }

    .prfl-bell i {
        font-size: 1.3rem;
        color: #666;
        transition: color 0.3s ease;
    }

    .prfl-bell:hover i {
        color: #2ecc71;
    }

    .prfl-name h4 {
        color: #333;
        font-weight: 600;
        text-transform: uppercase;
    }

    .prfl-container img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid #2ecc71;
    }

    /* Dropdown Styles */
    .dropdown {
        position: relative;
    }

    .dropdown-menu {
        position: absolute;
        top: 100%;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 1rem;
        min-width: 150px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        display: none;
        z-index: 1001;
    }

    .dropdown-menu a {
        display: block;
        padding: 0.5rem 0;
        color: #333;
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .dropdown-menu a:hover {
        color: #2ecc71;
    }

    /* Main Content */
    .main-bdy {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
    }

    /* Hero Section */
    .bdy-upper {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        text-align: center;
        padding: 3rem 2rem;
        border-radius: 20px;
        margin-bottom: 2rem;
        box-shadow: 0 15px 35px rgba(46, 204, 113, 0.3);
    }

    .upper-txt h2 {
        font-size: 2.8rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 0.5rem;
    }

    .upper-txt p {
        font-size: 1.2rem;
        font-weight: 400;
        opacity: 0.9;
    }

    /* Information Cards */
    .bdy-information {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .bdy-information > div {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 2.5rem;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .bdy-information > div::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #2ecc71, #27ae60);
    }

    .bdy-information > div:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .bdy-information h4 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #2c3e50;
    }

    .bdy-information img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin-bottom: 1.5rem;
        object-fit: cover;
    }

    .bdy-information p {
        color: #666;
        line-height: 1.6;
        font-size: 1rem;
    }

    /* Test Section */
    .dass21-test {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 3rem 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .test-title h2 {
        text-align: center;
        text-transform: uppercase;
        color: #2c3e50;
        font-size: 2rem;
        margin-bottom: 2rem;
        font-weight: 600;
    }

   .question-container {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        padding: 3rem 2rem;
        border-radius: 20px;
        max-width: 700px;
        margin: 0 auto;
        box-shadow: 0 10px 30px rgba(46, 204, 113, 0.1);
        border: 1px solid rgba(46, 204, 113, 0.2);
    }

       #question-text {
        font-size: 1.5rem;
        margin-bottom: 2.5rem;
        color: #2c3e50;
        line-height: 1.6;
        position: relative;
        padding-left: 2.5rem;
    }
    #question-text::before {
        content: "Q" counter(question-counter);
        counter-increment: question-counter;
        position: absolute;
        left: 0;
        top: 0;
        color: #2ecc71;
        font-weight: 700;
        font-size: 1.8rem;
    }
       .scale-options {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 2.5rem;
    }

     .scale-btn {
        background: white;
        color: #2c3e50;
        border: 2px solid #e9ecef;
        padding: 1.2rem 0.5rem;
        border-radius: 12px;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 80px;
    }

     .scale-btn:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(46, 204, 113, 0.15);
        border-color: #2ecc71;
    }

    .scale-btn:active {
        transform: translateY(0);
    }
     .scale-btn.selected {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        border-color: #27ae60;
        box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
    }

    .scale-btn .emoji {
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
    }

    .scale-btn .label {
        font-size: 0.9rem;
        margin-top: 0.3rem;
        opacity: 0.8;
    }
    .progress-container {
        background: rgba(46, 204, 113, 0.1);
        height: 12px;
        border-radius: 6px;
    }

    .progress-bar {
        background: linear-gradient(90deg, #2ecc71, #27ae60);
        height: 100%;
        border-radius: 6px;
        transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .progress-bar.pulse {
        animation: pulse 0.3s ease;
    }

    @keyframes pulse {
        0% { transform: scaleX(1); }
        50% { transform: scaleX(1.02); }
        100% { transform: scaleX(1); }
    }

    .mini-progress {
        display: flex;
        justify-content: center;
        margin-top: 1rem;
        gap: 5px;
    }

    .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: rgba(0, 0, 0, 0.2);
        transition: background-color 0.3s ease;
    }

    .dot.active {
        background-color: #2ecc71;
    }

    .question-progress {
        margin-top: 1rem;
    }

    .question-progress p {
        font-size: 1rem;
        color: #666;
        font-weight: 500;
    }

    /* Expert Validation Section */
    .expert-validation {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2.5rem;
        margin: 2rem 0;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .validation-title {
        text-align: center;
        margin-bottom: 1.5rem;
    }

    .validation-title h3 {
        color: #2c3e50;
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .validation-title .icon {
        font-size: 2rem;
        color: #2ecc71;
        margin-bottom: 0.5rem;
    }

    .validation-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .validation-card {
        background: rgba(233, 249, 241, 0.7);
        border-left: 4px solid #2ecc71;
        border-radius: 12px;
        padding: 1.5rem;
        transition: transform 0.3s ease;
    }

    .validation-card:hover {
        transform: translateY(-5px);
    }

    .validation-card h4 {
        color: #27ae60;
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.8rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .validation-card i {
        color: #2ecc71;
    }

    .validation-card p {
        color: #2c3e50;
        line-height: 1.6;
        font-size: 0.95rem;
    }

    .expert-endorsement {
        background: rgba(52, 152, 219, 0.1);
        border-left: 4px solid #3498db;
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        margin-top: 1.5rem;
    }

    .expert-endorsement h4 {
        color: #2980b9;
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.8rem;
    }

    .expert-endorsement p {
        color: #2c3e50;
        font-style: italic;
        line-height: 1.6;
    }

    .disclaimer {
        background: rgba(241, 196, 15, 0.1);
        border-left: 4px solid #f39c12;
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1.5rem;
        text-align: center;
    }

    .disclaimer p {
        color: #d68910;
        font-size: 0.9rem;
        font-weight: 500;
    }

    /* Mental Health Tips Section */
    .mental-health-tips {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2.5rem;
        margin: 2rem 0;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .tips-title {
        text-align: center;
        margin-bottom: 2rem;
    }

    .tips-title h3 {
        color: #2c3e50;
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .tips-title .icon {
        font-size: 2rem;
        color: #2ecc71;
        margin-bottom: 0.5rem;
    }

    .tips-content {
        max-width: 800px;
        margin: 0 auto;
    }

    .tips-list {
        list-style-type: none;
        counter-reset: tip-counter;
        padding: 0;
    }

    .tips-list li {
        background: rgba(46, 204, 113, 0.05);
        border-left: 4px solid #2ecc71;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
        position: relative;
        counter-increment: tip-counter;
    }

    .tips-list li::before {
        content: counter(tip-counter);
        position: absolute;
        left: -15px;
        top: 1.5rem;
        background: #2ecc71;
        color: white;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.9rem;
        box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
    }

    .tips-list li:hover {
        transform: translateX(10px);
        box-shadow: 0 8px 25px rgba(46, 204, 113, 0.15);
        background: rgba(46, 204, 113, 0.08);
    }

    .tips-list li strong {
        color: #27ae60;
        font-weight: 600;
        display: block;
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
    }

    .tips-list li p {
        color: #2c3e50;
        line-height: 1.6;
        margin: 0;
        font-size: 0.95rem;
    }

    /* Enhanced Results Section */
    .results-container {
        display: none;
        background: rgba(255, 255, 255, 0.98);
        border-radius: 20px;
        padding: 2.5rem;
        max-width: 1000px;
        margin: 2rem auto;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .results-header {
        text-align: center;
        margin-bottom: 2.5rem;
        position: relative;
    }

    .results-header h2 {
        color: #2c3e50;
        margin-bottom: 1rem;
        font-size: 2.2rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        position: relative;
        display: inline-block;
    }

    .results-header h2::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, #2ecc71, #27ae60);
        border-radius: 3px;
    }

    .results-header p {
        color: #7f8c8d;
        font-size: 1.1rem;
        max-width: 700px;
        margin: 0 auto;
        line-height: 1.6;
    }

    .encouragement-msg {
        background: rgba(233, 249, 241, 0.9);
        border-left: 4px solid #2ecc71;
        border-radius: 12px;
        padding: 1.2rem;
        margin: 2rem auto;
        font-style: italic;
        color: #2c3e50;
        font-size: 1rem;
        max-width: 700px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    /* Score Cards - Enhanced */
    .scores-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .score-card {
        background: white;
        border-radius: 16px;
        padding: 1.8rem 1.5rem;
        text-align: center;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border: none;
        position: relative;
        overflow: hidden;
    }

    .score-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: linear-gradient(90deg, var(--card-color), var(--card-color-dark));
    }

    .score-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
    }

    .score-card h3 {
        color: #2c3e50;
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
        padding-bottom: 0.8rem;
    }

    .score-card h3::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 2px;
        background: rgba(0, 0, 0, 0.1);
    }

    .score-card.depression {
        --card-color: #e74c3c;
        --card-color-dark: #c0392b;
    }

    .score-card.anxiety {
        --card-color: #f39c12;
        --card-color-dark: #e67e22;
    }

    .score-card.stress {
        --card-color: #9b59b6;
        --card-color-dark: #8e44ad;
    }

    /* Circular Progress - Enhanced */
    .circular-progress {
        position: relative;
        width: 130px;
        height: 130px;
        margin: 0 auto 1.2rem;
    }

    .circular-progress svg {
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
    }

    .progress-ring {
        fill: none;
        stroke: rgba(0, 0, 0, 0.08);
        stroke-width: 8;
    }

    .progress-ring-fill {
        fill: none;
        stroke-width: 8;
        stroke-linecap: round;
        stroke-dasharray: 314;
        stroke-dashoffset: 314;
        transition: stroke-dashoffset 1.5s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .depression .progress-ring-fill {
        stroke: url(#depressionGradient);
    }

    .anxiety .progress-ring-fill {
        stroke: url(#anxietyGradient);
    }

    .stress .progress-ring-fill {
        stroke: url(#stressGradient);
    }

    .score-display {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }

    .score-value {
        font-size: 2rem;
        font-weight: 700;
        color: #2c3e50;
        line-height: 1;
    }

    .score-max {
        font-size: 0.85rem;
        color: #95a5a6;
        font-weight: 500;
        margin-top: 0.2rem;
    }

    .score-interpretation {
        font-size: 0.9rem;
        color: white;
        background: var(--card-color);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        display: inline-block;
        margin: 0.8rem 0;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        min-width: 120px;
    }

    .severity-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .severity-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .severity-dot.active {
        background: var(--card-color);
        transform: scale(1.4);
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
    }

    /* Advice Card - Enhanced */
    .result-advice-card {
        background: rgba(46, 204, 113, 0.1);
        border-left: 4px solid #2ecc71;
        padding: 1.8rem;
        margin: 2.5rem auto;
        border-radius: 16px;
        font-size: 1.05rem;
        color: #2c3e50;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
        line-height: 1.7;
        transition: all 0.3s ease;
        max-width: 800px;
        position: relative;
        overflow: hidden;
    }

    .result-advice-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(to bottom, #2ecc71, #27ae60);
    }

    .result-advice-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        background: rgba(46, 204, 113, 0.15);
    }

    .result-advice-card strong {
        color: #27ae60;
        display: block;
        margin-bottom: 1rem;
        font-size: 1.1rem;
        font-weight: 600;
    }

    /* Resources Section - Enhanced */
    .resources-section {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 1px solid rgba(0, 0, 0, 0.05);
    }

    .resources-section h3 {
        color: #2c3e50;
        font-size: 1.5rem;
        margin-bottom: 2.5rem;
        text-align: center;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
    }

    .resources-section h3::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, #2ecc71, #27ae60);
        border-radius: 3px;
    }

    .resources-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.8rem;
        margin-bottom: 2rem;
    }

    .resource-card {
        background: white;
        padding: 2rem 1.5rem;
        border-radius: 16px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .resource-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #2ecc71, #27ae60);
    }

    .resource-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
    }

    .resource-card h4 {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 1.2rem;
        color: #2c3e50;
    }

    .resource-card img {
        width: 120px;
        height: 100px;
        margin-bottom: 1.5rem;
        object-fit: contain;
        filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.1));
    }

    .resource-card p {
        color: #666;
        margin-bottom: 1.5rem;
        font-size: 0.95rem;
        line-height: 1.6;
    }

    .resource-card a {
        display: inline-block;
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        padding: 0.8rem 1.5rem;
        border-radius: 12px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        font-size: 0.95rem;
        box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
    }

    .resource-card a:hover {
        background: linear-gradient(135deg, #27ae60, #229954);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);
    }

    /* Action Buttons - Enhanced */
    .action-buttons {
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        margin-top: 3rem;
    }

    .retake-btn, .save-btn {
        padding: 1rem 2.2rem;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .retake-btn {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
    }

    .save-btn {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
    }

    .retake-btn:hover, .save-btn:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    /* Exercises Modal Styles */
.exercises-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
}

.exercise-card {
    display: flex;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
}

.exercise-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
}

.exercise-image {
    width: 200px;
    height: 200px;
    object-fit: cover;
}

.exercise-info {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.exercise-info h3 {
    color: #2c3e50;
    margin-bottom: 0.5rem;
    font-size: 1.3rem;
}

.exercise-info p {
    color: #666;
    margin-bottom: 1rem;
    line-height: 1.6;
    flex-grow: 1;
}

.exercise-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
}

.start-btn {
    display: inline-block;
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
    padding: 0.7rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    font-size: 0.95rem;
}

.start-btn:hover {
    background: linear-gradient(135deg, #27ae60, #229954);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
}

.duration {
    color: #7f8c8d;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.duration i {
    font-size: 1rem;
}

@media (max-width: 768px) {
    .exercise-card {
        flex-direction: column;
    }
    
    .exercise-image {
        width: 100%;
        height: 150px;
    }
}
    /* Responsive Adjustments */
    @media (max-width: 900px) {
        .scores-grid, .resources-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        .score-card {
            padding: 1.8rem 1.5rem;
        }
        
        .result-advice-card {
            margin: 2rem 0;
            padding: 1.5rem;
        }
        
        .action-buttons {
            flex-direction: column;
            gap: 1rem;
        }
        
        .retake-btn, .save-btn {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }
    }

    @media (max-width: 500px) {
        .results-header h2 {
            font-size: 1.8rem;
        }
        
        .results-header p {
            font-size: 1rem;
        }
        
        .circular-progress {
            width: 110px;
            height: 110px;
        }
        
        .score-value {
            font-size: 1.8rem;
        }
        
        .resource-card {
            padding: 1.5rem 1.2rem;
        }
    }
      /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 20px;
            max-width: 800px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            color: #666;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: #e74c3c;
        }

        .modal-title {
            text-align: center;
            margin-bottom: 2rem;
            color: #2c3e50;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .support-groups-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .support-group-card {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .support-group-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }

        .group-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
        }

        .group-info {
            padding: 1.5rem;
            flex: 1;
        }

        .group-info h3 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-size: 1.3rem;
        }

        .group-info p {
            color: #666;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .group-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .group-meta span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .group-meta i {
            font-size: 1rem;
        }

        .join-btn {
            display: inline-block;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .join-btn:hover {
            background: linear-gradient(135deg, #27ae60, #229954);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        @media (max-width: 768px) {
            .modal-content {
                margin: 10% auto;
                width: 90%;
            }
            
            .support-group-card {
                flex-direction: column;
            }
            
            .group-image {
                width: 100%;
                height: 150px;
            }
        }
        /* Breathing Exercise Styles */
.breathing-container {
    width: 100%;
    margin-top: 1.5rem;
    text-align: center;
}

.breathing-circle {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    margin: 0 auto 1.5rem;
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 4s ease-in-out;
    box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
    position: relative;
    overflow: hidden;
}

.breathing-text {
    color: white;
    font-size: 1.5rem;
    font-weight: 600;
    z-index: 1;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.breathing-instructions {
    margin-bottom: 1.5rem;
    font-size: 1.1rem;
    color: #2c3e50;
    min-height: 3rem;
}

.breathing-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.pause-btn {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
    padding: 0.7rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    font-size: 0.95rem;
}

.pause-btn:hover {
    background: linear-gradient(135deg, #e67e22, #d35400);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3);
}

.breathing-progress {
    width: 100%;
    height: 8px;
    background: rgba(0,0,0,0.1);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 1rem;
}

.breathing-progress .progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #2ecc71, #27ae60);
    transition: width 0.1s linear;
}

/* Breathing animation */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.breathing-circle.breathing-in {
    animation: pulse 4s ease-in-out infinite;
    background: linear-gradient(135deg, #2ecc71, #27ae60);
}

.breathing-circle.breathing-out {
    animation: pulse 6s ease-in-out infinite;
    background: linear-gradient(135deg, #3498db, #2980b9);
}
/* EFT Tapping Styles */
.eft-container {
    width: 100%;
    margin-top: 1.5rem;
}

.eft-visual {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.eft-points {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    width: 40%;
}

.eft-point {
    padding: 0.8rem;
    background: rgba(46, 204, 113, 0.1);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    border-left: 3px solid #2ecc71;
    font-size: 0.95rem;
}

.eft-point.active {
    background: rgba(46, 204, 113, 0.3);
    font-weight: 600;
    transform: translateX(5px);
}

.eft-human {
    position: relative;
    width: 60%;
    height: 300px;
}

.eft-human img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.eft-highlight {
    position: absolute;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: rgba(231, 76, 60, 0.5);
    border: 2px solid #e74c3c;
    display: none;
    z-index: 10;
}

.eft-instructions {
    margin-bottom: 1.5rem;
    font-size: 1.1rem;
    color: #2c3e50;
    min-height: 3rem;
    text-align: center;
}

.eft-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.eft-progress {
    width: 100%;
    height: 8px;
    background: rgba(0,0,0,0.1);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 1rem;
}

.eft-progress .progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #2ecc71, #27ae60);
    transition: width 0.1s linear;
}
@keyframes pulse {
    0% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.2); }
    100% { transform: translate(-50%, -50%) scale(1); }
}
/* Responsive adjustments */
@media (max-width: 768px) {
    .eft-visual {
        flex-direction: column;
    }
    
    .eft-points, .eft-human {
        width: 100%;
    }
    
    .eft-human {
        height: 200px;
    }
}
.ai-feedback-loading {
    display: inline-flex;
    align-items: center;
    gap: 0.5em;
    color: #229954;
    font-weight: 500;
    font-size: 1.08em;
}
.ai-spinner {
    width: 18px;
    height: 18px;
    border: 3px solid #e5e5e5;
    border-top: 3px solid #27ae60;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    display: inline-block;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.notification-dropdown {
    position: absolute;
    right: 0;
    top: 100%;
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 8px 32px rgba(46,204,113,0.13), 0 1.5px 6px rgba(46,204,113,0.08);
    padding: 1.1rem 0.7rem 0.7rem 0.7rem;
    min-width: 320px;
    max-width: 360px;
    max-height: 420px;
    overflow-y: auto;
    z-index: 2000;
    border: 1.5px solid #e9f7ef;
    animation: fadeIn 0.3s cubic-bezier(.4,0,.2,1);
}
.notification-item {
    display: block;
    background: #f8f9fa;
    border-radius: 8px;
    margin-bottom: 0.7rem;
    padding: 0.85rem 1rem;
    color: #229954;
    text-decoration: none;
    transition: background 0.18s, box-shadow 0.18s;
    box-shadow: 0 1px 3px rgba(46,204,113,0.03);
}
.notification-item:hover {
    background: #e8f5e9;
    box-shadow: 0 2px 8px rgba(46,204,113,0.08);
}
.notification-badge {
    position: absolute;
    top: -7px;
    right: -7px;
    background: #e74c3c;
    color: #fff;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(231,76,60,0.13);
    border: 2px solid #fff;
}
.ai-spinner {
    width: 22px;
    height: 22px;
    border: 3px solid #e5e5e5;
    border-top: 3px solid #27ae60;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    display: inline-block;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-10px); }
}

/* Settings Modal Styles */
.settings-container {
    margin-bottom: 2rem;
}

.settings-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    border-left: 4px solid #2ecc71;
}

.settings-section h3 {
    color: #2c3e50;
    font-size: 1.3rem;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
}

.settings-section h3 i {
    color: #2ecc71;
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
}

.setting-item:last-child {
    border-bottom: none;
}

.setting-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex: 1;
}

.setting-label label {
    font-weight: 500;
    color: #2c3e50;
    cursor: pointer;
}

.setting-tooltip {
    background: #2ecc71;
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    cursor: help;
    transition: all 0.3s ease;
}

.setting-tooltip:hover {
    background: #27ae60;
    transform: scale(1.1);
}

.setting-select {
    padding: 0.5rem 1rem;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    background: white;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 120px;
}

.setting-select:focus {
    outline: none;
    border-color: #2ecc71;
    box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
}

/* Toggle Switch Styles */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
    cursor: pointer;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 24px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: #2ecc71;
}

input:checked + .toggle-slider:before {
    transform: translateX(26px);
}

/* Notification Settings */
.notification-settings {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.notification-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.frequency-select {
    padding: 0.4rem 0.8rem;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    background: white;
    font-size: 0.85rem;
    cursor: pointer;
    min-width: 80px;
}

/* Settings Actions */
.settings-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.action-buttons {
    display: flex;
    gap: 1rem;
}

.btn-primary, .btn-secondary {
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.btn-primary {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
    box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
}

.btn-primary:hover {
    background: linear-gradient(135deg, #27ae60, #229954);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.9);
    color: #2c3e50;
    border: 2px solid #e9ecef;
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 1);
    border-color: #2ecc71;
    transform: translateY(-2px);
}

/* Dark Mode Styles */
body.dark-mode {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    color: #e0e0e0;
}

body.dark-mode .settings-section {
    background: rgba(30, 30, 30, 0.95);
    border-left-color: #2ecc71;
}

body.dark-mode .setting-label label {
    color: #e0e0e0;
}

body.dark-mode .setting-select {
    background: #2d2d2d;
    border-color: #555;
    color: #e0e0e0;
}

body.dark-mode .frequency-select {
    background: #2d2d2d;
    border-color: #555;
    color: #e0e0e0;
}

body.dark-mode .btn-secondary {
    background: rgba(45, 45, 45, 0.9);
    color: #e0e0e0;
    border-color: #555;
}

/* Font Size Classes */
.font-small {
    font-size: 14px;
}

.font-medium {
    font-size: 16px;
}

.font-large {
    font-size: 18px;
}

.font-extra-large {
    font-size: 20px;
}

/* High Contrast Mode */
body.high-contrast {
    background: #000000;
    color: #ffffff;
}

body.high-contrast .settings-section {
    background: #000000;
    border: 2px solid #ffffff;
    border-left: 4px solid #00ff00;
}

body.high-contrast .setting-item {
    border-bottom-color: #ffffff;
}

body.high-contrast .setting-select,
body.high-contrast .frequency-select {
    background: #000000;
    border: 2px solid #ffffff;
    color: #ffffff;
}

body.high-contrast .toggle-slider {
    background-color: #666;
}

body.high-contrast input:checked + .toggle-slider {
    background-color: #00ff00;
}

/* Reduced Motion */
body.reduced-motion * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
}

/* Responsive Design */
@media (max-width: 768px) {
    .settings-container {
        padding: 0;
    }

    .settings-section {
        padding: 1rem;
        margin-bottom: 1.5rem;
    }

    .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }

    .notification-controls {
        width: 100%;
        justify-content: space-between;
    }

    .settings-actions {
        flex-direction: column;
        gap: 1rem;
    }

    .action-buttons {
        width: 100%;
        justify-content: space-between;
    }

    .btn-primary, .btn-secondary {
        flex: 1;
        max-width: none;
    }
}

/* Settings Modal Styles */
.settings-container {
    margin-bottom: 2rem;
}

.settings-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    border: 1px solid rgba(46, 204, 113, 0.2);
}

.settings-section-title {
    color: #2c3e50;
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.settings-section-title i {
    color: #2ecc71;
    font-size: 1.4rem;
}

.settings-group {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: rgba(46, 204, 113, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(46, 204, 113, 0.1);
    transition: all 0.3s ease;
}

.setting-item:hover {
    background: rgba(46, 204, 113, 0.08);
    border-color: rgba(46, 204, 113, 0.2);
}

.setting-label {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    flex: 1;
}

.setting-label label {
    font-weight: 600;
    color: #2c3e50;
    font-size: 1rem;
}

.setting-tooltip {
    background: #2ecc71;
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: bold;
    cursor: help;
    transition: all 0.3s ease;
}

.setting-tooltip:hover {
    background: #27ae60;
    transform: scale(1.1);
}

.setting-control {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.notification-control {
    flex-direction: column;
    align-items: flex-end;
    gap: 0.5rem;
}

.frequency-select {
    font-size: 0.85rem;
    padding: 0.4rem 0.8rem;
    min-width: 100px;
}

/* Toggle Switch Styles */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 24px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: #2ecc71;
}

input:checked + .toggle-slider:before {
    transform: translateX(26px);
}

.setting-select {
    padding: 0.5rem 1rem;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    background: white;
    font-size: 0.95rem;
    color: #2c3e50;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 120px;
}

.setting-select:focus {
    outline: none;
    border-color: #2ecc71;
    box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
}

.setting-select:hover {
    border-color: #2ecc71;
}

/* Settings Actions */
.settings-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.settings-main-actions {
    display: flex;
    gap: 1rem;
}

.settings-btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.settings-btn-primary {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
    box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
}

.settings-btn-primary:hover {
    background: linear-gradient(135deg, #27ae60, #229954);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
}

.settings-btn-secondary {
    background: rgba(255, 255, 255, 0.9);
    color: #2c3e50;
    border: 2px solid #e9ecef;
}

.settings-btn-secondary:hover {
    background: rgba(46, 204, 113, 0.1);
    border-color: #2ecc71;
    color: #27ae60;
}

/* Dark Mode Styles */
body.dark-mode {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    color: #e0e0e0;
}

body.dark-mode header {
    background: rgba(26, 26, 26, 0.95);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .hdr-logo h2 {
    color: #2ecc71;
}

body.dark-mode .prfl-name h4 {
    color: #e0e0e0;
}

body.dark-mode .dropdown-menu {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .dropdown-menu a {
    color: #e0e0e0;
}

body.dark-mode .dropdown-menu a:hover {
    color: #2ecc71;
}

body.dark-mode .bdy-upper {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
}

body.dark-mode .bdy-information > div {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .bdy-information h4 {
    color: #e0e0e0;
}

body.dark-mode .bdy-information p {
    color: #b0b0b0;
}

body.dark-mode .dass21-test {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .test-title h2 {
    color: #e0e0e0;
}

body.dark-mode .question-container {
    background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
    border: 1px solid rgba(46, 204, 113, 0.3);
}

body.dark-mode #question-text {
    color: #e0e0e0;
}

body.dark-mode .scale-btn {
    background: rgba(255, 255, 255, 0.05);
    color: #e0e0e0;
    border-color: rgba(255, 255, 255, 0.2);
}

body.dark-mode .scale-btn:hover {
    background: rgba(46, 204, 113, 0.1);
    border-color: #2ecc71;
}

body.dark-mode .scale-btn.selected {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
    border-color: #27ae60;
}

body.dark-mode .expert-validation {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .validation-title h3 {
    color: #e0e0e0;
}

body.dark-mode .validation-card {
    background: rgba(46, 204, 113, 0.1);
    border-left-color: #2ecc71;
}

body.dark-mode .validation-card h4 {
    color: #2ecc71;
}

body.dark-mode .validation-card p {
    color: #b0b0b0;
}

body.dark-mode .expert-endorsement {
    background: rgba(52, 152, 219, 0.1);
    border-left-color: #3498db;
}

body.dark-mode .expert-endorsement h4 {
    color: #3498db;
}

body.dark-mode .expert-endorsement p {
    color: #b0b0b0;
}

body.dark-mode .disclaimer {
    background: rgba(241, 196, 15, 0.1);
    border-left-color: #f39c12;
}

body.dark-mode .disclaimer p {
    color: #f39c12;
}

body.dark-mode .mental-health-tips {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .tips-title h3 {
    color: #e0e0e0;
}

body.dark-mode .tips-list li {
    background: rgba(46, 204, 113, 0.1);
    border-left-color: #2ecc71;
}

body.dark-mode .tips-list li strong {
    color: #2ecc71;
}

body.dark-mode .tips-list li p {
    color: #b0b0b0;
}

body.dark-mode .results-container {
    background: rgba(26, 26, 26, 0.98);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .results-header h2 {
    color: #e0e0e0;
}

body.dark-mode .results-header p {
    color: #b0b0b0;
}

body.dark-mode .score-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .score-card h3 {
    color: #e0e0e0;
}

body.dark-mode .score-interpretation {
    background: var(--card-color);
}

body.dark-mode .resource-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .resource-card h4 {
    color: #e0e0e0;
}

body.dark-mode .resource-card p {
    color: #b0b0b0;
}

body.dark-mode .modal-content {
    background: rgba(26, 26, 26, 0.98);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .modal-title {
    color: #e0e0e0;
}

body.dark-mode .settings-section {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .settings-section-title {
    color: #e0e0e0;
}

body.dark-mode .setting-item {
    background: rgba(46, 204, 113, 0.05);
    border: 1px solid rgba(46, 204, 113, 0.1);
}

body.dark-mode .setting-item:hover {
    background: rgba(46, 204, 113, 0.08);
}

body.dark-mode .setting-label label {
    color: #e0e0e0;
}

body.dark-mode .setting-select {
    background: rgba(255, 255, 255, 0.05);
    color: #e0e0e0;
    border-color: rgba(255, 255, 255, 0.2);
}

body.dark-mode .settings-btn-secondary {
    background: rgba(26, 26, 26, 0.9);
    color: #e0e0e0;
    border-color: rgba(255, 255, 255, 0.2);
}

body.dark-mode .settings-btn-secondary:hover {
    background: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
}

/* Font Size Classes */
.font-small {
    font-size: 14px;
}

.font-small * {
    font-size: inherit;
}

.font-medium {
    font-size: 16px;
}

.font-medium * {
    font-size: inherit;
}

.font-large {
    font-size: 18px;
}

.font-large * {
    font-size: inherit;
}

.font-extra-large {
    font-size: 20px;
}

.font-extra-large * {
    font-size: inherit;
}

/* High Contrast Mode */
body.high-contrast {
    background: #000000;
    color: #ffffff;
}

body.high-contrast * {
    border-color: #ffffff !important;
}

body.high-contrast .setting-item {
    border: 2px solid #ffffff;
}

body.high-contrast .toggle-slider {
    background-color: #666666;
}

body.high-contrast input:checked + .toggle-slider {
    background-color: #ffffff;
}

/* Reduced Motion */
body.reduced-motion * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
}

/* Responsive Design */
@media (max-width: 768px) {
    .settings-container {
        padding: 0;
    }

    .settings-section {
        margin-bottom: 1.5rem;
        padding: 1rem;
    }

    .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
    }

    .setting-control {
        width: 100%;
        justify-content: flex-end;
    }

    .notification-control {
        align-items: center;
        flex-direction: row;
        justify-content: space-between;
    }

    .settings-actions {
        flex-direction: column;
        gap: 1rem;
    }

    .settings-main-actions {
        width: 100%;
        justify-content: space-between;
    }

    .settings-btn {
        flex: 1;
        max-width: none;
    }
}

/* Settings Modal Styles */
.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: #2ecc71;
}

input:checked + .toggle-slider:before {
    transform: translateX(26px);
}

/* Settings responsive design */
@media (max-width: 768px) {
    .settings-modal .modal-content {
        margin: 10px;
        width: calc(100% - 20px);
        max-height: calc(100vh - 20px);
    }

    .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }

    .modal-footer {
        flex-direction: column;
        gap: 1rem;
    }

    .modal-footer .btn-group {
        width: 100%;
        justify-content: space-between;
    }
}

/* Dark mode styles */
body.dark-mode {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    color: #e0e0e0;
}

body.dark-mode header {
    background: rgba(26, 26, 26, 0.95);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .hdr-logo h2 {
    color: #2ecc71;
}

body.dark-mode .prfl-name h4 {
    color: #e0e0e0;
}

body.dark-mode .dropdown-menu {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .dropdown-menu a {
    color: #e0e0e0;
}

body.dark-mode .dropdown-menu a:hover {
    color: #2ecc71;
}

body.dark-mode .main-bdy {
    background: transparent;
}

body.dark-mode .bdy-information > div {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #e0e0e0;
}

body.dark-mode .dass21-test {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .question-container {
    background: linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(45, 45, 45, 0.9) 100%);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .scale-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #e0e0e0;
    border-color: rgba(255, 255, 255, 0.2);
}

body.dark-mode .scale-btn:hover {
    background: rgba(46, 204, 113, 0.2);
    border-color: #2ecc71;
}

body.dark-mode .scale-btn.selected {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
}

body.dark-mode .expert-validation {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .validation-card {
    background: rgba(46, 204, 113, 0.1);
    border-left-color: #2ecc71;
}

body.dark-mode .mental-health-tips {
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .tips-list li {
    background: rgba(46, 204, 113, 0.1);
    border-left-color: #2ecc71;
}

body.dark-mode .results-container {
    background: rgba(26, 26, 26, 0.98);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .score-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .resource-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .modal-content {
    background: #2d2d2d;
    color: #e0e0e0;
}

body.dark-mode .setting-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Font size adjustments */
body.font-size-small {
    font-size: 14px;
}

body.font-size-large {
    font-size: 18px;
}

body.font-size-extra_large {
    font-size: 20px;
}

/* High contrast mode */
body.high-contrast {
    background: #000000;
    color: #ffffff;
}

body.high-contrast * {
    border-color: #ffffff !important;
}

body.high-contrast .setting-item {
    background: #000000;
    border: 2px solid #ffffff;
}

/* Reduced motion */
body.reduced-motion * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
}

/* Screen reader optimizations */
body.screen-reader .setting-item {
    border: 2px solid #2ecc71;
}

body.screen-reader .toggle-switch {
    border: 2px solid #2ecc71;
}
  </style>
  {% csrf_token %}
</head>
<body data-user-authenticated="{% if user.is_authenticated %}true{% else %}false{% endif %}">
    <!-- Welcome Modal -->
    <div id="welcomeModal" style="display:flex;align-items:center;justify-content:center;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);z-index:3000;">
      <div style="background:#fff;padding:2.5rem;border-radius:20px;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 15px 50px rgba(0,0,0,0.2);text-align:left;position:relative;border-left:4px solid #2ecc71;">
       <button id="welcomeCloseBtn" style="position:absolute;top:15px;right:15px;background:none;border:none;font-size:24px;cursor:pointer;color:#999;">&times;</button>

        <!-- Welcome Header -->
        <div style="text-align:center;margin-bottom:2rem;">
          <img src="{% static 'mentalhealth/img/osa-logo.jpg' %}" alt="OSA Logo" style="width:80px;height:80px;border-radius:50%;margin:0 auto 1rem;object-fit:cover;border:3px solid #2ecc71;">
          <h2 style="color:#2c3e50;margin:0;font-size:1.8rem;font-weight:600;">Mental Health Assessment</h2>
        </div>

        <!-- Disclaimer -->
        <div style="background:rgba(46,204,113,0.1);padding:1.5rem;border-radius:12px;margin-bottom:2rem;border-left:4px solid #2ecc71;text-align:center;">
          <p style="margin:0;color:#555;line-height:1.6;font-size:1rem;">
            This DASS-21 assessment is conducted by OSA and your data will be secured in accordance with the Data Privacy Act.
          </p>
        </div>

        <!-- Action Button -->
        <div style="display:flex;justify-content:center;">
          <button id="welcomeAgreeBtn" style="background:linear-gradient(135deg,#2ecc71,#27ae60);color:#fff;padding:0.8rem 2rem;border:none;border-radius:8px;font-size:1rem;cursor:pointer;font-weight:500;">I Agree</button>
        </div>
      </div>
    </div>
    <header>
        <div class="hdr">
            <div class="hdr-logo"><a href="#"><h2>CalmConnect</h2></a></div>
            <div class="hdr-btns">
                <div class="prfl-bell" id="notif-bell">
                    <i class="bx bxs-bell" id="bell-icon"></i>
                    <span class="notification-badge" id="notificationBadge" style="display:none;">0</span>
                    <div class="notification-dropdown" id="notificationDropdown" style="display:none;"></div>
                </div>
                <div class="prfl-name">
    <h4>{{ username }}</h4>
</div>
<div class="prfl-container dropdown">
                        <img src="{% if profile_picture %}{{ profile_picture }}{% else %}{% static 'mentalhealth/img/default.jpg' %}{% endif %}"
     alt="Profile Picture"
     id="profile-img">    <div class="dropdown-menu" id="profile-dropdown">
        <a href="#" id="settings-link">Settings</a>
        <a href="{% url 'logout' %}">Logout</a>
        <a href="{% url 'user-profile' %}">{{ username }}</a>
    </div>
</div>
            </div>
        </div>
    </header>

    {% csrf_token %}
    <main class="main-bdy">
        <div class="bdy-upper">
            <div class="upper-txt">
                <h2>DASS21 Test</h2>
                <p>DASS-21 Based Anxiety & Stress Checker</p>
            </div>
        </div>

        <div class="bdy-information">
            <div class="info1">
                <h4>Understand yourself</h4>
                <img src="{% static '/img/info1.jpg' %}" alt="info1">
                <p>Learn how anxiety and stress affect your daily life.</p>
            </div>
            <div class="info2">
                <h4>View Results</h4>
                <img src="{% static '/img/info3.png' %}" alt="info1">
                <p>Learn how anxious you are and how to manage stress.</p>
            </div>
            <div class="info3">
                <h4>Get Support</h4>
                <img src="{% static '/img/info2.png' %}" alt="info1">
                <p>Find resources tailored to your emotional health needs.</p>
            </div>
        </div>

       <section class="dass21-test">
    <div class="test-title">
        <h2>How Have You Been Feeling?</h2>
    </div>
    
    <div class="question-container">
        <h3 id="question-text"></h3>
        
        <div class="motivation-message" id="motivationMessage">
            Your answers help us understand how to best support you.
        </div>
        
        <div class="scale-options">
            <button class="scale-btn" data-value="0">
                <span class="emoji"></span>
                <span>Never</span>
                <span class="label">0 - Did not apply</span>
            </button>
            <button class="scale-btn" data-value="1">
                <span class="emoji"></span>
                <span>Sometimes</span>
                <span class="label">1 - Applied somewhat</span>
            </button>
            <button class="scale-btn" data-value="2">
                <span class="emoji"></span>
                <span>Often</span>
                <span class="label">2 - Applied a good degree</span>
            </button>
            <button class="scale-btn" data-value="3">
                <span class="emoji"></span>
                <span>Always</span>
                <span class="label">3 - Applied very much</span>
            </button>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar" style="width: 0%;"></div>
        </div>
        
        <div class="mini-progress" id="mini-progress"></div>
        
        <div class="question-navigation">
            
            <div class="question-progress">
                <p id="progress"></p>
            </div>
           
        </div>
    </div>
</section>

        <section class="expert-validation">
            <div class="validation-title">
                <i class="bx bxs-shield-check icon"></i>
                <h3>Why Take the DASS-21?</h3>
                <p>Trusted by mental health professionals worldwide</p>
            </div>
            
            <div class="validation-content">
                <div class="validation-card">
                    <h4><i class="bx bxs-user-check"></i> Clinically Validated</h4>
                    <p>The DASS-21 is a scientifically validated psychological assessment tool used by mental health professionals to measure depression, anxiety, and stress levels with high accuracy.</p>
                </div>
                
                <div class="validation-card">
                    <h4><i class="bx bxs-brain"></i> Evidence-Based</h4>
                    <p>Developed through extensive research and validated across diverse populations, the DASS-21 provides reliable insights into your emotional well-being and mental health status.</p>
                </div>
                
                <div class="validation-card">
                    <h4><i class="bx bxs-heart"></i> Self-Awareness</h4>
                    <p>Understanding your current mental state is the first step toward better mental health. This assessment helps you identify areas where you might benefit from support or intervention.</p>
                </div>
            </div>
            
            <div class="expert-endorsement">
                <h4>Endorsed by Mental Health Professionals</h4>
                <p>"The DASS-21 is one of the most reliable and widely used screening tools in clinical psychology. It provides valuable insights that can guide individuals toward appropriate mental health resources and support."</p>
            </div>
            
            <div class="disclaimer">
                <p><strong>Important:</strong> This assessment is for informational purposes only and does not replace professional medical advice, diagnosis, or treatment. Always consult with qualified healthcare providers for personalized guidance.</p>
            </div>
        </section>

        <!-- Mental Health Tips Section -->
        <section class="mental-health-tips" id="mentalHealthTips" style="display: none;">
            <div class="tips-title">
                <i class="bx bx-heart icon"></i>
                <h3>Personalized Mental Health Tips</h3>
                <p id="tipsSubtitle">Tailored recommendations based on your assessment results</p>
            </div>

            <div class="tips-content">
                <div id="tipsList" class="tips-list">
                    <!-- Tips will be dynamically generated here -->
                </div>
            </div>
        </section>

        <!-- Results Section with Circular Progress -->
        <div class="results-container" id="resultsContainer">
            <!-- SVG Gradients -->
            <svg width="0" height="0">
                <defs>
                    <linearGradient id="depressionGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#e74c3c;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#c0392b;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="anxietyGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#f39c12;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#e67e22;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="stressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#9b59b6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#8e44ad;stop-opacity:1" />
                    </linearGradient>
                </defs>
            </svg>

            <div class="results-header">
                <h2>Your DASS-21 Results</h2>
                <div class="encouragement-msg">
                    Thank you for completing the assessment. These results are a snapshot of how you're feeling right now.
                </div>
                <div class="save-status" id="saveStatus" style="display: none; background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; margin-top: 10px; text-align: center;">
                    <i class="bx bx-check-circle"></i> Results saved successfully! You can now book a session.
                </div>
            </div>
            
            <div class="scores-grid">
                <div class="score-card depression">
                    <h3>Depression</h3>
                    <div class="circular-progress">
                        <svg viewBox="0 0 100 100">
                            <circle class="progress-ring" cx="50" cy="50" r="40" />
                            <circle class="progress-ring-fill" cx="50" cy="50" r="40" />
                        </svg>
                        <div class="score-display">
                            <div class="score-value" id="depressionScore">0</div>
                            <div class="score-max">/ 42</div>
                        </div>
                    </div>
                    <div class="score-interpretation" id="depressionInterpretation"></div>
                    <div class="severity-indicator">
                        <div class="severity-dot" data-level="0"></div>
                        <div class="severity-dot" data-level="1"></div>
                        <div class="severity-dot" data-level="2"></div>
                        <div class="severity-dot" data-level="3"></div>
                        <div class="severity-dot" data-level="4"></div>
                    </div>
                </div>
                
                <div class="score-card anxiety">
                    <h3>Anxiety</h3>
                    <div class="circular-progress">
                        <svg viewBox="0 0 100 100">
                            <circle class="progress-ring" cx="50" cy="50" r="40" />
                            <circle class="progress-ring-fill" cx="50" cy="50" r="40" />
                        </svg>
                        <div class="score-display">
                            <div class="score-value" id="anxietyScore">0</div>
                            <div class="score-max">/ 42</div>
                        </div>
                    </div>
                    <div class="score-interpretation" id="anxietyInterpretation"></div>
                    <div class="severity-indicator">
                        <div class="severity-dot" data-level="0"></div>
                        <div class="severity-dot" data-level="1"></div>
                        <div class="severity-dot" data-level="2"></div>
                        <div class="severity-dot" data-level="3"></div>
                        <div class="severity-dot" data-level="4"></div>
                    </div>
                </div>
                
                <div class="score-card stress">
                    <h3>Stress</h3>
                    <div class="circular-progress">
                        <svg viewBox="0 0 100 100">
                            <circle class="progress-ring" cx="50" cy="50" r="40" />
                            <circle class="progress-ring-fill" cx="50" cy="50" r="40" />
                        </svg>
                        <div class="score-display">
                            <div class="score-value" id="stressScore">0</div>
                            <div class="score-max">/ 42</div>
                        </div>
                    </div>
                    <div class="score-interpretation" id="stressInterpretation"></div>
                    <div class="severity-indicator">
                        <div class="severity-dot" data-level="0"></div>
                        <div class="severity-dot" data-level="1"></div>
                        <div class="severity-dot" data-level="2"></div>
                        <div class="severity-dot" data-level="3"></div>
                        <div class="severity-dot" data-level="4"></div>
                    </div>
                </div>
            </div>
            
         <div class="resources-section">
        <h3>Recommended Resources</h3>
        <div class="resources-grid">
<div class="resource-card">
    <h4>Counseling Services</h4>
    <img src="{% static '/img/counseling.png' %}" alt="Counseling">
    <p>Connect with licensed professionals for personalized support and guidance.</p>
<a href="{% url 'scheduler' %}?depression={{ scores.depression }}&anxiety={{ scores.anxiety }}&stress={{ scores.stress }}" 
   id="bookSessionBtn">Book Session</a>
</div>
         <div class="resource-card">
    <h4>Mindful Exercises</h4>
    <img src="{% static '/img/mindfulness.png' %}" alt="Mindfulness">
    <p>Practice guided meditations and breathing techniques to find calm.</p>
    <a href="#" id="startExercisesBtn">Start Exercises</a>
</div>
            <div class="resource-card">
                <h4>Support Groups</h4>
                <img src="{% static '/img/support-group.png' %}" alt="Support Group">
                <p>Join communities of people who understand what you're going through.</p>
                <a href="#" id="findGroupsBtn">Find Groups</a>
            </div>
        </div>
    </div>
            
            <div class="action-buttons">
                <button class="retake-btn" id="retakeBtn">Retake Test</button>
                <button class="save-btn" id="saveBtn">Saving Results...</button>
            </div>
        </div>
        <div class="modal" id="supportGroupsModal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2 class="modal-title">Available Support Groups</h2>
        
        <div class="support-groups-container">
            <div class="support-group-card">
                <img src="{% static '/img/peer-facilitators.jpg' %}" alt="Support Group 1" class="group-image">
                <div class="group-info">
                    <h3>CLSU Peer Facilitators Group</h3>
                 
                    <p>A supportive community for CLSU students to share experiences and receive peer support for mental health challenges.</p>
                    <a href="https://www.facebook.com/profile.php?id=100090505880569" class="join-btn" target="_blank">View Group</a>
                </div>
            </div>
            
            <div class="support-group-card">
                <img src="{% static '/img/paro-parong-bukid.jpg' %}" alt="Support Group 2" class="group-image">
                <div class="group-info">
                    <h3>CLSU Paruparong Bukid</h3>
               
                    <p>An inclusive community promoting mental wellness through creative expression and peer support at CLSU.</p>
                    <a href="https://www.facebook.com/clsuparuparongbukid" class="join-btn" target="_blank">View Page</a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="exercisesModal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2 class="modal-title">Interactive Mindfulness Exercises</h2>
        
        <div class="exercises-container">
          <div class="exercise-card" id="breathingExercise">
    <div class="exercise-info">
        <h3>Deep Breathing Exercise</h3>
        <p>Follow this 5-minute guided breathing exercise to reduce stress and anxiety.</p>
        
        <div class="breathing-container" id="breathingContainer">
            <div class="breathing-circle" id="breathingCircle">
                <div class="breathing-text" id="breathingText">Ready</div>
            </div>
            <div class="breathing-instructions" id="breathingInstructions">
                <p>Breathe in through your nose, out through your mouth</p>
            </div>
            <div class="breathing-controls">
                <button class="start-btn" id="startBreathingBtn">Start Exercise</button>
                <button class="pause-btn" id="pauseBreathingBtn" style="display:none;">Pause</button>
                <div class="duration">5 min</div>
            </div>
            <div class="breathing-progress">
                <div class="progress-bar" id="breathingProgress"></div>
            </div>
        </div>
    </div>
</div>
            
         <div class="exercise-card" id="eftExercise">
   <div class="exercise-card" id="eftExercise">
    <div class="exercise-info">
        <h3>Emotional Freedom Tapping (EFT)</h3>
        <p>Follow this guided tapping sequence to reduce stress and anxiety.</p>
        
        <div class="eft-container" id="eftContainer">
            <div class="eft-visual">
                <div class="eft-points">
                    <div class="eft-point" data-point="karate-chop">Karate Chop</div>
                    <div class="eft-point" data-point="eyebrow">Eyebrow</div>
                    <div class="eft-point" data-point="side-of-eye">Side of Eye</div>
                    <div class="eft-point" data-point="under-eye">Under Eye</div>
                    <div class="eft-point" data-point="under-nose">Under Nose</div>
                    <div class="eft-point" data-point="chin">Chin</div>
                    <div class="eft-point" data-point="collarbone">Collarbone</div>
                    <div class="eft-point" data-point="under-arm">Under Arm</div>
                    <div class="eft-point" data-point="top-of-head">Top of Head</div>
                </div>
                <div class="eft-human">
                    <img src="../../static/mentalhealth/img/human-outline.png" alt="Human outline" id="eftHuman">
                    <div class="eft-highlight" id="eftHighlight"></div>
                </div>
            </div>
            <div class="eft-instructions" id="eftInstructions">
                <p>Tap each point while repeating an affirmation about your issue.</p>
            </div>
            <div class="eft-controls">
                <button class="start-btn" id="startEftBtn">Start Exercise</button>
                <button class="pause-btn" id="pauseEftBtn" style="display:none;">Pause</button>
                <div class="duration">10 min</div>
            </div>
            <div class="eft-progress">
                <div class="progress-bar" id="eftProgress"></div>
            </div>
        </div>
    </div>
</div>
</div>
            
            <div class="exercise-card">
                <img src="../../static/mentalhealth/img/muscle-relaxation.png" alt="Grounding Exercise" class="exercise-image">
                <div class="exercise-info">
                    <h3>Progressive Muscle Relaxation</h3>
                    <p>Progressive Muscle Relaxation (PMR) is a calming technique that involves tensing and then slowly releasing different muscle groups in the body. This helps you become more aware of physical tension and encourages full-body relaxation. PMR is especially helpful for easing stress, reducing anxiety, and improving sleep.</p>
                    <div class="exercise-controls">
                        <button class="start-btn" id="startPmrBtn">Start Exercise</button>
                        <div class="duration">3 min</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal">
    <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
        <span class="close-modal" id="settingsCloseBtn">&times;</span>
        <h2 class="modal-title">Settings</h2>

        <div class="settings-container">
            <!-- Appearance Settings -->
            <div class="settings-section">
                <h3 class="settings-section-title">
                    <i class="bx bx-palette"></i>
                    Appearance
                </h3>
                <div class="settings-group">
                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="darkModeToggle">Dark Mode</label>
                            <span class="setting-tooltip" title="Switch between light and dark themes for reduced eye strain">?</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="fontSizeSelect">Font Size</label>
                            <span class="setting-tooltip" title="Adjust text size for better readability">?</span>
                        </div>
                        <div class="setting-control">
                            <select id="fontSizeSelect" class="setting-select">
                                <option value="small">Small</option>
                                <option value="medium">Medium</option>
                                <option value="large">Large</option>
                                <option value="extra-large">Extra Large</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Language Settings -->
            <div class="settings-section">
                <h3 class="settings-section-title">
                    <i class="bx bx-globe"></i>
                    Language & Localization
                </h3>
                <div class="settings-group">
                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="languageSelect">Language</label>
                            <span class="setting-tooltip" title="Choose your preferred language for the interface">?</span>
                        </div>
                        <div class="setting-control">
                            <select id="languageSelect" class="setting-select">
                                <option value="en">English</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notification Preferences -->
            <div class="settings-section">
                <h3 class="settings-section-title">
                    <i class="bx bx-bell"></i>
                    Notifications
                </h3>
                <div class="settings-group">
                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="assignmentReminders">Assignment Reminders</label>
                            <span class="setting-tooltip" title="Get notified about upcoming assignments and deadlines">?</span>
                        </div>
                        <div class="setting-control notification-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="assignmentReminders">
                                <span class="toggle-slider"></span>
                            </label>
                            <select id="assignmentRemindersFreq" class="setting-select frequency-select">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="immediate">Immediate</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="gradeUpdates">Grade Updates</label>
                            <span class="setting-tooltip" title="Receive notifications when grades are posted">?</span>
                        </div>
                        <div class="setting-control notification-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="gradeUpdates">
                                <span class="toggle-slider"></span>
                            </label>
                            <select id="gradeUpdatesFreq" class="setting-select frequency-select">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="immediate">Immediate</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="studySessionAlerts">Study Session Alerts</label>
                            <span class="setting-tooltip" title="Get reminders for scheduled study sessions">?</span>
                        </div>
                        <div class="setting-control notification-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="studySessionAlerts">
                                <span class="toggle-slider"></span>
                            </label>
                            <select id="studySessionAlertsFreq" class="setting-select frequency-select">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="immediate">Immediate</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="appointmentReminders">Appointment Reminders</label>
                            <span class="setting-tooltip" title="Receive reminders for counseling appointments">?</span>
                        </div>
                        <div class="setting-control notification-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="appointmentReminders">
                                <span class="toggle-slider"></span>
                            </label>
                            <select id="appointmentRemindersFreq" class="setting-select frequency-select">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="immediate">Immediate</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="followupNotifications">Follow-up Notifications</label>
                            <span class="setting-tooltip" title="Get notified about follow-up session requests and confirmations">?</span>
                        </div>
                        <div class="setting-control notification-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="followupNotifications">
                                <span class="toggle-slider"></span>
                            </label>
                            <select id="followupNotificationsFreq" class="setting-select frequency-select">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="immediate">Immediate</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accessibility Options -->
            <div class="settings-section">
                <h3 class="settings-section-title">
                    <i class="bx bx-accessibility"></i>
                    Accessibility
                </h3>
                <div class="settings-group">
                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="highContrastToggle">High Contrast Mode</label>
                            <span class="setting-tooltip" title="Increase contrast for better visibility">?</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="highContrastToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="screenReaderToggle">Screen Reader Support</label>
                            <span class="setting-tooltip" title="Optimize interface for screen readers">?</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="screenReaderToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="reducedMotionToggle">Reduced Motion</label>
                            <span class="setting-tooltip" title="Minimize animations and transitions">?</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="reducedMotionToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Privacy Settings -->
            <div class="settings-section">
                <h3 class="settings-section-title">
                    <i class="bx bx-shield"></i>
                    Privacy & Data
                </h3>
                <div class="settings-group">
                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="analyticsToggle">Analytics Tracking</label>
                            <span class="setting-tooltip" title="Allow anonymous usage data collection to improve the service">?</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="analyticsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="profileVisibilitySelect">Profile Visibility</label>
                            <span class="setting-tooltip" title="Control who can see your profile information">?</span>
                        </div>
                        <div class="setting-control">
                            <select id="profileVisibilitySelect" class="setting-select">
                                <option value="public">Public</option>
                                <option value="counselors_only">Counselors Only</option>
                                <option value="private">Private</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="settings-actions">
            <button id="resetSettingsBtn" class="settings-btn settings-btn-secondary">Reset to Defaults</button>
            <div class="settings-main-actions">
                <button id="cancelSettingsBtn" class="settings-btn settings-btn-secondary">Cancel</button>
                <button id="saveSettingsBtn" class="settings-btn settings-btn-primary">Save Settings</button>
            </div>
        </div>
    </div>
 </div>

     <!-- Settings Modal -->
     <div id="settingsModal" class="modal">
         <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
             <span class="close-modal" id="closeSettingsModal">&times;</span>
             <h2 class="modal-title">Settings</h2>

             <div class="settings-container">
                 <!-- Appearance Settings -->
                 <div class="settings-section">
                     <h3><i class="bx bx-palette"></i> Appearance</h3>
                     <div class="setting-item">
                         <div class="setting-label">
                             <label for="darkModeToggle">Dark Mode</label>
                             <span class="setting-tooltip" title="Switch between light and dark themes for better eye comfort">?</span>
                         </div>
                         <label class="toggle-switch">
                             <input type="checkbox" id="darkModeToggle">
                             <span class="toggle-slider"></span>
                         </label>
                     </div>

                     <div class="setting-item">
                         <div class="setting-label">
                             <label for="fontSizeSelect">Font Size</label>
                             <span class="setting-tooltip" title="Adjust text size for better readability">?</span>
                         </div>
                         <select id="fontSizeSelect" class="setting-select">
                             <option value="small">Small</option>
                             <option value="medium" selected>Medium</option>
                             <option value="large">Large</option>
                             <option value="extra_large">Extra Large</option>
                         </select>
                     </div>
                 </div>

                 <!-- Language Settings -->
                 <div class="settings-section">
                     <h3><i class="bx bx-globe"></i> Language & Localization</h3>
                     <div class="setting-item">
                         <div class="setting-label">
                             <label for="languageSelect">Language</label>
                             <span class="setting-tooltip" title="Choose your preferred language for the application">?</span>
                         </div>
                         <select id="languageSelect" class="setting-select">
                             <option value="en" selected>English</option>
                             <option value="es">Spanish</option>
                             <option value="fr">French</option>
                         </select>
                     </div>
                 </div>

                 <!-- Notification Preferences -->
                 <div class="settings-section">
                     <h3><i class="bx bx-bell"></i> Notifications</h3>
                     <div class="notification-settings">
                         <div class="setting-item">
                             <div class="setting-label">
                                 <label for="assignmentReminders">Assignment Reminders</label>
                                 <span class="setting-tooltip" title="Get notified about upcoming assignments and deadlines">?</span>
                             </div>
                             <div class="notification-controls">
                                 <label class="toggle-switch">
                                     <input type="checkbox" id="assignmentReminders" checked>
                                     <span class="toggle-slider"></span>
                                 </label>
                                 <select id="assignmentRemindersFreq" class="frequency-select">
                                     <option value="daily" selected>Daily</option>
                                     <option value="weekly">Weekly</option>
                                 </select>
                             </div>
                         </div>

                         <div class="setting-item">
                             <div class="setting-label">
                                 <label for="gradeUpdates">Grade Updates</label>
                                 <span class="setting-tooltip" title="Receive notifications when grades are posted">?</span>
                             </div>
                             <div class="notification-controls">
                                 <label class="toggle-switch">
                                     <input type="checkbox" id="gradeUpdates" checked>
                                     <span class="toggle-slider"></span>
                                 </label>
                                 <select id="gradeUpdatesFreq" class="frequency-select">
                                     <option value="daily">Daily</option>
                                     <option value="weekly" selected>Weekly</option>
                                 </select>
                             </div>
                         </div>

                         <div class="setting-item">
                             <div class="setting-label">
                                 <label for="studySessionAlerts">Study Session Alerts</label>
                                 <span class="setting-tooltip" title="Reminders for scheduled study sessions">?</span>
                             </div>
                             <div class="notification-controls">
                                 <label class="toggle-switch">
                                     <input type="checkbox" id="studySessionAlerts" checked>
                                     <span class="toggle-slider"></span>
                                 </label>
                                 <select id="studySessionAlertsFreq" class="frequency-select">
                                     <option value="daily" selected>Daily</option>
                                     <option value="weekly">Weekly</option>
                                 </select>
                             </div>
                         </div>

                         <div class="setting-item">
                             <div class="setting-label">
                                 <label for="appointmentReminders">Appointment Reminders</label>
                                 <span class="setting-tooltip" title="Get reminded about upcoming counseling appointments">?</span>
                             </div>
                             <div class="notification-controls">
                                 <label class="toggle-switch">
                                     <input type="checkbox" id="appointmentReminders" checked>
                                     <span class="toggle-slider"></span>
                                 </label>
                                 <select id="appointmentRemindersFreq" class="frequency-select">
                                     <option value="daily" selected>Daily</option>
                                     <option value="weekly">Weekly</option>
                                 </select>
                             </div>
                         </div>

                         <div class="setting-item">
                             <div class="setting-label">
                                 <label for="followupNotifications">Follow-up Notifications</label>
                                 <span class="setting-tooltip" title="Notifications about follow-up sessions and check-ins">?</span>
                             </div>
                             <div class="notification-controls">
                                 <label class="toggle-switch">
                                     <input type="checkbox" id="followupNotifications" checked>
                                     <span class="toggle-slider"></span>
                                 </label>
                                 <select id="followupNotificationsFreq" class="frequency-select">
                                     <option value="daily">Daily</option>
                                     <option value="weekly" selected>Weekly</option>
                                 </select>
                             </div>
                         </div>
                     </div>
                 </div>

                 <!-- Accessibility Options -->
                 <div class="settings-section">
                     <h3><i class="bx bx-accessibility"></i> Accessibility</h3>
                     <div class="setting-item">
                         <div class="setting-label">
                             <label for="highContrastToggle">High Contrast Mode</label>
                             <span class="setting-tooltip" title="Increase contrast for better visibility">?</span>
                         </div>
                         <label class="toggle-switch">
                             <input type="checkbox" id="highContrastToggle">
                             <span class="toggle-slider"></span>
                         </label>
                     </div>

                     <div class="setting-item">
                         <div class="setting-label">
                             <label for="screenReaderToggle">Screen Reader Optimization</label>
                             <span class="setting-tooltip" title="Optimize interface for screen readers">?</span>
                         </div>
                         <label class="toggle-switch">
                             <input type="checkbox" id="screenReaderToggle">
                             <span class="toggle-slider"></span>
                         </label>
                     </div>

                     <div class="setting-item">
                         <div class="setting-label">
                             <label for="reducedMotionToggle">Reduced Motion</label>
                             <span class="setting-tooltip" title="Minimize animations and transitions">?</span>
                         </div>
                         <label class="toggle-switch">
                             <input type="checkbox" id="reducedMotionToggle">
                             <span class="toggle-slider"></span>
                         </label>
                     </div>
                 </div>

                 <!-- Data Privacy Settings -->
                 <div class="settings-section">
                     <h3><i class="bx bx-shield"></i> Privacy & Data</h3>
                     <div class="setting-item">
                         <div class="setting-label">
                             <label for="analyticsTrackingToggle">Analytics Tracking</label>
                             <span class="setting-tooltip" title="Allow anonymous usage data collection to improve the app">?</span>
                         </div>
                         <label class="toggle-switch">
                             <input type="checkbox" id="analyticsTrackingToggle" checked>
                             <span class="toggle-slider"></span>
                         </label>
                     </div>

                     <div class="setting-item">
                         <div class="setting-label">
                             <label for="profileVisibilitySelect">Profile Visibility</label>
                             <span class="setting-tooltip" title="Control who can see your profile information">?</span>
                         </div>
                         <select id="profileVisibilitySelect" class="setting-select">
                             <option value="public">Public</option>
                             <option value="counselors_only" selected>Counselors Only</option>
                             <option value="private">Private</option>
                         </select>
                     </div>
                 </div>
             </div>

             <div class="settings-actions">
                 <button id="resetSettingsBtn" class="btn-secondary">Reset to Defaults</button>
                 <div class="action-buttons">
                     <button id="cancelSettingsBtn" class="btn-secondary">Cancel</button>
                     <button id="saveSettingsBtn" class="btn-primary">Save Settings</button>
                 </div>
             </div>
         </div>
     </div>
     </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid #eee;">
                <h2 style="margin: 0; color: #2c3e50; font-size: 1.8rem; font-weight: 600;">Settings</h2>
                <button id="closeSettingsModal" style="background: none; border: none; font-size: 1.5rem; color: #666; cursor: pointer; padding: 0.5rem;">&times;</button>
            </div>

            <div class="settings-content">
                <!-- Theme & Appearance -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="bx bx-palette"></i>
                        Theme & Appearance
                    </h3>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                        <div>
                            <label style="font-weight: 500; color: #2c3e50;">Dark Mode</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Enable dark theme for reduced eye strain</p>
                        </div>
                        <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            <span class="toggle-slider:before" style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </label>
                    </div>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <div>
                            <label for="fontSizeSelect" style="font-weight: 500; color: #2c3e50;">Font Size</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Adjust text size for better readability</p>
                        </div>
                        <select id="fontSizeSelect" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; background: white;">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                            <option value="extra_large">Extra Large</option>
                        </select>
                    </div>
                </div>

                <!-- Notification Preferences -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="bx bx-bell"></i>
                        Notification Preferences
                    </h3>

                    <div class="notification-settings">
                        <div class="setting-item" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 500; color: #2c3e50;">Assignment Reminders</label>
                                <input type="checkbox" id="assignmentRemindersEnabled" checked>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label for="assignmentRemindersFreq" style="font-size: 0.9rem; color: #666;">Frequency:</label>
                                <select id="assignmentRemindersFreq" style="padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="daily" selected>Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="immediate">Immediate</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 500; color: #2c3e50;">Grade Updates</label>
                                <input type="checkbox" id="gradeUpdatesEnabled" checked>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label for="gradeUpdatesFreq" style="font-size: 0.9rem; color: #666;">Frequency:</label>
                                <select id="gradeUpdatesFreq" style="padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="daily">Daily</option>
                                    <option value="weekly" selected>Weekly</option>
                                    <option value="immediate">Immediate</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 500; color: #2c3e50;">Study Session Alerts</label>
                                <input type="checkbox" id="studySessionAlertsEnabled" checked>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label for="studySessionAlertsFreq" style="font-size: 0.9rem; color: #666;">Frequency:</label>
                                <select id="studySessionAlertsFreq" style="padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="daily" selected>Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="immediate">Immediate</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 500; color: #2c3e50;">Appointment Reminders</label>
                                <input type="checkbox" id="appointmentRemindersEnabled" checked>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label for="appointmentRemindersFreq" style="font-size: 0.9rem; color: #666;">Frequency:</label>
                                <select id="appointmentRemindersFreq" style="padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="daily" selected>Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="immediate">Immediate</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item" style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 500; color: #2c3e50;">Follow-up Notifications</label>
                                <input type="checkbox" id="followupNotificationsEnabled" checked>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label for="followupNotificationsFreq" style="font-size: 0.9rem; color: #666;">Frequency:</label>
                                <select id="followupNotificationsFreq" style="padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="daily">Daily</option>
                                    <option value="weekly" selected>Weekly</option>
                                    <option value="immediate">Immediate</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Language & Localization -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="bx bx-globe"></i>
                        Language & Localization
                    </h3>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <div>
                            <label for="languageSelect" style="font-weight: 500; color: #2c3e50;">Language</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Choose your preferred language</p>
                        </div>
                        <select id="languageSelect" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; background: white;">
                            <option value="en" selected>English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                        </select>
                    </div>
                </div>

                <!-- Accessibility Options -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="bx bx-accessibility"></i>
                        Accessibility Options
                    </h3>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                        <div>
                            <label style="font-weight: 500; color: #2c3e50;">High Contrast Mode</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Increase contrast for better visibility</p>
                        </div>
                        <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                            <input type="checkbox" id="highContrastToggle">
                            <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            <span class="toggle-slider:before" style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </label>
                    </div>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                        <div>
                            <label style="font-weight: 500; color: #2c3e50;">Screen Reader Support</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Optimize interface for screen readers</p>
                        </div>
                        <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                            <input type="checkbox" id="screenReaderToggle">
                            <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            <span class="toggle-slider:before" style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </label>
                    </div>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <div>
                            <label style="font-weight: 500; color: #2c3e50;">Reduced Motion</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Minimize animations and transitions</p>
                        </div>
                        <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                            <input type="checkbox" id="reducedMotionToggle">
                            <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            <span class="toggle-slider:before" style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </label>
                    </div>
                </div>

                <!-- Data Privacy Settings -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="bx bx-shield"></i>
                        Data Privacy Settings
                    </h3>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                        <div>
                            <label style="font-weight: 500; color: #2c3e50;">Analytics Tracking</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Allow collection of usage analytics</p>
                        </div>
                        <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                            <input type="checkbox" id="analyticsTrackingToggle" checked>
                            <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            <span class="toggle-slider:before" style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </label>
                    </div>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <div>
                            <label for="profileVisibilitySelect" style="font-weight: 500; color: #2c3e50;">Profile Visibility</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Control who can see your profile</p>
                        </div>
                        <select id="profileVisibilitySelect" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; background: white;">
                            <option value="public">Public</option>
                            <option value="counselors_only" selected>Counselors Only</option>
                            <option value="private">Private</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #eee;">
                <button id="resetSettingsBtn" style="background: #6c757d; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 500;">Reset to Defaults</button>
                <div style="display: flex; gap: 1rem;">
                    <button id="cancelSettingsBtn" style="background: #6c757d; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 500;">Cancel</button>
                    <button id="saveSettingsBtn" style="background: #2ecc71; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 500;">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid #eee;">
                <h2 style="margin: 0; color: #2c3e50; font-size: 1.8rem; font-weight: 600;">Settings</h2>
                <button id="closeSettingsModal" style="background: none; border: none; font-size: 1.5rem; color: #666; cursor: pointer; padding: 0.5rem;">&times;</button>
            </div>

            <div class="settings-content">
                <!-- Theme & Appearance -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="bx bx-palette"></i>
                        Theme & Appearance
                    </h3>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                        <div>
                            <label style="font-weight: 500; color: #2c3e50;">Dark Mode</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Enable dark theme for reduced eye strain</p>
                        </div>
                        <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            <span class="toggle-slider:before" style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </label>
                    </div>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <div>
                            <label for="fontSizeSelect" style="font-weight: 500; color: #2c3e50;">Font Size</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Adjust text size for better readability</p>
                        </div>
                        <select id="fontSizeSelect" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; background: white;">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                            <option value="extra_large">Extra Large</option>
                        </select>
                    </div>
                </div>

                <!-- Notification Preferences -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="bx bx-bell"></i>
                        Notification Preferences
                    </h3>

                    <div class="notification-settings">
                        <div class="setting-item" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 500; color: #2c3e50;">Assignment Reminders</label>
                                <input type="checkbox" id="assignmentRemindersEnabled" checked>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label for="assignmentRemindersFreq" style="font-size: 0.9rem; color: #666;">Frequency:</label>
                                <select id="assignmentRemindersFreq" style="padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="daily" selected>Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="immediate">Immediate</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 500; color: #2c3e50;">Grade Updates</label>
                                <input type="checkbox" id="gradeUpdatesEnabled" checked>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label for="gradeUpdatesFreq" style="font-size: 0.9rem; color: #666;">Frequency:</label>
                                <select id="gradeUpdatesFreq" style="padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="daily">Daily</option>
                                    <option value="weekly" selected>Weekly</option>
                                    <option value="immediate">Immediate</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 500; color: #2c3e50;">Study Session Alerts</label>
                                <input type="checkbox" id="studySessionAlertsEnabled" checked>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label for="studySessionAlertsFreq" style="font-size: 0.9rem; color: #666;">Frequency:</label>
                                <select id="studySessionAlertsFreq" style="padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="daily" selected>Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="immediate">Immediate</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 500; color: #2c3e50;">Appointment Reminders</label>
                                <input type="checkbox" id="appointmentRemindersEnabled" checked>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label for="appointmentRemindersFreq" style="font-size: 0.9rem; color: #666;">Frequency:</label>
                                <select id="appointmentRemindersFreq" style="padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="daily" selected>Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="immediate">Immediate</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item" style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label style="font-weight: 500; color: #2c3e50;">Follow-up Notifications</label>
                                <input type="checkbox" id="followupNotificationsEnabled" checked>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label for="followupNotificationsFreq" style="font-size: 0.9rem; color: #666;">Frequency:</label>
                                <select id="followupNotificationsFreq" style="padding: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="daily">Daily</option>
                                    <option value="weekly" selected>Weekly</option>
                                    <option value="immediate">Immediate</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Language & Localization -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="bx bx-globe"></i>
                        Language & Localization
                    </h3>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <div>
                            <label for="languageSelect" style="font-weight: 500; color: #2c3e50;">Language</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Choose your preferred language</p>
                        </div>
                        <select id="languageSelect" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; background: white;">
                            <option value="en" selected>English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                        </select>
                    </div>
                </div>

                <!-- Accessibility Options -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="bx bx-accessibility"></i>
                        Accessibility Options
                    </h3>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                        <div>
                            <label style="font-weight: 500; color: #2c3e50;">High Contrast Mode</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Increase contrast for better visibility</p>
                        </div>
                        <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                            <input type="checkbox" id="highContrastToggle">
                            <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            <span class="toggle-slider:before" style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </label>
                    </div>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                        <div>
                            <label style="font-weight: 500; color: #2c3e50;">Screen Reader Support</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Optimize interface for screen readers</p>
                        </div>
                        <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                            <input type="checkbox" id="screenReaderToggle">
                            <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            <span class="toggle-slider:before" style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </label>
                    </div>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <div>
                            <label style="font-weight: 500; color: #2c3e50;">Reduced Motion</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Minimize animations and transitions</p>
                        </div>
                        <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                            <input type="checkbox" id="reducedMotionToggle">
                            <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            <span class="toggle-slider:before" style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </label>
                    </div>
                </div>

                <!-- Data Privacy Settings -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="bx bx-shield"></i>
                        Data Privacy Settings
                    </h3>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem;">
                        <div>
                            <label style="font-weight: 500; color: #2c3e50;">Analytics Tracking</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Allow collection of usage analytics</p>
                        </div>
                        <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                            <input type="checkbox" id="analyticsTrackingToggle" checked>
                            <span class="toggle-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            <span class="toggle-slider:before" style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </label>
                    </div>

                    <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <div>
                            <label for="profileVisibilitySelect" style="font-weight: 500; color: #2c3e50;">Profile Visibility</label>
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: #666;">Control who can see your profile</p>
                        </div>
                        <select id="profileVisibilitySelect" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; background: white;">
                            <option value="public">Public</option>
                            <option value="counselors_only" selected>Counselors Only</option>
                            <option value="private">Private</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #eee;">
                <button id="resetSettingsBtn" style="background: #6c757d; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 500;">Reset to Defaults</button>
                <div style="display: flex; gap: 1rem;">
                    <button id="cancelSettingsBtn" style="background: #6c757d; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 500;">Cancel</button>
                    <button id="saveSettingsBtn" style="background: #2ecc71; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 500;">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Place all script tags here, just before </body> -->
    <script src="{% static '/js/eft-exercise.js' %}"></script>
    <script src="{% static 'mentalhealth/js/breathing-exercise.js' %}"></script>
    <script>
    // Ensure all inline JS runs after DOM and external scripts
    document.addEventListener('DOMContentLoaded', function() {
        // DASS Test Variables
        const questions = [
            "I found it hard to wind down",
            "I was aware of dryness of my mouth",
            "I couldn't seem to experience any positive feeling at all",
            "I experienced breathing difficulty (e.g., excessively rapid breathing, breathlessness in the absence of physical exertion)",
            "I found it difficult to work up the initiative to do things",
            "I tended to over-react to situations",
            "I experienced trembling (e.g., in the hands)",
            "I felt that I was using a lot of nervous energy",
            "I was worried about situations in which I might panic and make a fool of myself",
            "I felt that I had nothing to look forward to",
            "I found myself getting agitated",
            "I found it difficult to relax",
            "I felt down-hearted and blue",
            "I was intolerant of anything that kept me from getting on with what I was doing",
            "I felt I was close to panic",
            "I was unable to become enthusiastic about anything",
            "I felt I wasn't worth much as a person",
            "I felt that I was rather touchy",
            "I was aware of the action of my heart in the absence of physical exertion (e.g., sense of heart rate increase, heart missing a beat)",
            "I felt scared without any good reason",
            "I felt that life was meaningless"
        ];

        let currentQuestion = 0;
        let answers = {};
        let scores = { depression: 0, anxiety: 0, stress: 0 };

        // DASS Scoring
        const depressionQuestions = [3, 5, 10, 13, 16, 17, 21];
        const anxietyQuestions = [2, 4, 7, 9, 15, 19, 20];
        const stressQuestions = [1, 6, 8, 11, 12, 14, 18];

        // Elements
        const questionText = document.getElementById('question-text');
        const progressBar = document.getElementById('progress-bar');
        const progress = document.getElementById('progress');
        const scaleBtns = document.querySelectorAll('.scale-btn');
        const resultsContainer = document.getElementById('resultsContainer');
        const dassTest = document.querySelector('.dass21-test');

        // Initialize welcome modal
        function initWelcomeModal() {
            const welcomeModal = document.getElementById('welcomeModal');
            const welcomeAgreeBtn = document.getElementById('welcomeAgreeBtn');
            const welcomeCloseBtn = document.getElementById('welcomeCloseBtn');

            // Hide the test content initially
            const dassTest = document.querySelector('.dass21-test');
            if (dassTest) dassTest.style.display = 'none';

            // Show the welcome modal
            if (welcomeModal) {
                welcomeModal.style.display = 'flex';
            }

            // Handle agree button
            if (welcomeAgreeBtn) {
                welcomeAgreeBtn.addEventListener('click', function() {
                    userConsentedToAI = false;
                    if (welcomeModal) welcomeModal.style.display = 'none';
                    initTest();
                });
            }

            // Handle close button
            if (welcomeCloseBtn) {
                welcomeCloseBtn.addEventListener('click', function() {
                    userConsentedToAI = false;
                    if (welcomeModal) welcomeModal.style.display = 'none';
                    initTest();
                });
            }

            // Close when clicking outside the modal
            if (welcomeModal) {
                welcomeModal.addEventListener('click', function(e) {
                    if (e.target === welcomeModal) {
                        userConsentedToAI = false;
                        welcomeModal.style.display = 'none';
                        initTest();
                    }
                });
            }
        }

        // Initialize
        function initTest() {
            currentQuestion = 0;
            answers = {};
            scores = { depression: 0, anxiety: 0, stress: 0 };

            // Re-enable the scale buttons
            scaleBtns.forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
            });

            showQuestion();
            if (dassTest) dassTest.style.display = 'block';
            if (resultsContainer) resultsContainer.style.display = 'none';
        }

        function showQuestion() {
            if (currentQuestion < questions.length) {
                questionText.textContent = questions[currentQuestion];
                progressBar.style.width = `${((currentQuestion + 1) / questions.length) * 100}%`;
                progress.textContent = `Question ${currentQuestion + 1} of ${questions.length}`;
            } else {
                showResults();
            }
        }

        function handleAnswer(value) {
            console.log('handleAnswer called with value:', value, 'currentQuestion:', currentQuestion);
            answers[(currentQuestion + 1).toString()] = value;
            currentQuestion++;
            showQuestion();
        }

        function calculateScores() {
            // Calculate raw subscale scores (0-21 range) for backend storage
            scores.depression = depressionQuestions.reduce((sum, qNum) => sum + (answers[qNum.toString()] || 0), 0);
            scores.anxiety = anxietyQuestions.reduce((sum, qNum) => sum + (answers[qNum.toString()] || 0), 0);
            scores.stress = stressQuestions.reduce((sum, qNum) => sum + (answers[qNum.toString()] || 0), 0);

            // Store multiplied scores for display (0-42 range)
            scores.display_depression = scores.depression * 2;
            scores.display_anxiety = scores.anxiety * 2;
            scores.display_stress = scores.stress * 2;
        }

        // Function to generate AI-powered personalized mental health tips
        async function generatePersonalizedTips(depressionScore, anxietyScore, stressScore) {
            console.log('Generating AI-powered tips for scores:', { depressionScore, anxietyScore, stressScore });

            try {
                console.log('Fetching enhanced AI-powered tips...');
                const response = await fetch('/api/generate-tips/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: JSON.stringify({
                        depression: depressionScore,
                        anxiety: anxietyScore,
                        stress: stressScore,
                        depression_severity: getSeverityLevel(depressionScore, 'depression'),
                        anxiety_severity: getSeverityLevel(anxietyScore, 'anxiety'),
                        stress_severity: getSeverityLevel(stressScore, 'stress'),
                        answers: answers
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Enhanced AI tips response:', data);

                if (data.success && data.tips_box && data.tips_box.tips_content) {
                    console.log('Using enhanced AI-generated tips');
                    return {
                        tips: [{
                            title: data.tips_box.tips_title || 'Personalized Mental Health Tips',
                            description: data.tips_box.tips_content
                        }],
                        isAI: true,
                        source: data.tips_box.source
                    };
                } else {
                    console.warn('Enhanced AI tips generation failed, using fallback');
                    return generateFallbackTips(depressionScore, anxietyScore, stressScore);
                }
            } catch (error) {
                console.error('Error fetching enhanced AI tips:', error);
                return generateFallbackTips(depressionScore, anxietyScore, stressScore);
            }
        }

        // Fallback tips generation (original logic)
        function generateFallbackTips(depressionScore, anxietyScore, stressScore) {
            const tips = [];

            // Analyze severity levels
            const depressionLevel = getSeverityLevel(depressionScore, 'depression');
            const anxietyLevel = getSeverityLevel(anxietyScore, 'anxiety');
            const stressLevel = getSeverityLevel(stressScore, 'stress');

            // Priority-based tip generation
            if (depressionLevel !== 'normal') {
                tips.push({
                    title: "Build Daily Routine & Structure",
                    description: "Create a consistent daily schedule with regular meal times, study breaks, and sleep hours. Structure provides stability and helps combat feelings of hopelessness.",
                    priority: depressionLevel === 'extremely-severe' ? 1 : 2
                });
                tips.push({
                    title: "Practice Self-Compassion",
                    description: "Be kind to yourself during difficult times. Replace self-criticism with understanding - remember that it's okay to struggle and that healing takes time.",
                    priority: 2
                });
            }

            if (anxietyLevel !== 'normal') {
                tips.push({
                    title: "Deep Breathing & Grounding Techniques",
                    description: "Practice the 4-7-8 breathing method: inhale for 4 seconds, hold for 7 seconds, exhale for 8 seconds. This activates your parasympathetic nervous system and reduces anxiety.",
                    priority: anxietyLevel === 'extremely-severe' ? 1 : 2
                });
                tips.push({
                    title: "Challenge Anxious Thoughts",
                    description: "When anxiety spikes, ask yourself: 'Is this thought based on facts or fears?' Practice cognitive restructuring to replace irrational worries with realistic perspectives.",
                    priority: 2
                });
            }

            if (stressLevel !== 'normal') {
                tips.push({
                    title: "Time Management & Prioritization",
                    description: "Use techniques like the Eisenhower Matrix to prioritize tasks. Focus on what's truly important and learn to say 'no' to non-essential commitments.",
                    priority: stressLevel === 'extremely-severe' ? 1 : 2
                });
                tips.push({
                    title: "Progressive Muscle Relaxation",
                    description: "Systematically tense and relax different muscle groups in your body. Start with your toes and work up to your head - this reduces physical tension from stress.",
                    priority: 2
                });
            }

            // Always include these foundational tips
            tips.push({
                title: "Maintain Social Connections",
                description: "Reach out to trusted friends, family, or classmates regularly. Social support is crucial for mental health - even brief check-ins can make a significant difference.",
                priority: 3
            });

            tips.push({
                title: "Physical Activity & Movement",
                description: "Incorporate movement into your day - take short walks, stretch, or do simple exercises. Physical activity releases endorphins and improves mood naturally.",
                priority: 3
            });

            tips.push({
                title: "Healthy Sleep Habits",
                description: "Aim for 7-9 hours of quality sleep. Create a calming bedtime routine, avoid screens before bed, and maintain consistent sleep/wake times.",
                priority: 3
            });

            // Sort by priority (lower number = higher priority)
            tips.sort((a, b) => a.priority - b.priority);

            return tips.slice(0, 7); // Return top 7 tips
        }

        // Helper function to get severity level
        function getSeverityLevel(score, type) {
            if (type === 'depression') {
                if (score <= 9) return 'normal';
                if (score <= 13) return 'mild';
                if (score <= 20) return 'moderate';
                if (score <= 27) return 'severe';
                return 'extremely-severe';
            } else if (type === 'anxiety') {
                if (score <= 7) return 'normal';
                if (score <= 9) return 'mild';
                if (score <= 14) return 'moderate';
                if (score <= 19) return 'severe';
                return 'extremely-severe';
            } else if (type === 'stress') {
                if (score <= 14) return 'normal';
                if (score <= 18) return 'mild';
                if (score <= 25) return 'moderate';
                if (score <= 33) return 'severe';
                return 'extremely-severe';
            }
            return 'normal';
        }

        // Cache for AI tips to avoid redundant API calls
        const tipsCache = {};

        // Function to show tips loading state
        function showTipsLoading() {
            const tipsList = document.getElementById('tipsList');
            const tipsSection = document.getElementById('mentalHealthTips');

            if (!tipsList || !tipsSection) return;

            tipsList.innerHTML = `
                <div style="text-align: center; padding: 2rem; color: #666;">
                    <div class="ai-feedback-loading" style="justify-content: center; margin-bottom: 1rem;">
                        <span class="ai-spinner"></span>
                        <span>Generating personalized mental health tips...</span>
                    </div>
                    <p style="font-size: 0.9rem; margin: 0;">This may take a few seconds</p>
                </div>
            `;

            // Show the tips section
            tipsSection.style.display = 'block';
        }

        // Function to display personalized tips
        function displayPersonalizedTips(tipsData, isAI = false) {
            const tipsList = document.getElementById('tipsList');
            const tipsSection = document.getElementById('mentalHealthTips');
            const tipsSubtitle = document.getElementById('tipsSubtitle');

            if (!tipsList || !tipsSection) return;

            tipsList.innerHTML = '';

            // Handle different response formats
            let tips = [];
            let source = 'fallback';

            if (tipsData.tips && Array.isArray(tipsData.tips)) {
                // New enhanced AI format
                tips = tipsData.tips;
                source = tipsData.source || 'fallback';
                isAI = tipsData.isAI || source === 'openai';
            } else if (Array.isArray(tipsData)) {
                // Old format (array of tips)
                tips = tipsData;
            }

            // Update subtitle based on source
            if (tipsSubtitle) {
                if (source === 'cache') {
                    tipsSubtitle.textContent = 'Personalized recommendations from our enhanced AI system (cached for efficiency)';
                } else if (source === 'openai') {
                    tipsSubtitle.textContent = 'AI-powered recommendations based on your DASS21 results and personal context';
                } else {
                    tipsSubtitle.textContent = 'Evidence-based recommendations based on your assessment results';
                }
            }

            // Add tips
            tips.forEach((tip, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <strong>${tip.title || 'Mental Health Tip'}</strong>
                    <p>${tip.description || tip}</p>
                `;
                tipsList.appendChild(li);
            });

            // Add source indicator
            if (source !== 'fallback') {
                const sourceDiv = document.createElement('div');
                sourceDiv.style.cssText = `
                    margin-top: 1rem;
                    padding: 0.8rem;
                    background: rgba(46, 204, 113, 0.1);
                    border-left: 4px solid #2ecc71;
                    border-radius: 8px;
                    font-size: 0.85rem;
                    color: #27ae60;
                    line-height: 1.4;
                `;

                let sourceText = '';
                if (source === 'cache') {
                    sourceText = '<i class="bx bx-data"></i> <strong>Smart Caching:</strong> These recommendations were previously generated for similar profiles and retrieved instantly for efficiency.';
                } else if (source === 'openai') {
                    sourceText = '<i class="bx bx-brain"></i> <strong>AI-Enhanced:</strong> These recommendations were generated using advanced AI analysis of your responses.';
                }

                sourceDiv.innerHTML = sourceText;
                tipsList.appendChild(sourceDiv);
            }

            // Add disclaimer at the bottom
            const disclaimerDiv = document.createElement('div');
            disclaimerDiv.style.cssText = `
                margin-top: 2rem;
                padding: 1rem;
                background: rgba(241, 196, 15, 0.1);
                border-left: 4px solid #f39c12;
                border-radius: 8px;
                font-size: 0.85rem;
                color: #d68910;
                line-height: 1.4;
            `;
            disclaimerDiv.innerHTML = `
                <strong> Important Disclaimer:</strong> These recommendations are for informational purposes only and do not constitute professional medical advice, diagnosis, or treatment. They are not a substitute for qualified mental health care. If you're experiencing severe symptoms or distress, please consult with licensed healthcare professionals or contact emergency services immediately.
            `;
            tipsList.appendChild(disclaimerDiv);

            // Animate the tips section if it was hidden
            if (tipsSection.style.display !== 'block') {
                tipsSection.style.display = 'block';
                tipsSection.style.opacity = '0';
                tipsSection.style.transform = 'translateY(20px)';

                setTimeout(() => {
                    tipsSection.style.transition = 'all 0.6s ease';
                    tipsSection.style.opacity = '1';
                    tipsSection.style.transform = 'translateY(0)';
                }, 100);
            }
        }

        async function showResults() {
            console.log('showResults function called');
            calculateScores();
            console.log('Scores calculated:', scores);

            // Disable the scale buttons to prevent further interaction
            scaleBtns.forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
            });

            if (dassTest) dassTest.style.display = 'none';
            if (resultsContainer) resultsContainer.style.display = 'block';

            // Update scores (display multiplied scores for user)
            document.getElementById('depressionScore').textContent = scores.display_depression;
            document.getElementById('anxietyScore').textContent = scores.display_anxiety;
            document.getElementById('stressScore').textContent = scores.display_stress;

            // Update interpretations (pass display scores for UI)
            updateInterpretation('depression', scores.display_depression);
            updateInterpretation('anxiety', scores.display_anxiety);
            updateInterpretation('stress', scores.display_stress);

            // Update severity indicators (pass display scores for UI)
            updateSeverityIndicators('depression', scores.display_depression);
            updateSeverityIndicators('anxiety', scores.display_anxiety);
            updateSeverityIndicators('stress', scores.display_stress);

            // Show loading state for tips
            showTipsLoading();

            try {
                // Generate and display personalized tips using enhanced AI system
                const tipsResult = await generatePersonalizedTips(scores.display_depression, scores.display_anxiety, scores.display_stress);
                displayPersonalizedTips(tipsResult, tipsResult.isAI || false);
            } catch (error) {
                console.error('Error generating enhanced tips:', error);
                // Fallback to basic tips (use raw scores for fallback logic)
                const fallbackTips = generateFallbackTips(scores.depression, scores.anxiety, scores.stress);
                displayPersonalizedTips(fallbackTips, false);
            }

            // Auto-save results after a short delay
            console.log('Setting up auto-save timer...');
            setTimeout(() => {
                console.log('Auto-save timer triggered');
                autoSaveResults();
            }, 1000);
        }

        function updateInterpretation(type, score) {
            const interpretation = document.getElementById(`${type}Interpretation`);
            let text = '';
            let severity = '';

            // Use raw scores for severity calculation
            const rawScore = score / 2;

            if (type === 'depression') {
                if (rawScore <= 9) { text = 'Normal'; severity = 'normal'; }
                else if (rawScore <= 13) { text = 'Mild'; severity = 'mild'; }
                else if (rawScore <= 20) { text = 'Moderate'; severity = 'moderate'; }
                else if (rawScore <= 27) { text = 'Severe'; severity = 'severe'; }
                else { text = 'Extremely Severe'; severity = 'extremely-severe'; }
            } else if (type === 'anxiety') {
                if (rawScore <= 7) { text = 'Normal'; severity = 'normal'; }
                else if (rawScore <= 9) { text = 'Mild'; severity = 'mild'; }
                else if (rawScore <= 14) { text = 'Moderate'; severity = 'moderate'; }
                else if (rawScore <= 19) { text = 'Severe'; severity = 'severe'; }
                else { text = 'Extremely Severe'; severity = 'extremely-severe'; }
            } else if (type === 'stress') {
                if (rawScore <= 14) { text = 'Normal'; severity = 'normal'; }
                else if (rawScore <= 18) { text = 'Mild'; severity = 'mild'; }
                else if (rawScore <= 25) { text = 'Moderate'; severity = 'moderate'; }
                else if (rawScore <= 33) { text = 'Severe'; severity = 'severe'; }
                else { text = 'Extremely Severe'; severity = 'extremely-severe'; }
            }

            if (interpretation) {
                interpretation.textContent = text;
                interpretation.className = `score-interpretation ${severity}`;
            }
        }

        function updateSeverityIndicators(type, score) {
            const indicators = document.querySelectorAll(`.${type} .severity-dot`);
            let level = 0;

            // Use raw scores for severity indicator calculation
            const rawScore = score / 2;

            if (type === 'depression') {
                if (rawScore > 27) level = 4;
                else if (rawScore > 20) level = 3;
                else if (rawScore > 13) level = 2;
                else if (rawScore > 9) level = 1;
            } else if (type === 'anxiety') {
                if (rawScore > 19) level = 4;
                else if (rawScore > 14) level = 3;
                else if (rawScore > 9) level = 2;
                else if (rawScore > 7) level = 1;
            } else if (type === 'stress') {
                if (rawScore > 33) level = 4;
                else if (rawScore > 25) level = 3;
                else if (rawScore > 18) level = 2;
                else if (rawScore > 14) level = 1;
            }

            indicators.forEach((dot, index) => {
                dot.classList.toggle('active', index <= level);
            });
        }

        // Event Listeners
        scaleBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const value = parseInt(this.dataset.value);
                handleAnswer(value);
            });
        });


        // Function to show follow-up consent modal
        function showFollowupConsentModal(notification) {
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';

            let requestId = null;

            // Handle both string URLs and notification objects
            if (typeof notification === 'string') {
                // Legacy: extract from URL string
                const urlMatch = notification.match(/\/followup\/(\d+)\/consent/);
                requestId = urlMatch ? urlMatch[1] : null;
            } else if (typeof notification === 'object' && notification.type === 'followup' &&
                       notification.action_text !== 'View Report') {
                // Only show modal for follow-up notifications that should show modals (not "View Report")
                requestId = notification.metadata && notification.metadata.followup_request_id;
            }

            if (!requestId) {
                console.log('Redirecting to notification URL:', notification.url || notification);
                // For non-followup notifications or "View Report" followup notifications, navigate to URL if available
                const redirectUrl = typeof notification === 'string' ? notification : (notification.url || notification.action_url || '#');
                if (redirectUrl && redirectUrl !== '#') {
                    // Prevent navigation to current page (refresh)
                    const currentUrl = window.location.pathname;
                    if (redirectUrl === currentUrl || redirectUrl === window.location.href) {
                        console.log(' Preventing refresh to current page');
                        return;
                    }
                    console.log(' Navigating to URL from index.html:', redirectUrl);
                    window.location.href = redirectUrl;
                } else {
                    console.log(' No valid URL for notification, staying on page');
                }
                return;
            }

            fetch(`/followup/${requestId}/consent/`, {
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrfToken
                },
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Create modal
                    const modal = document.createElement('div');
                    modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:3000;display:flex;align-items:center;justify-content:center;';
                    modal.id = 'followupConsentModal';

                    const modalContent = document.createElement('div');
                    modalContent.style.cssText = 'background:white;padding:2rem;border-radius:20px;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 15px 50px rgba(0,0,0,0.2);position:relative;';

                    // Close button
                    const closeBtn = document.createElement('button');
                    closeBtn.innerHTML = '&times;';
                    closeBtn.style.cssText = 'position:absolute;top:15px;right:15px;background:none;border:none;font-size:24px;cursor:pointer;color:#999;';
                    closeBtn.onclick = () => document.body.removeChild(modal);

                    // Header
                    const header = document.createElement('div');
                    header.style.cssText = 'text-align:center;margin-bottom:2rem;';
                    header.innerHTML = `
                        <h2 style="color:#2c3e50;margin:0;font-size:1.8rem;font-weight:600;">Follow-up Session Consent</h2>
                        <p style="color:#666;margin:0.5rem 0 0;font-size:1rem;">Review and confirm your follow-up appointment</p>
                    `;

                    // Counselor info
                    const counselorInfo = document.createElement('div');
                    counselorInfo.style.cssText = 'display:flex;align-items:center;gap:1.5rem;margin-bottom:1.5rem;padding:1.5rem;background:rgba(46,204,113,0.1);border-radius:12px;';
                    counselorInfo.innerHTML = `
                        <img src="${data.counselor.image_url || '/static/mentalhealth/img/default.jpg'}" alt="${data.counselor.name}"
                             style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid #2ecc71;">
                        <div>
                            <h3 style="color:#2c3e50;margin:0 0 0.3rem;font-size:1.3rem;font-weight:600;">${data.counselor.name}</h3>
                            <p style="color:#666;margin:0 0 0.2rem;">${data.counselor.unit}</p>
                            <p style="color:#666;margin:0 0 0.2rem;">${data.counselor.rank}</p>
                        </div>
                    `;

                    // Appointment details
                    const appointmentDetails = document.createElement('div');
                    appointmentDetails.style.cssText = 'background:white;border-radius:12px;padding:1.5rem;box-shadow:0 3px 10px rgba(0,0,0,0.05);margin-bottom:2rem;';
                    appointmentDetails.innerHTML = `
                        <h4 style="color:#2c3e50;margin:0 0 1rem;font-size:1.2rem;font-weight:600;">Appointment Information</h4>
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem;">
                            <span style="font-weight:500;color:#555;">Date:</span>
                            <span style="font-weight:600;color:#2ecc71;">${data.appointment.date}</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem;">
                            <span style="font-weight:500;color:#555;">Time:</span>
                            <span style="font-weight:600;color:#2c3e50;">${data.appointment.time}</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem;">
                            <span style="font-weight:500;color:#555;">Session Type:</span>
                            <span style="font-weight:600;color:#2c3e50;">${data.appointment.session_type}</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem;">
                            <span style="font-weight:500;color:#555;">Services:</span>
                            <span style="font-weight:600;color:#2c3e50;">${data.appointment.services.join(', ')}</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <span style="font-weight:500;color:#555;">Reason:</span>
                            <span style="font-weight:600;color:#2c3e50;">${data.appointment.reason}</span>
                        </div>
                    `;

                    // Consent question
                    const consentQuestion = document.createElement('div');
                    consentQuestion.style.cssText = 'text-align:center;margin-bottom:2rem;';
                    consentQuestion.innerHTML = `
                        <h3 style="color:#2c3e50;font-size:1.4rem;margin-bottom:0.5rem;">Do you consent to this follow-up session?</h3>
                        <p style="color:#666;font-size:1rem;">Your participation will help continue your counseling journey and support your mental health goals.</p>
                    `;

                    // Action buttons
                    const actionButtons = document.createElement('div');
                    actionButtons.style.cssText = 'display:flex;justify-content:center;gap:2rem;margin-top:2rem;';

                    const consentBtn = document.createElement('button');
                    consentBtn.innerHTML = '<i class="bx bx-check"></i> Yes, I Consent';
                    consentBtn.style.cssText = 'padding:1.2rem 3rem;border-radius:12px;font-size:1.1rem;font-weight:600;cursor:pointer;border:none;background:linear-gradient(135deg,#2ecc71,#27ae60);color:white;box-shadow:0 5px 15px rgba(46,204,113,0.3);min-width:160px;';
                    consentBtn.onmouseover = () => consentBtn.style.transform = 'translateY(-3px)';
                    consentBtn.onmouseout = () => consentBtn.style.transform = 'translateY(0)';
                    consentBtn.onclick = () => submitConsent(requestId, true, modal);

                    const declineBtn = document.createElement('button');
                    declineBtn.innerHTML = '<i class="bx bx-x"></i> No, Decline';
                    declineBtn.style.cssText = 'padding:1.2rem 3rem;border-radius:12px;font-size:1.1rem;font-weight:600;cursor:pointer;border:none;background:linear-gradient(135deg,#e74c3c,#c0392b);color:white;box-shadow:0 5px 15px rgba(231,76,60,0.3);min-width:160px;';
                    declineBtn.onmouseover = () => declineBtn.style.transform = 'translateY(-3px)';
                    declineBtn.onmouseout = () => declineBtn.style.transform = 'translateY(0)';
                    declineBtn.onclick = () => {
                        if (confirm('Are you sure you want to decline this follow-up session? You can always request a new one later if needed.')) {
                            submitConsent(requestId, false, modal);
                        }
                    };

                    actionButtons.appendChild(consentBtn);
                    actionButtons.appendChild(declineBtn);

                    // Assemble modal
                    modalContent.appendChild(closeBtn);
                    modalContent.appendChild(header);
                    modalContent.appendChild(counselorInfo);
                    modalContent.appendChild(appointmentDetails);
                    modalContent.appendChild(consentQuestion);
                    modalContent.appendChild(actionButtons);
                    modal.appendChild(modalContent);

                    // Close modal when clicking outside
                    modal.onclick = (e) => {
                        if (e.target === modal) {
                            document.body.removeChild(modal);
                        }
                    };

                    document.body.appendChild(modal);
                } else {
                    alert('Error loading follow-up details: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error loading follow-up consent modal:', error);
                alert('Error loading follow-up details. Please try again.');
            });
        }

        // Function to submit consent
        function submitConsent(requestId, consentGiven, modal) {
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';

            fetch(`/followup/${requestId}/consent/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrfToken
                },
                body: `consent_given=${consentGiven}&csrfmiddlewaretoken=${csrfToken}`,
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Close modal
                    document.body.removeChild(modal);
                    // Refresh notifications
                    showNotificationDropdown();
                    updateNotificationBadge();
                    // Show success message
                    alert(data.message || 'Response recorded successfully');
                } else {
                    alert('Error: ' + (data.error || 'An error occurred'));
                }
            })
            .catch(error => {
                console.error('Error submitting consent:', error);
                alert('Error submitting response. Please try again.');
            });
        }

        // Profile dropdown functionality
        const profileImg = document.getElementById('profile-img');
        const profileDropdown = document.getElementById('profile-dropdown');

        console.log('Profile elements:', { profileImg, profileDropdown });

        if (profileImg && profileDropdown) {
            profileImg.addEventListener('click', function(e) {
                e.stopPropagation();
                console.log('Profile image clicked');
                const currentDisplay = profileDropdown.style.display;
                const newDisplay = currentDisplay === 'block' ? 'none' : 'block';
                profileDropdown.style.display = newDisplay;
                console.log('Dropdown display changed to:', newDisplay);
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                profileDropdown.style.display = 'none';
            });
        } else {
            console.error('Profile dropdown elements not found:', { profileImg, profileDropdown });
        }

        // Modal functionality
        const supportGroupsModal = document.getElementById('supportGroupsModal');
        const findGroupsBtn = document.getElementById('findGroupsBtn');
        const closeSupportGroupsModal = supportGroupsModal ? supportGroupsModal.querySelector('.close-modal') : null;

        if (findGroupsBtn && supportGroupsModal) {
            findGroupsBtn.addEventListener('click', function() {
                supportGroupsModal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            });
        }

        if (closeSupportGroupsModal && supportGroupsModal) {
            closeSupportGroupsModal.addEventListener('click', function() {
                supportGroupsModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
        }

        // Exercises Modal
        const exercisesModal = document.getElementById('exercisesModal');
        const startExercisesBtn = document.getElementById('startExercisesBtn');
        const closeExercisesModal = exercisesModal ? exercisesModal.querySelector('.close-modal') : null;

        if (startExercisesBtn && exercisesModal) {
            startExercisesBtn.addEventListener('click', function() {
                exercisesModal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            });
        }

        if (closeExercisesModal && exercisesModal) {
            closeExercisesModal.addEventListener('click', function() {
                exercisesModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // Close when clicking outside the modal
            window.addEventListener('click', function(e) {
                if (e.target === exercisesModal) {
                    exercisesModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        }

        // Support Groups Modal - add click outside functionality
        if (supportGroupsModal) {
            window.addEventListener('click', function(e) {
                if (e.target === supportGroupsModal) {
                    supportGroupsModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        }

        // PMR Exercise
        const startPmrBtn = document.getElementById('startPmrBtn');
        if (startPmrBtn) {
            startPmrBtn.addEventListener('click', function() {
                showPmrModal();
            });
        }

        function showPmrModal() {
            const pmrSteps = [
                "Sit or lie down in a comfortable position. Take a deep breath and let it out slowly.",
                "Focus on your feet. Tense the muscles in your feet as tightly as you can. Hold for 5 seconds... then relax.",
                "Now, tense your calf muscles. Hold for 5 seconds... then relax.",
                "Tense your thigh muscles. Hold for 5 seconds... then relax.",
                "Tense your glutes (buttocks). Hold for 5 seconds... then relax.",
                "Tense your stomach muscles. Hold for 5 seconds... then relax.",
                "Tense your hands into fists. Hold for 5 seconds... then relax.",
                "Tense your forearms. Hold for 5 seconds... then relax.",
                "Tense your upper arms. Hold for 5 seconds... then relax.",
                "Tense your shoulders. Hold for 5 seconds... then relax.",
                "Tense your neck muscles. Hold for 5 seconds... then relax.",
                "Tense your facial muscles. Hold for 5 seconds... then relax.",
                "Now scan your entire body. Notice how relaxed you feel. Take a few deep breaths and enjoy the feeling of relaxation."
            ];

            let currentStep = 0;
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:3000;display:flex;align-items:center;justify-content:center;';
            
            const content = document.createElement('div');
            content.style.cssText = 'background:white;padding:2rem;border-radius:12px;max-width:500px;text-align:center;position:relative;';
            
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '&times;';
            closeBtn.style.cssText = 'position:absolute;top:10px;right:15px;background:none;border:none;font-size:24px;cursor:pointer;';
            closeBtn.onclick = () => document.body.removeChild(modal);
            
            const stepText = document.createElement('p');
            stepText.style.cssText = 'font-size:1.1rem;margin:1rem 0;line-height:1.6;';
            stepText.textContent = pmrSteps[currentStep];
            
            const progress = document.createElement('div');
            progress.style.cssText = 'margin:1rem 0;font-size:0.9rem;color:#666;';
            progress.textContent = `Step ${currentStep + 1} of ${pmrSteps.length}`;
            
            const controls = document.createElement('div');
            controls.style.cssText = 'display:flex;gap:10px;justify-content:center;margin-top:1rem;';
            
            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'Previous';
            prevBtn.style.cssText = 'padding:0.5rem 1rem;border:none;border-radius:6px;background:#95a5a6;color:white;cursor:pointer;';
            prevBtn.disabled = true;
            
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Next';
            nextBtn.style.cssText = 'padding:0.5rem 1rem;border:none;border-radius:6px;background:#2ecc71;color:white;cursor:pointer;';
            
            function updateStep() {
                stepText.textContent = pmrSteps[currentStep];
                progress.textContent = `Step ${currentStep + 1} of ${pmrSteps.length}`;
                prevBtn.disabled = currentStep === 0;
                nextBtn.textContent = currentStep === pmrSteps.length - 1 ? 'Finish' : 'Next';
            }
            
            prevBtn.onclick = () => {
                if (currentStep > 0) {
                    currentStep--;
                    updateStep();
                }
            };
            
            nextBtn.onclick = () => {
                if (currentStep < pmrSteps.length - 1) {
                    currentStep++;
                    updateStep();
                } else {
                    document.body.removeChild(modal);
                }
            };
            
            controls.appendChild(prevBtn);
            controls.appendChild(nextBtn);
            content.appendChild(closeBtn);
            content.appendChild(stepText);
            content.appendChild(progress);
            content.appendChild(controls);
            modal.appendChild(content);
            document.body.appendChild(modal);
        }

        // Action buttons
        const retakeBtn = document.getElementById('retakeBtn');
        const saveBtn = document.getElementById('saveBtn');
        
        if (retakeBtn) {
            retakeBtn.addEventListener('click', initTest);
        }
        
        // Auto-save function
        async function autoSaveResults() {
            console.log('Auto-save function called with scores:', scores);
            try {
                // Calculate severity levels
                const depressionSeverity = scores.depression <= 9 ? 'Normal' : 
                                        scores.depression <= 13 ? 'Mild' : 
                                        scores.depression <= 20 ? 'Moderate' : 
                                        scores.depression <= 27 ? 'Severe' : 'Extremely Severe';
                
                const anxietySeverity = scores.anxiety <= 7 ? 'Normal' : 
                                      scores.anxiety <= 9 ? 'Mild' : 
                                      scores.anxiety <= 14 ? 'Moderate' : 
                                      scores.anxiety <= 19 ? 'Severe' : 'Extremely Severe';
                
                const stressSeverity = scores.stress <= 14 ? 'Normal' : 
                                     scores.stress <= 18 ? 'Mild' : 
                                     scores.stress <= 25 ? 'Moderate' : 
                                     scores.stress <= 33 ? 'Severe' : 'Extremely Severe';
                
                console.log('Sending data to server:', {
                    depression: scores.depression,
                    anxiety: scores.anxiety,
                    stress: scores.stress,
                    depression_severity: depressionSeverity,
                    anxiety_severity: anxietySeverity,
                    stress_severity: stressSeverity,
                    answers: answers
                });
                
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value;
                console.log('CSRF Token:', csrfToken ? 'Present' : 'Missing');
                
                const response = await fetch('/save-dass-results/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify({
                        depression: scores.depression,  // Raw scores for backend
                        anxiety: scores.anxiety,        // Raw scores for backend
                        stress: scores.stress,          // Raw scores for backend
                        depression_severity: depressionSeverity,
                        anxiety_severity: anxietySeverity,
                        stress_severity: stressSeverity,
                        answers: answers
                    })
                });
                
                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.status === 'success') {
                    console.log('Results auto-saved successfully!');
                    // Update the scheduler link with the display scores (for user-facing URLs)
                    const bookSessionBtn = document.getElementById('bookSessionBtn');
                    if (bookSessionBtn) {
                        bookSessionBtn.href = `/scheduler/?depression=${scores.display_depression}&anxiety=${scores.display_anxiety}&stress=${scores.display_stress}`;
                    }
                    // Update save button to show saved status
                    if (saveBtn) {
                        saveBtn.textContent = ' Results Saved';
                        saveBtn.style.background = '#27ae60';
                        saveBtn.disabled = true;
                    }
                    // Show success message
                    const saveStatus = document.getElementById('saveStatus');
                    if (saveStatus) {
                        saveStatus.style.display = 'block';
                    }
                } else {
                    console.error('Error auto-saving results:', data.message);
                    // Update save button to show error
                    if (saveBtn) {
                        saveBtn.textContent = 'Save Results';
                        saveBtn.style.background = '#e74c3c';
                    }
                }
            } catch (error) {
                console.error('Error auto-saving results:', error);
            }
        }

        if (saveBtn) {
            saveBtn.addEventListener('click', async function() {
                try {
                    // Calculate severity levels
                    const depressionSeverity = scores.depression <= 9 ? 'Normal' : 
                                            scores.depression <= 13 ? 'Mild' : 
                                            scores.depression <= 20 ? 'Moderate' : 
                                            scores.depression <= 27 ? 'Severe' : 'Extremely Severe';
                    
                    const anxietySeverity = scores.anxiety <= 7 ? 'Normal' : 
                                          scores.anxiety <= 9 ? 'Mild' : 
                                          scores.anxiety <= 14 ? 'Moderate' : 
                                          scores.anxiety <= 19 ? 'Severe' : 'Extremely Severe';
                    
                    const stressSeverity = scores.stress <= 14 ? 'Normal' : 
                                         scores.stress <= 18 ? 'Mild' : 
                                         scores.stress <= 25 ? 'Moderate' : 
                                         scores.stress <= 33 ? 'Severe' : 'Extremely Severe';
                    
                    const response = await fetch('/save-dass-results/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                        },
                        body: JSON.stringify({
                            depression: scores.depression,  // Raw scores for backend
                            anxiety: scores.anxiety,        // Raw scores for backend
                            stress: scores.stress,          // Raw scores for backend
                            depression_severity: depressionSeverity,
                            anxiety_severity: anxietySeverity,
                            stress_severity: stressSeverity,
                            answers: answers
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        alert('Results saved successfully!');
                        // Update the scheduler link with the display scores (for user-facing URLs)
                        const bookSessionBtn = document.getElementById('bookSessionBtn');
                        if (bookSessionBtn) {
                            bookSessionBtn.href = `/scheduler/?depression=${scores.display_depression}&anxiety=${scores.display_anxiety}&stress=${scores.display_stress}`;
                        }
                        // Update save button to show saved status
                        saveBtn.textContent = ' Results Saved';
                        saveBtn.style.background = '#27ae60';
                        saveBtn.disabled = true;
                        // Show success message
                        const saveStatus = document.getElementById('saveStatus');
                        if (saveStatus) {
                            saveStatus.style.display = 'block';
                        }
                    } else {
                        alert('Error saving results: ' + data.message);
                    }
                } catch (error) {
                    console.error('Error saving results:', error);
                    alert('Error saving results. Please try again.');
                }
            });
        }

        // ML Consent Modal close functionality
        const mlConsentModal = document.getElementById('mlConsentModal');
        const mlConsentCloseBtn = document.getElementById('mlConsentCloseBtn');
        const mlConsentCloseBtn2 = document.getElementById('mlConsentCloseBtn2');
        const mlConsentContinueBtn = document.getElementById('mlConsentContinueBtn');
        
        if (mlConsentModal) {
            // Close button (X) functionality
            if (mlConsentCloseBtn) {
                mlConsentCloseBtn.addEventListener('click', function() {
                    mlConsentModal.style.display = 'none';
                });
            }
            
            // Dismiss button functionality
            if (mlConsentCloseBtn2) {
                mlConsentCloseBtn2.addEventListener('click', function() {
                    mlConsentModal.style.display = 'none';
                });
            }
            
            // Continue button functionality
            if (mlConsentContinueBtn) {
                mlConsentContinueBtn.addEventListener('click', function() {
                    mlConsentModal.style.display = 'none';
                });
            }
            
            // Close when clicking outside the modal
            mlConsentModal.addEventListener('click', function(e) {
                if (e.target === mlConsentModal) {
                    mlConsentModal.style.display = 'none';
                }
            });
        }

        // Initialize the welcome modal first
        initWelcomeModal();
        
        // AI Feedback functionality
        let userConsentedToAI = false;
        
        // Track if user consented to AI feedback
        if (mlConsentContinueBtn) {
            mlConsentContinueBtn.addEventListener('click', function() {
                userConsentedToAI = true;
            });
        }
        
        async function fetchAIFeedback(depressionScore, anxietyScore, stressScore) {
            console.log('Fetching AI feedback for scores:', { depressionScore, anxietyScore, stressScore });
            try {
                // Use the answers object collected during the test
                console.log('Using collected answers for AI feedback:', answers);
                console.log('Total answers available:', Object.keys(answers).length);

                // Check if we have all answers
                if (Object.keys(answers).length !== 21) {
                    console.warn('Not all DASS21 questions answered. Available:', Object.keys(answers).length);
                }

                // Convert answers format for AI feedback (expects "q1", "q2", etc.)
                const aiAnswers = {};
                for (const [key, value] of Object.entries(answers)) {
                    aiAnswers[`q${key}`] = value;
                }

                const requestBody = {
                    depression: depressionScore / 2,  // Send raw scores to backend
                    anxiety: anxietyScore / 2,        // Send raw scores to backend
                    stress: stressScore / 2,          // Send raw scores to backend
                    answers: aiAnswers  // Use converted answers format for AI feedback
                };
                
                console.log('Sending request body:', requestBody);
                
                const response = await fetch('/api/ai-feedback/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('AI feedback response:', data);
                
                if (data.success) {
                    console.log('DASS analysis in response:', data.dass_analysis);
                    if (data.dass_analysis) {
                        console.log('Primary concerns:', data.dass_analysis.primary_concerns);
                        console.log('Coping patterns:', data.dass_analysis.coping_patterns);
                        console.log('Specific triggers:', data.dass_analysis.specific_triggers);
                    }
                    
                    return {
                        feedback: data.feedback,
                        source: data.source,
                        personalization_level: data.personalization_level,
                        dass_analysis: data.dass_analysis || {},
                        context_used: data.context_used || {}
                    };
                } else {
                    console.error('AI feedback error:', data.error);
                    return null;
                }
            } catch (error) {
                console.error('Error fetching AI feedback:', error);
                return null;
            }
        }
        
        function showAIFeedback(feedback) {
            console.log('Showing AI feedback:', feedback);
            console.log('Feedback dass_analysis:', feedback.dass_analysis);

            if (feedback.dass_analysis) {
                console.log('Primary concerns count:', feedback.dass_analysis.primary_concerns ? feedback.dass_analysis.primary_concerns.length : 0);
                console.log('Coping patterns count:', feedback.dass_analysis.coping_patterns ? feedback.dass_analysis.coping_patterns.length : 0);
                console.log('Specific triggers count:', feedback.dass_analysis.specific_triggers ? feedback.dass_analysis.specific_triggers.length : 0);

                if (feedback.dass_analysis.primary_concerns) {
                    console.log('Primary concerns:', feedback.dass_analysis.primary_concerns);
                }
            }

            // Use display scores for severity level calculations in the feedback display
            const depressionLevel = getSeverityLevel(scores.display_depression, 'depression');
            const anxietyLevel = getSeverityLevel(scores.display_anxiety, 'anxiety');
            const stressLevel = getSeverityLevel(scores.display_stress, 'stress');

            const currentAdviceCard = document.createElement('div');
            currentAdviceCard.className = 'resource-card ai-feedback-card';
            currentAdviceCard.style.cssText = `
                background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
                border-left: 4px solid #4caf50;
                margin-top: 1rem;
                padding: 1.5rem;
                border-radius: 12px;
                box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
                position: relative;
                overflow: hidden;
                opacity: 0;
                transform: translateY(20px);
                animation: slideInUp 0.6s ease forwards;
            `;

            // Build the HTML content
            let htmlContent = `
                <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
                     background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
                     animation: shimmer 3s infinite;"></div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="background: linear-gradient(135deg, #4caf50, #66bb6a); color: white; border-radius: 50%; width: 50px; height: 50px;
                             display: flex; align-items: center; justify-content: center; margin-right: 15px; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);">
                            <i class="fas fa-brain" style="font-size: 20px;"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0; color: #2e7d32; font-weight: 600; font-size: 1.2em;">Personalized AI Feedback</h4>
                            <p style="margin: 0; font-size: 0.9em; color: #666;">
                                <i class="fas fa-chart-line" style="margin-right: 5px;"></i>
                                Based on your DASS21 responses & academic context
                            </p>
                        </div>
                    </div>

                    <div style="margin-bottom: 1rem; padding: 15px; background: rgba(255,255,255,0.8);
                         border-radius: 10px; border-left: 4px solid #4caf50; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        ${feedback.feedback}
                    </div>
            `;

            // Add Key Concerns section if available
            if (feedback.dass_analysis && feedback.dass_analysis.primary_concerns && feedback.dass_analysis.primary_concerns.length > 0) {
                console.log('Adding Key Concerns section with', feedback.dass_analysis.primary_concerns.length, 'concerns');
                htmlContent += `
                    <div style="margin-top: 1rem; padding: 15px; background: rgba(255,255,255,0.6);
                         border-radius: 10px; border-left: 4px solid #ff9800; animation: fadeIn 0.8s ease 0.3s both;">
                        <h5 style="margin: 0 0 10px 0; color: #e65100; font-size: 1em; font-weight: 600;">
                            <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                            Key Concerns Identified
                        </h5>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #666;">
                `;

                feedback.dass_analysis.primary_concerns.slice(0, 3).forEach((concern, index) => {
                    htmlContent += `<li style="margin-bottom: 6px; animation: fadeIn 0.5s ease ${0.5 + index * 0.1}s both;">${concern.question} <span style="color: #e65100; font-weight: 500;">(${concern.severity})</span></li>`;
                });

                htmlContent += `
                        </ul>
                    </div>
                `;
            } else {
                console.log('No primary concerns to display, showing fallback concerns');
                // Fallback: Show general concerns based on display scores
                const concerns = [];
                if (scores.display_depression > 26) concerns.push('Depression symptoms (moderate to severe)');
                if (scores.display_anxiety > 18) concerns.push('Anxiety symptoms (moderate to severe)');
                if (scores.display_stress > 36) concerns.push('Stress symptoms (moderate to severe)');

                if (concerns.length > 0) {
                    htmlContent += `
                        <div style="margin-top: 1rem; padding: 15px; background: rgba(255,255,255,0.6);
                             border-radius: 10px; border-left: 4px solid #ff9800; animation: fadeIn 0.8s ease 0.3s both;">
                            <h5 style="margin: 0 0 10px 0; color: #e65100; font-size: 1em; font-weight: 600;">
                                <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                                Key Concerns Identified
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #666;">
                    `;

                    concerns.forEach((concern, index) => {
                        htmlContent += `<li style="margin-bottom: 6px; animation: fadeIn 0.5s ease ${0.5 + index * 0.1}s both;">${concern}</li>`;
                    });

                    htmlContent += `
                            </ul>
                        </div>
            `;
                }
            }

            // Add Coping Patterns section if available
            if (feedback.dass_analysis && feedback.dass_analysis.coping_patterns && feedback.dass_analysis.coping_patterns.length > 0) {
                console.log('Adding Coping Patterns section with', feedback.dass_analysis.coping_patterns.length, 'patterns');
                htmlContent += `
                    <div style="margin-top: 1rem; padding: 15px; background: rgba(255,255,255,0.6);
                         border-radius: 10px; border-left: 4px solid #2196f3; animation: fadeIn 0.8s ease 0.6s both;">
                        <h5 style="margin: 0 0 10px 0; color: #1565c0; font-size: 1em; font-weight: 600;">
                            <i class="fas fa-lightbulb" style="margin-right: 8px;"></i>
                            Coping Patterns Identified
                        </h5>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                `;

                feedback.dass_analysis.coping_patterns.forEach((pattern, index) => {
                    htmlContent += `<span style="background: rgba(33, 150, 243, 0.1); color: #1565c0; padding: 4px 10px; border-radius: 15px; font-size: 0.85em; font-weight: 500; animation: fadeIn 0.5s ease ${0.8 + index * 0.1}s both;">${pattern}</span>`;
                });

                htmlContent += `
                        </div>
                    </div>
                `;
            } else {
                console.log('No coping patterns to display');
            }

            // Add progress indicators
            const personalizationLevel = feedback.personalization_level || 'basic';
            const personalizationText = personalizationLevel === 'high' ? 'Highly Personalized' : 'Personalized';
            const personalizationColor = personalizationLevel === 'high' ? '#4caf50' : '#ff9800';

            // Close the main div
            htmlContent += `
                    <div style="margin-top: 1.5rem; padding: 12px; background: rgba(255,255,255,0.4);
                         border-radius: 8px; font-size: 0.85em; color: #666; text-align: center; animation: fadeIn 0.8s ease 0.9s both;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 5px;">
                            <i class="fas fa-shield-alt" style="color: ${personalizationColor};"></i>
                            <span style="color: ${personalizationColor}; font-weight: 600;">${personalizationText}</span>
                        </div>
                        <p style="margin: 0; font-size: 0.8em;">Using your academic context, test history, and specific DASS21 responses</p>
                    </div>
                </div>
            `;

            currentAdviceCard.innerHTML = htmlContent;

            // Add enhanced CSS animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInUp {
                    from { opacity: 0; transform: translateY(30px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                @keyframes shimmer {
                    0% { left: -100%; }
                    50% { left: 50%; }
                    100% { left: 100%; }
                }
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .ai-feedback-card:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
                    transition: all 0.3s ease;
                }
                .ai-feedback-card:hover .fa-brain {
                    animation: pulse 1s ease infinite;
                }
                @keyframes pulse {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.1); }
                    100% { transform: scale(1); }
                }
            `;
            document.head.appendChild(style);

            // Remove any existing AI feedback card
            const existingCard = document.querySelector('.ai-feedback-card');
            if (existingCard) {
                existingCard.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    if (existingCard.parentNode) {
                        existingCard.parentNode.removeChild(existingCard);
                    }
                }, 300);
            }

            // Add the new card to the results container with a delay
            setTimeout(() => {
                const resultsContainer = document.getElementById('resultsContainer');
                if (resultsContainer) {
                    resultsContainer.appendChild(currentAdviceCard);

                    // Smooth scroll to the feedback with offset
                    setTimeout(() => {
                        const elementTop = currentAdviceCard.getBoundingClientRect().top + window.pageYOffset;
                        window.scrollTo({ top: elementTop - 100, behavior: 'smooth' });
                    }, 100);
                } else {
                    console.error('Results container not found');
                }
            }, 100);
        }
        
        // Enhanced showResults function with AI-powered personalized tips
        const originalShowResults = showResults;
        showResults = async function() {
            console.log('showResults called');
            originalShowResults();

            // Show AI feedback if user consented or show for all users (you can change this logic)
            if (userConsentedToAI || true) { // Set to true to show for all users
                console.log('Attempting to fetch AI feedback');

                // Show loading state
                showAIFeedbackLoading();

                try {
                    const feedbackData = await fetchAIFeedback(scores.depression, scores.anxiety, scores.stress);
                    console.log('Feedback received:', feedbackData);
                    if (feedbackData && feedbackData.feedback) {
                        // Hide loading and show feedback with animation
                        hideAIFeedbackLoading();
                        setTimeout(() => showAIFeedback(feedbackData), 500);

                        // Enhance tips with AI insights if available
                        if (feedbackData.dass_analysis) {
                            enhanceTipsWithAI(feedbackData.dass_analysis, scores.display_depression, scores.display_anxiety, scores.display_stress);
                        }

                        // Log personalization details
                        if (feedbackData.context_used) {
                            console.log('Personalization context used:', feedbackData.context_used);
                        }
                        if (feedbackData.error) {
                            console.warn('AI feedback error:', feedbackData.error);
                        }
                } else {
                    console.log('No feedback received');
                    hideAIFeedbackLoading();
                    }
                } catch (error) {
                    console.error('Error fetching AI feedback:', error);
                    hideAIFeedbackLoading();
                    // Show a basic fallback message with animation
                    const fallbackData = {
                        feedback: "Thank you for completing the assessment. <b>Remember that your mental health is important, and it's okay to seek support when needed.</b>",
                        source: 'fallback',
                        personalization_level: 'basic'
                    };
                    setTimeout(() => showAIFeedback(fallbackData), 500);
                }
            } else {
                console.log('User did not consent to AI feedback');
            }
        };

        // Function to enhance tips with AI analysis
        function enhanceTipsWithAI(dassAnalysis, depressionScore, anxietyScore, stressScore) {
            const tipsSubtitle = document.getElementById('tipsSubtitle');
            if (tipsSubtitle && dassAnalysis.primary_concerns && dassAnalysis.primary_concerns.length > 0) {
                tipsSubtitle.textContent = `AI-powered recommendations tailored to your specific concerns`;
            }

            // If AI identifies specific coping patterns, we could add them to tips
            // For now, we'll keep the existing logic but this could be expanded
            console.log('AI analysis available for tip enhancement:', dassAnalysis, 'Scores:', { depressionScore, anxietyScore, stressScore });
        }

        // Function to show AI feedback loading state
        function showAIFeedbackLoading() {
            // Remove any existing AI feedback or loading
            const existingCard = document.querySelector('.ai-feedback-card, .ai-feedback-loading-container');
            if (existingCard) {
                existingCard.remove();
            }

            const loadingContainer = document.createElement('div');
            loadingContainer.className = 'ai-feedback-loading-container';
            loadingContainer.style.cssText = `
                background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                border-radius: 12px;
                padding: 2rem;
                margin-top: 1rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(46, 204, 113, 0.2);
                text-align: center;
                animation: fadeInUp 0.5s ease;
            `;

            loadingContainer.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                    <div style="background: linear-gradient(135deg, #2ecc71, #27ae60); border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);">
                        <i class="fas fa-brain" style="font-size: 24px; color: white;"></i>
                    </div>
                    <div class="ai-feedback-loading">
                        <span class="ai-spinner"></span>
                        <span style="margin-left: 0.5rem;">Analyzing your responses...</span>
                    </div>
                    <p style="color: #666; font-size: 0.9rem; margin: 0;">Generating personalized insights based on your DASS21 results</p>
                    <div style="width: 100%; max-width: 200px; height: 4px; background: rgba(0,0,0,0.1); border-radius: 2px; overflow: hidden;">
                        <div style="height: 100%; background: linear-gradient(90deg, #2ecc71, #27ae60); border-radius: 2px; animation: loadingBar 2s ease-in-out infinite;"></div>
                    </div>
                </div>
            `;

            // Add CSS animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInUp {
                    from { opacity: 0; transform: translateY(20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                @keyframes loadingBar {
                    0% { width: 0%; }
                    50% { width: 70%; }
                    100% { width: 100%; }
                }
            `;
            document.head.appendChild(style);

            // Add to results container
            const resultsContainer = document.getElementById('resultsContainer');
            if (resultsContainer) {
                resultsContainer.appendChild(loadingContainer);
                loadingContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // Function to hide AI feedback loading state
        function hideAIFeedbackLoading() {
            const loadingContainer = document.querySelector('.ai-feedback-loading-container');
            if (loadingContainer) {
                loadingContainer.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    if (loadingContainer.parentNode) {
                        loadingContainer.parentNode.removeChild(loadingContainer);
                    }
                }, 300);
            }
        }

        // Global notification click handler - wait for notification manager to be ready
        function setupNotificationHandler() {
            console.log(' Setting up index page notification handler');

            window.handleNotificationClick = function(notification) {
                console.log(' Index page handling notification click:', notification);

                // Check if user is a counselor
                const isCounselor = document.body.dataset.userIsCounselor === 'true';
                console.log(' Index page - User is counselor:', isCounselor, 'Data attribute:', document.body.dataset.userIsCounselor);

                // Handle follow-up notifications differently based on user type
                if (notification.type === 'followup') {
                    console.log(' Index page handling follow-up notification for', isCounselor ? 'counselor' : 'student');

                    if (isCounselor) {
                        // For counselors, try to show the scheduled follow-up modal
                        console.log(' Counselor attempting to show scheduled follow-up modal');

                        // Check if notification manager is available
                        if (window.notificationManager && typeof window.notificationManager.showScheduledFollowupModal === 'function') {
                            console.log(' Notification manager available, showing modal');

                            // Mark as read
                            window.notificationManager.markAsRead(notification.id);

                            // Extract followup_request_id from metadata
                            let followupRequestId = null;
                            if (notification.metadata) {
                                if (typeof notification.metadata === 'string') {
                                    try {
                                        const metadata = JSON.parse(notification.metadata);
                                        followupRequestId = metadata.followup_request_id;
                                    } catch (e) {
                                        console.warn('Failed to parse notification metadata:', e);
                                    }
                                } else if (notification.metadata.followup_request_id) {
                                    followupRequestId = notification.metadata.followup_request_id;
                                }
                            }

                            if (followupRequestId) {
                                console.log(' Using followup request ID:', followupRequestId);
                                window.notificationManager.showScheduledFollowupModal(followupRequestId, notification.metadata);
                                return; // Prevent navigation
                            } else {
                                console.warn(' No followup request ID found in notification');
                            }
                        } else {
                            console.warn(' Notification manager not available or showScheduledFollowupModal not found');
                        }

                        // Fallback: navigate to follow-up sessions page
                        console.log(' Falling back to navigation for counselor follow-up notification');
                        const url = notification.action_url || notification.url || '/followup-sessions/';
                        if (url && url !== '#') {
                            console.log(' Counselor navigating to:', url);
                            window.location.href = url;
                            return;
                        }
                    } else {
                        // Students should see the consent modal
                        console.log(' Student opening follow-up modal for notification:', notification.id);
                        if (window.notificationManager && typeof window.notificationManager.showFollowupConsentModal === 'function') {
                            window.notificationManager.showFollowupConsentModal(notification);
                            return; // Prevent navigation
                        } else {
                            console.warn(' Notification manager not available for student consent modal');
                        }
                    }
                } else {
                    // For non-followup notifications, navigate to URL if available
                    const url = notification.action_url || notification.url || '#';
                    if (url && url !== '#') {
                        // Prevent navigation to current page (refresh)
                        const currentUrl = window.location.pathname;
                        if (url === currentUrl || url === window.location.href) {
                            console.log(' Preventing refresh to current page');
                            return;
                        }
                        console.log(' Navigating to URL from index page:', url);
                        window.location.href = url;
                    } else {
                        console.log(' No valid URL for notification, staying on page');
                    }
                }
            };

            console.log(' Index page notification handler set up successfully');
        }

        // Wait for notification manager to be initialized before setting up handler
        function waitForNotificationManager() {
            if (window.notificationManager && typeof window.notificationManager.showScheduledFollowupModal === 'function') {
                console.log(' Notification manager is ready, setting up handler');
                setupNotificationHandler();
            } else {
                console.log(' Waiting for notification manager...');
                let attempts = 0;
                const maxAttempts = 50; // 5 seconds max

                const checkManager = setInterval(() => {
                    attempts++;
                    if (window.notificationManager && typeof window.notificationManager.showScheduledFollowupModal === 'function') {
                        clearInterval(checkManager);
                        console.log(' Notification manager now ready, setting up handler');
                        setupNotificationHandler();
                    } else if (attempts >= maxAttempts) {
                        clearInterval(checkManager);
                        console.error(' Timeout waiting for notification manager, setting up handler anyway');
                        setupNotificationHandler();
                    }
                }, 100);
            }
        }

        // Settings Manager Class
        class SettingsManager {
            constructor() {
                this.settings = {};
                this.apiEndpoint = '/api/settings/';
                this.init();
            }

            init() {
                this.bindEvents();
                this.loadSettings();
            }

            bindEvents() {
                // Settings modal triggers
                const settingsLink = document.getElementById('settings-link');
                if (settingsLink) {
                    settingsLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.openModal();
                    });
                }

                // Modal controls
                const closeBtn = document.getElementById('settingsCloseBtn');
                const cancelBtn = document.getElementById('cancelSettingsBtn');
                const saveBtn = document.getElementById('saveSettingsBtn');
                const resetBtn = document.getElementById('resetSettingsBtn');

                if (closeBtn) closeBtn.addEventListener('click', () => this.closeModal());
                if (cancelBtn) cancelBtn.addEventListener('click', () => this.closeModal());
                if (saveBtn) saveBtn.addEventListener('click', () => this.saveSettings());
                if (resetBtn) resetBtn.addEventListener('click', () => this.resetSettings());

                // Close on outside click
                const modal = document.getElementById('settingsModal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) this.closeModal();
                    });
                }

                // Real-time setting changes
                this.bindSettingChanges();
            }

            bindSettingChanges() {
                // Dark mode toggle
                const darkModeToggle = document.getElementById('darkModeToggle');
                if (darkModeToggle) {
                    darkModeToggle.addEventListener('change', (e) => {
                        this.applySetting('dark_mode', e.target.checked);
                    });
                }

                // Font size select
                const fontSizeSelect = document.getElementById('fontSizeSelect');
                if (fontSizeSelect) {
                    fontSizeSelect.addEventListener('change', (e) => {
                        this.applySetting('font_size', e.target.value);
                    });
                }

                // High contrast toggle
                const highContrastToggle = document.getElementById('highContrastToggle');
                if (highContrastToggle) {
                    highContrastToggle.addEventListener('change', (e) => {
                        this.applySetting('high_contrast', e.target.checked);
                    });
                }

                // Reduced motion toggle
                const reducedMotionToggle = document.getElementById('reducedMotionToggle');
                if (reducedMotionToggle) {
                    reducedMotionToggle.addEventListener('change', (e) => {
                        this.applySetting('reduced_motion', e.target.checked);
                    });
                }

                // Screen reader toggle
                const screenReaderToggle = document.getElementById('screenReaderToggle');
                if (screenReaderToggle) {
                    screenReaderToggle.addEventListener('change', (e) => {
                        this.applySetting('screen_reader', e.target.checked);
                    });
                }
            }

            async loadSettings() {
                try {
                    const response = await fetch(this.apiEndpoint, {
                        method: 'GET',
                        headers: {
                            'X-CSRFToken': this.getCsrfToken(),
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.settings = data.settings;
                        this.populateForm(data.settings);
                        this.applySettings(data.settings);
                    } else {
                        throw new Error(data.error || 'Failed to load settings');
                    }
                } catch (error) {
                    console.warn('API failed, loading from localStorage:', error);
                    this.loadFromLocalStorage();
                }
            }

            loadFromLocalStorage() {
                const stored = localStorage.getItem('userSettings');
                if (stored) {
                    try {
                        this.settings = JSON.parse(stored);
                        this.populateForm(this.settings);
                        this.applySettings(this.settings);
                    } catch (e) {
                        console.error('Error parsing stored settings:', e);
                        this.loadDefaults();
                    }
                } else {
                    this.loadDefaults();
                }
            }

            loadDefaults() {
                this.settings = {
                    dark_mode: false,
                    font_size: 'medium',
                    language: 'en',
                    high_contrast: false,
                    screen_reader: false,
                    reduced_motion: false,
                    analytics_tracking: true,
                    profile_visibility: 'counselors_only',
                    notification_preferences: {
                        assignment_reminders: { enabled: true, frequency: 'daily' },
                        grade_updates: { enabled: true, frequency: 'weekly' },
                        study_session_alerts: { enabled: true, frequency: 'daily' },
                        appointment_reminders: { enabled: true, frequency: 'daily' },
                        followup_notifications: { enabled: true, frequency: 'weekly' }
                    }
                };
                this.populateForm(this.settings);
                this.applySettings(this.settings);
            }

            populateForm(settings) {
                // Basic settings
                const darkModeToggle = document.getElementById('darkModeToggle');
                const fontSizeSelect = document.getElementById('fontSizeSelect');
                const languageSelect = document.getElementById('languageSelect');
                const highContrastToggle = document.getElementById('highContrastToggle');
                const screenReaderToggle = document.getElementById('screenReaderToggle');
                const reducedMotionToggle = document.getElementById('reducedMotionToggle');
                const analyticsToggle = document.getElementById('analyticsToggle');
                const profileVisibilitySelect = document.getElementById('profileVisibilitySelect');

                if (darkModeToggle) darkModeToggle.checked = settings.dark_mode || false;
                if (fontSizeSelect) fontSizeSelect.value = settings.font_size || 'medium';
                if (languageSelect) languageSelect.value = settings.language || 'en';
                if (highContrastToggle) highContrastToggle.checked = settings.high_contrast || false;
                if (screenReaderToggle) screenReaderToggle.checked = settings.screen_reader || false;
                if (reducedMotionToggle) reducedMotionToggle.checked = settings.reduced_motion || false;
                if (analyticsToggle) analyticsToggle.checked = settings.analytics_tracking !== false;
                if (profileVisibilitySelect) profileVisibilitySelect.value = settings.profile_visibility || 'counselors_only';

                // Notification preferences
                const notifications = settings.notification_preferences || {};
                this.populateNotificationSetting('assignmentReminders', notifications.assignment_reminders);
                this.populateNotificationSetting('gradeUpdates', notifications.grade_updates);
                this.populateNotificationSetting('studySessionAlerts', notifications.study_session_alerts);
                this.populateNotificationSetting('appointmentReminders', notifications.appointment_reminders);
                this.populateNotificationSetting('followupNotifications', notifications.followup_notifications);
            }

            populateNotificationSetting(key, setting) {
                const enabledEl = document.getElementById(key + 'Enabled') || document.getElementById(key);
                const freqEl = document.getElementById(key + 'Freq') || document.getElementById(key + 'Frequency');

                if (enabledEl) enabledEl.checked = setting ? setting.enabled !== false : true;
                if (freqEl) freqEl.value = setting ? setting.frequency || 'daily' : 'daily';
            }

            applySettings(settings) {
                // Apply visual settings immediately
                this.applySetting('dark_mode', settings.dark_mode);
                this.applySetting('font_size', settings.font_size);
                this.applySetting('high_contrast', settings.high_contrast);
                this.applySetting('reduced_motion', settings.reduced_motion);
                this.applySetting('screen_reader', settings.screen_reader);
            }

            applySetting(key, value) {
                switch (key) {
                    case 'dark_mode':
                        document.body.classList.toggle('dark-mode', value);
                        break;
                    case 'font_size':
                        // Remove existing font size classes
                        document.body.classList.remove('font-small', 'font-medium', 'font-large', 'font-extra-large');
                        if (value && value !== 'medium') {
                            document.body.classList.add(`font-${value.replace('_', '-')}`);
                        }
                        break;
                    case 'high_contrast':
                        document.body.classList.toggle('high-contrast', value);
                        break;
                    case 'reduced_motion':
                        document.body.classList.toggle('reduced-motion', value);
                        break;
                    case 'screen_reader':
                        document.body.classList.toggle('screen-reader', value);
                        break;
                }
            }

            async saveSettings() {
                // Collect form data
                const settingsData = this.collectFormData();

                try {
                    const response = await fetch(this.apiEndpoint, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': this.getCsrfToken(),
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(settingsData)
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.settings = settingsData;
                        localStorage.setItem('userSettings', JSON.stringify(settingsData));
                        this.showMessage('Settings saved successfully!', 'success');
                        this.closeModal();
                    } else {
                        throw new Error(data.error || 'Failed to save settings');
                    }
                } catch (error) {
                    console.warn('API save failed, saving to localStorage:', error);
                    localStorage.setItem('userSettings', JSON.stringify(settingsData));
                    this.settings = settingsData;
                    this.showMessage('Settings saved locally. Some features may not be available offline.', 'warning');
                    this.closeModal();
                }
            }

            collectFormData() {
                return {
                    dark_mode: document.getElementById('darkModeToggle')?.checked || false,
                    font_size: document.getElementById('fontSizeSelect')?.value || 'medium',
                    language: document.getElementById('languageSelect')?.value || 'en',
                    high_contrast: document.getElementById('highContrastToggle')?.checked || false,
                    screen_reader: document.getElementById('screenReaderToggle')?.checked || false,
                    reduced_motion: document.getElementById('reducedMotionToggle')?.checked || false,
                    analytics_tracking: document.getElementById('analyticsToggle')?.checked !== false,
                    profile_visibility: document.getElementById('profileVisibilitySelect')?.value || 'counselors_only',
                    notification_preferences: {
                        assignment_reminders: {
                            enabled: document.getElementById('assignmentRemindersEnabled')?.checked !== false,
                            frequency: document.getElementById('assignmentRemindersFreq')?.value || 'daily'
                        },
                        grade_updates: {
                            enabled: document.getElementById('gradeUpdatesEnabled')?.checked !== false,
                            frequency: document.getElementById('gradeUpdatesFreq')?.value || 'weekly'
                        },
                        study_session_alerts: {
                            enabled: document.getElementById('studySessionAlertsEnabled')?.checked !== false,
                            frequency: document.getElementById('studySessionAlertsFreq')?.value || 'daily'
                        },
                        appointment_reminders: {
                            enabled: document.getElementById('appointmentRemindersEnabled')?.checked !== false,
                            frequency: document.getElementById('appointmentRemindersFreq')?.value || 'daily'
                        },
                        followup_notifications: {
                            enabled: document.getElementById('followupNotificationsEnabled')?.checked !== false,
                            frequency: document.getElementById('followupNotificationsFreq')?.value || 'weekly'
                        }
                    }
                };
            }

            async resetSettings() {
                if (!confirm('Are you sure you want to reset all settings to defaults? This action cannot be undone.')) {
                    return;
                }

                try {
                    const response = await fetch('/api/settings/reset/', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': this.getCsrfToken(),
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.loadDefaults();
                        this.showMessage('Settings reset to defaults successfully!', 'success');
                    } else {
                        throw new Error(data.error || 'Failed to reset settings');
                    }
                } catch (error) {
                    console.warn('API reset failed, resetting locally:', error);
                    this.loadDefaults();
                    this.showMessage('Settings reset locally.', 'warning');
                }
            }

            openModal() {
                const modal = document.getElementById('settingsModal');
                if (modal) {
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            }

            closeModal() {
                const modal = document.getElementById('settingsModal');
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            }

            showMessage(message, type = 'info') {
                // Create a simple alert for now - could be enhanced with a proper notification system
                const colors = {
                    success: '#2ecc71',
                    warning: '#f39c12',
                    error: '#e74c3c',
                    info: '#3498db'
                };

                // Use browser alert for simplicity
                alert(message);
            }

            getCsrfToken() {
                const token = document.querySelector('[name=csrfmiddlewaretoken]');
                return token ? token.value : '';
            }
        }

        // Initialize notification handler after DOM and notification manager are ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', waitForNotificationManager);
        } else {
            waitForNotificationManager();
        }

        // Settings Modal Functionality
        const settingsModal = document.getElementById('settingsModal');
        const closeSettingsModal = document.getElementById('closeSettingsModal');
        const cancelSettingsBtn = document.getElementById('cancelSettingsBtn');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const resetSettingsBtn = document.getElementById('resetSettingsBtn');

        // Profile dropdown settings trigger
        const settingsLink = document.getElementById('settings-link');
        if (settingsLink) {
            settingsLink.addEventListener('click', function(e) {
                e.preventDefault();
                openSettingsModal();
            });
        }

        // Modal event listeners
        if (closeSettingsModal) {
            closeSettingsModal.addEventListener('click', closeSettingsModalFunc);
        }
        if (cancelSettingsBtn) {
            cancelSettingsBtn.addEventListener('click', closeSettingsModalFunc);
        }
        if (saveSettingsBtn) {
            saveSettingsBtn.addEventListener('click', saveSettings);
        }
        if (resetSettingsBtn) {
            resetSettingsBtn.addEventListener('click', resetSettings);
        }

        // Close modal when clicking outside
        if (settingsModal) {
            settingsModal.addEventListener('click', function(e) {
                if (e.target === settingsModal) {
                    closeSettingsModalFunc();
                }
            });
        }

        // Settings state management
        let originalSettings = {};

        function openSettingsModal() {
            loadSettings();
            if (settingsModal) {
                settingsModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeSettingsModalFunc() {
            if (settingsModal) {
                settingsModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        async function loadSettings() {
            try {
                const response = await fetch('/api/settings/', {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                if (data.success) {
                    // Store original settings for comparison
                    originalSettings = { ...data.settings };

                    // Populate form fields
                    document.getElementById('darkModeToggle').checked = data.settings.dark_mode;
                    document.getElementById('fontSizeSelect').value = data.settings.font_size;
                    document.getElementById('languageSelect').value = data.settings.language;
                    document.getElementById('highContrastToggle').checked = data.settings.high_contrast;
                    document.getElementById('screenReaderToggle').checked = data.settings.screen_reader;
                    document.getElementById('reducedMotionToggle').checked = data.settings.reduced_motion;
                    document.getElementById('analyticsTrackingToggle').checked = data.settings.analytics_tracking;
                    document.getElementById('profileVisibilitySelect').value = data.settings.profile_visibility;

                    // Notification preferences
                    const notifications = data.settings.notification_preferences || {};
                    document.getElementById('assignmentRemindersEnabled').checked = notifications.assignment_reminders?.enabled ?? true;
                    document.getElementById('assignmentRemindersFreq').value = notifications.assignment_reminders?.frequency || 'daily';
                    document.getElementById('gradeUpdatesEnabled').checked = notifications.grade_updates?.enabled ?? true;
                    document.getElementById('gradeUpdatesFreq').value = notifications.grade_updates?.frequency || 'weekly';
                    document.getElementById('studySessionAlertsEnabled').checked = notifications.study_session_alerts?.enabled ?? true;
                    document.getElementById('studySessionAlertsFreq').value = notifications.study_session_alerts?.frequency || 'daily';
                    document.getElementById('appointmentRemindersEnabled').checked = notifications.appointment_reminders?.enabled ?? true;
                    document.getElementById('appointmentRemindersFreq').value = notifications.appointment_reminders?.frequency || 'daily';
                    document.getElementById('followupNotificationsEnabled').checked = notifications.followup_notifications?.enabled ?? true;
                    document.getElementById('followupNotificationsFreq').value = notifications.followup_notifications?.frequency || 'weekly';

                    // Apply current settings to UI
                    applySettingsToUI(data.settings);
                } else {
                    // Fallback to localStorage
                    loadSettingsFromLocalStorage();
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                loadSettingsFromLocalStorage();
            }
        }

        function loadSettingsFromLocalStorage() {
            const settings = JSON.parse(localStorage.getItem('userSettings') || '{}');

            // Populate form with localStorage data or defaults
            document.getElementById('darkModeToggle').checked = settings.dark_mode || false;
            document.getElementById('fontSizeSelect').value = settings.font_size || 'medium';
            document.getElementById('languageSelect').value = settings.language || 'en';
            document.getElementById('highContrastToggle').checked = settings.high_contrast || false;
            document.getElementById('screenReaderToggle').checked = settings.screen_reader || false;
            document.getElementById('reducedMotionToggle').checked = settings.reduced_motion || false;
            document.getElementById('analyticsTrackingToggle').checked = settings.analytics_tracking !== false;
            document.getElementById('profileVisibilitySelect').value = settings.profile_visibility || 'counselors_only';

            // Notification preferences
            const notifications = settings.notification_preferences || {};
            document.getElementById('assignmentRemindersEnabled').checked = notifications.assignment_reminders?.enabled ?? true;
            document.getElementById('assignmentRemindersFreq').value = notifications.assignment_reminders?.frequency || 'daily';
            document.getElementById('gradeUpdatesEnabled').checked = notifications.grade_updates?.enabled ?? true;
            document.getElementById('gradeUpdatesFreq').value = notifications.grade_updates?.frequency || 'weekly';
            document.getElementById('studySessionAlertsEnabled').checked = notifications.study_session_alerts?.enabled ?? true;
            document.getElementById('studySessionAlertsFreq').value = notifications.study_session_alerts?.frequency || 'daily';
            document.getElementById('appointmentRemindersEnabled').checked = notifications.appointment_reminders?.enabled ?? true;
            document.getElementById('appointmentRemindersFreq').value = notifications.appointment_reminders?.frequency || 'daily';
            document.getElementById('followupNotificationsEnabled').checked = notifications.followup_notifications?.enabled ?? true;
            document.getElementById('followupNotificationsFreq').value = notifications.followup_notifications?.frequency || 'weekly';

            applySettingsToUI(settings);
        }

        async function saveSettings() {
            const settingsData = {
                dark_mode: document.getElementById('darkModeToggle').checked,
                font_size: document.getElementById('fontSizeSelect').value,
                language: document.getElementById('languageSelect').value,
                high_contrast: document.getElementById('highContrastToggle').checked,
                screen_reader: document.getElementById('screenReaderToggle').checked,
                reduced_motion: document.getElementById('reducedMotionToggle').checked,
                analytics_tracking: document.getElementById('analyticsTrackingToggle').checked,
                profile_visibility: document.getElementById('profileVisibilitySelect').value,
                notification_preferences: {
                    assignment_reminders: {
                        enabled: document.getElementById('assignmentRemindersEnabled').checked,
                        frequency: document.getElementById('assignmentRemindersFreq').value
                    },
                    grade_updates: {
                        enabled: document.getElementById('gradeUpdatesEnabled').checked,
                        frequency: document.getElementById('gradeUpdatesFreq').value
                    },
                    study_session_alerts: {
                        enabled: document.getElementById('studySessionAlertsEnabled').checked,
                        frequency: document.getElementById('studySessionAlertsFreq').value
                    },
                    appointment_reminders: {
                        enabled: document.getElementById('appointmentRemindersEnabled').checked,
                        frequency: document.getElementById('appointmentRemindersFreq').value
                    },
                    followup_notifications: {
                        enabled: document.getElementById('followupNotificationsEnabled').checked,
                        frequency: document.getElementById('followupNotificationsFreq').value
                    }
                }
            };

            try {
                const response = await fetch('/api/settings/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settingsData)
                });

                const data = await response.json();
                if (data.success) {
                    // Save to localStorage as backup
                    localStorage.setItem('userSettings', JSON.stringify(settingsData));

                    // Apply settings to UI
                    applySettingsToUI(settingsData);

                    // Show success message
                    alert('Settings saved successfully!');
                    closeSettingsModalFunc();
                } else {
                    alert('Error saving settings: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                // Save to localStorage as fallback
                localStorage.setItem('userSettings', JSON.stringify(settingsData));
                applySettingsToUI(settingsData);
                alert('Settings saved locally. Some features may not be available offline.');
                closeSettingsModalFunc();
            }
        }

        async function resetSettings() {
            if (!confirm('Are you sure you want to reset all settings to defaults? This action cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch('/api/settings/reset/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                if (data.success) {
                    // Reload settings
                    loadSettings();
                    alert('Settings reset to defaults successfully!');
                } else {
                    alert('Error resetting settings: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error resetting settings:', error);
                alert('Error resetting settings. Please try again.');
            }
        }

        function applySettingsToUI(settings) {
            // Apply dark mode
            document.body.classList.toggle('dark-mode', settings.dark_mode);

            // Apply font size
            document.body.className = document.body.className.replace(/font-size-\w+/g, '');
            if (settings.font_size && settings.font_size !== 'medium') {
                document.body.classList.add(`font-size-${settings.font_size}`);
            }

            // Apply high contrast
            document.body.classList.toggle('high-contrast', settings.high_contrast);

            // Apply reduced motion
            document.body.classList.toggle('reduced-motion', settings.reduced_motion);

            // Apply screen reader optimizations
            document.body.classList.toggle('screen-reader', settings.screen_reader);
        }

        // Load settings on page load
        loadSettingsFromLocalStorage();

        // Initialize Settings Manager
        const settingsManager = new SettingsManager();
    });
  </script>
</body>
</html>