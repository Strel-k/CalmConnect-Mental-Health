<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css">
    {% load static %}
    <link rel="icon" type="image/x-icon" href="{% static 'mentalhealth/img/favicon.png' %}">
    <title>Register | CalmConnect</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        /* Animated background elements */
        body::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 25% 25%, rgba(46, 204, 113, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(52, 152, 219, 0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        /* Header Styles */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .hdr {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .hdr-logo h2 {
            color: #2ecc71;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .hdr-logo a {
            text-decoration: none;
        }

        .hdr-btns {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .back-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        /* Main Content */
        .register-main-bdy {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            height: calc(100vh - 80px);
            padding: 0.5rem;
        }

        .register-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 0;
            width: 100%;
            max-width: 1200px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            position: relative;
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            min-height: 350px;
        }

        /* Welcome Section */
        .register-welcome {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 2.5rem 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .register-welcome::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 40%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            animation: welcomeFloat 15s ease-in-out infinite;
        }

        @keyframes welcomeFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(20px, -20px) rotate(180deg); }
        }

        .welcome-content {
            position: relative;
            z-index: 2;
        }

        .welcome-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 50%;
            margin-bottom: 2rem;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .register-welcome h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .register-welcome p {
            font-size: 1.2rem;
            opacity: 0.9;
            line-height: 1.6;
            margin-bottom: 2.5rem;
        }
        .error-message {
    display: none;
    color: #e74c3c;
    font-size: 0.9rem;
    margin-top: 0.5rem;
}

.error {
    border-color: #e74c3c !important;
}
        .feature-list {
            list-style: none;
            text-align: left;
        }

        .feature-list li {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 1rem;
            opacity: 0.9;
        }

        .feature-list li i {
            margin-right: 1rem;
            font-size: 1.3rem;
        }

        /* Register Form Section */
        .register-form-section {
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            max-height: 100vh;
            overflow-y: auto;
        }

        .register-form h2 {
            color: #2c3e50;
            font-size: 2.3rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            text-align: center;
        }

        .register-subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 2.5rem;
            font-size: 1.1rem;
        }

        /* Form Steps */
        .form-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 2.5rem;
            gap: 1.5rem;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .step.active {
            background: #2ecc71;
            color: white;
        }

        .step.completed {
            background: #27ae60;
            color: white;
        }

        /* Form Sections */
        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .input-group {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .input-group.full-width {
            grid-column: 1 / -1;
        }

        .input-group i {
            position: absolute;
            left: 1.2rem;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 1.2rem;
            transition: color 0.3s ease;
            z-index: 10;
        }

        .register-form input,
        .register-form select {
            width: 100%;
            padding: 1.3rem 1.3rem 1.3rem 3.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1.1rem;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
        }

        .register-form input:focus,
        .register-form select:focus {
            outline: none;
            border-color: #2ecc71;
            box-shadow: 0 0 0 4px rgba(46, 204, 113, 0.1);
            background: rgba(255, 255, 255, 1);
        }

        .register-form input:focus + i,
        .register-form select:focus + i {
            color: #2ecc71;
        }

        /* Email input group styling */
        .email-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .email-input-group input {
            padding-right: 180px;
        }

        .email-domain {
            position: absolute;
            right: 1.2rem;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 1.1rem;
            font-weight: 500;
            background: rgba(46, 204, 113, 0.1);
            padding: 0.4rem 1rem;
            border-radius: 10px;
            border: 1px solid rgba(46, 204, 113, 0.2);
        }

        .email-note {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.8rem;
            font-style: italic;
        }

        /* Navigation Buttons */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            gap: 1.5rem;
        }

        .nav-btn {
            flex: 1;
            padding: 1.3rem;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .prev-btn {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e0e0e0;
        }

        .prev-btn:hover {
            background: #e9ecef;
            border-color: #ced4da;
        }

        .next-btn, .register-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .next-btn::before, .register-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .next-btn:hover::before, .register-btn:hover::before {
            left: 100%;
        }

        .next-btn:hover, .register-btn:hover {
            background: linear-gradient(135deg, #27ae60, #229954);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.3);
        }

        .register-btn:active {
            transform: translateY(0);
        }

        .login-link {
            text-align: center;
            color: #666;
            font-size: 1rem;
            margin-top: 1.5rem;
        }

        .login-link a {
            color: #2ecc71;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .login-link a:hover {
            color: #27ae60;
            text-decoration: underline;
        }

        /* Loading Animation */
        .loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success animation */
        .success-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(46, 204, 113, 0.9);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .success-content {
            text-align: center;
            color: white;
        }

        .success-content i {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: successPulse 0.6s ease;
        }

        @keyframes successPulse {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Error styling */
        .error {
            border-color: #e74c3c !important;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1) !important;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .register-container {
                grid-template-columns: 1fr;
                max-width: 500px;
            }

            .register-welcome {
                padding: 2rem 1.5rem;
                order: 2;
            }

            .register-welcome h2 {
                font-size: 1.8rem;
            }

            .welcome-icon {
                font-size: 3rem;
            }

            .register-form-section {
                padding: 2rem 1.5rem;
                order: 1;
            }

            .feature-list {
                display: none;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .email-input-group input {
                padding-right: 120px;
            }

            .email-domain {
                font-size: 0.9rem;
                padding: 0.2rem 0.6rem;
            }
        }

        @media (max-width: 480px) {
            .register-main-bdy {
                padding: 1rem;
            }

            .hdr {
                padding: 1rem;
            }

            .register-form-section {
                padding: 1.5rem 1rem;
            }

            .register-welcome {
                padding: 1.5rem 1rem;
            }

            .email-input-group input {
                padding-right: 100px;
            }

            .email-domain {
                font-size: 0.8rem;
                padding: 0.2rem 0.4rem;
            }
        }
        .password-requirements {
    margin: 10px 0;
    font-size: 0.8rem;
    color: #666;
}

.password-requirements ul {
    list-style: none;
    padding-left: 5px;
}

.password-requirements li {
    position: relative;
    padding-left: 20px;
}

.password-requirements li:before {
    content: "✗";
    position: absolute;
    left: 0;
    color: #e74c3c;
}

.password-requirements li.valid:before {
    content: "✓";
    color: #2ecc71;
}

/* Password Requirements Display Styles */
.password-requirements-display {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 15px;
    margin: 15px 0;
    font-size: 0.85rem;
}

.requirements-title {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
    color: #2c3e50;
    font-weight: 600;
}

.requirements-title i {
    color: #2ecc71;
    font-size: 1.1rem;
}

.requirements-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.requirements-list li {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    color: #666;
    transition: color 0.3s ease;
}

.requirements-list li i {
    font-size: 0.8rem;
    color: #ccc;
    transition: color 0.3s ease;
}

.requirements-list li.valid {
    color: #2ecc71;
}

.requirements-list li.valid i {
    color: #2ecc71;
}

.requirements-list li.invalid {
    color: #e74c3c;
}

.requirements-list li.invalid i {
    color: #e74c3c;
}
.verification-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.verification-content {
    background: white;
    border-radius: 20px;
    padding: 2.5rem;
    max-width: 500px;
    width: 90%;
    text-align: center;
    animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.verification-content i {
    font-size: 3rem;
    color: #2ecc71;
    margin-bottom: 1rem;
}

.verification-content h2 {
    color: #2c3e50;
    margin-bottom: 1rem;
}

.verification-content p {
    color: #666;
    margin-bottom: 0.5rem;
}

#verificationEmail {
    font-weight: 600;
    color: #3498db;
}

.verification-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    justify-content: center;
}

.verification-note {
    font-size: 0.85rem;
    color: #999;
    margin-top: 1.5rem;
}
    </style>
</head>
<body>
    <header>
        <div class="hdr">
            <div class="hdr-logo">
                <a href="index.html"><h2>CalmConnect</h2></a>
            </div>
           
        </div>
    </header>

     <main class="register-main-bdy">
        <div class="register-container">
            <div class="register-welcome">
                <div class="welcome-content">
                    <img src="{% static 'img/osa-logo.jpg' %}" alt="Welcome Image" class="welcome-image">
                    <h2>Welcome!</h2>
                    <p>Join our community and start your journey to better mental wellness today.</p>
                    <ul class="feature-list">
                        <li><i class="bx bx-check-circle"></i> Track your progress</li>
                        <li><i class="bx bx-check-circle"></i> Access personalized resources</li>
                        <li><i class="bx bx-check-circle"></i> Connect with support</li>
                        <li><i class="bx bx-check-circle"></i> Monitor your wellness</li>
                    </ul>
                </div>
            </div>

            <div class="register-form-section">
                <form class="register-form" method="post" id="registerForm" action="{% url 'register' %}">
                    {% csrf_token %}

                    <h2>Create Account</h2>
                    <p class="register-subtitle">Fill in your details to get started</p>
                    
                    <!-- Progress Steps -->
                    <div class="form-steps">
                        <div class="step active" data-step="1">1</div>
                        <div class="step" data-step="2">2</div>
                        <div class="step" data-step="3">3</div>
                    </div>

                    <!-- Step 1: Account Information -->
                    <!-- Step 1: Account Information -->
<div class="form-section active" data-section="1">
    <div class="input-group">
        <input type="text" id="username" name="username" placeholder="Username" data-required
               value="{{ form.username.value|default:'' }}">
        <i class="bx bx-user"></i>
        {% if form.username.errors %}
            <div class="error-message django-error-message">{{ form.username.errors.0 }}</div>
        {% endif %}
    </div>
    
    <div class="input-group email-input-group">
        <input type="text" id="emailPrefix" name="email_prefix" placeholder="Email username" 
               data-required pattern="[a-zA-Z0-9._\-]+" 
               title="Only letters, numbers, dots, hyphens, and underscores allowed"
               value="{{ form.email_prefix.value|default:'' }}">
        <span class="email-domain">@clsu2.edu.ph</span>
        <i class="bx bx-envelope"></i>
        <div class="error-message django-error-message" id="emailError">
            {% if form.email.errors %}{{ form.email.errors.0 }}{% endif %}
        </div>
    </div>
    <div class="email-note">Use your CLSU institutional email address</div>
    
    <div class="form-row">
        <div class="input-group">
            <input type="password" id="password1" name="password1" placeholder="Password" data-required>
            <i class="bx bx-lock-alt"></i>
            {% if form.password1.errors %}
                <div class="error-message django-error-message">{{ form.password1.errors.0 }}</div>
            {% endif %}
        </div>
        
        <div class="input-group">
            <input type="password" id="password2" name="password2" placeholder="Confirm Password" data-required>
            <i class="bx bx-lock-alt"></i>
            {% if form.password2.errors %}
                <div class="error-message django-error-message">{{ form.password2.errors.0 }}</div>
            {% endif %}
        </div>
    </div>
    
    <!-- Password Requirements Display -->
    <div class="password-requirements-display">
        <div class="requirements-title">
            <i class="bx bx-shield-check"></i>
            <strong>Password Requirements:</strong>
        </div>
        <ul class="requirements-list">
            <li id="req-length" data-requirement="length">
                <i class="bx bx-circle"></i>
                At least 8 characters long
            </li>
            <li id="req-username" data-requirement="username">
                <i class="bx bx-circle"></i>
                Cannot be too similar to your username
            </li>
            <li id="req-common" data-requirement="common">
                <i class="bx bx-circle"></i>
                Cannot be a commonly used password
            </li>
            <li id="req-numeric" data-requirement="numeric">
                <i class="bx bx-circle"></i>
                Cannot be entirely numeric
            </li>
        </ul>
    </div>
</div>

<!-- Step 2: Personal Information -->
<div class="form-section" data-section="2">
    <div class="input-group">
        <input type="text" id="fullName" name="full_name" placeholder="Full Name" data-required
               value="{{ form.full_name.value|default:'' }}">
        <i class="bx bx-user-circle"></i>
        {% if form.full_name.errors %}
            <div class="error-message django-error-message">{{ form.full_name.errors.0 }}</div>
        {% endif %}
    </div>
    
    <div class="form-row">
        <div class="input-group">
            <input type="text" id="studentId" name="student_id" placeholder="Student ID" data-required
                   value="{{ form.student_id.value|default:'' }}">
            <i class="bx bx-id-card"></i>
            {% if form.student_id.errors %}
                <div class="error-message django-error-message">{{ form.student_id.errors.0 }}</div>
            {% endif %}
        </div>
        
        <div class="input-group">
            <input type="number" id="age" name="age" placeholder="Age" min="15" data-required
                   value="{{ form.age.value|default:'' }}">
            <i class="bx bx-calendar"></i>
            {% if form.age.errors %}
                <div class="error-message django-error-message">{{ form.age.errors.0 }}</div>
            {% endif %}
        </div>
    </div>

    <div class="input-group">
        <select id="gender" name="gender" data-required>
            <option value="">Select Gender</option>
            {% for value, name in form.fields.gender.choices %}
                <option value="{{ value }}" {% if form.gender.value == value %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>
        <i class="bx bx-male-female"></i>
        {% if form.gender.errors %}
            <div class="error-message django-error-message">{{ form.gender.errors.0 }}</div>
        {% endif %}
    </div>
</div>

<!-- Step 3: Academic Information -->
<div class="form-section" data-section="3">
    <div class="input-group">
        <select id="college" name="college" data-required>
            <option value="">Select College</option>
            {% for value, name in form.fields.college.choices %}
                <option value="{{ value }}" {% if form.college.value == value %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>
        <i class="bx bx-building"></i>
        {% if form.college.errors %}
            <div class="error-message django-error-message">{{ form.college.errors.0 }}</div>
        {% endif %}
    </div>

    <div class="input-group">
        <select id="program" name="program" data-required>
            <option value="">Select a College First</option>
            {% if form.program.value %}
                <option value="{{ form.program.value }}" selected>{{ form.program.value }}</option>
            {% endif %}
        </select>
        <i class="bx bx-book"></i>
        {% if form.program.errors %}
            <div class="error-message django-error-message">{{ form.program.errors.0 }}</div>
        {% endif %}
    </div>

    <div class="input-group">
        <select id="year" name="year_level" data-required>
            <option value="">Select Year Level</option>
            {% for value, name in form.fields.year_level.choices %}
                <option value="{{ value }}" {% if form.year_level.value == value %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>
        <i class="bx bx-medal"></i>
        {% if form.year_level.errors %}
            <div class="error-message django-error-message">{{ form.year_level.errors.0 }}</div>
        {% endif %}
    </div>
</div>
                    
                    <!-- Navigation Buttons -->
                    <div class="form-navigation">
                        <button type="button" class="nav-btn prev-btn" id="prevBtn" style="display: none;">Previous</button>
                        <button type="button" class="nav-btn next-btn" id="nextBtn">Next</button>
                        <button type="submit" class="nav-btn register-btn" id="submitBtn" style="display: none;">
                            <span class="btn-text">Create Account</span>
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </button>
                    </div>
                    
                    <div class="login-link">
                        Already have an account? <a href="{% url 'login' %}">Sign in here</a>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Success Animation -->
    <div class="success-animation" id="successAnimation">
        <div class="success-content">
            <i class="bx bx-check-circle"></i>
            <h2>Welcome to CalmConnect!</h2>
            <p>Redirecting to your dashboard...</p>
        </div>
    </div>
<div class="verification-modal" id="verificationModal">
    <div class="verification-content">
        <i class="bx bx-envelope"></i>
        <h2>Verify Your Email</h2>
        <p>We've sent a verification link to <span id="verificationEmail"></span></p>
        <p>Please check your inbox and click the link to complete your registration.</p>
        
        <div class="verification-actions">
            <button type="button" class="nav-btn" id="closeVerificationModal">Got It</button>
            <button type="button" class="nav-btn next-btn" id="resendVerificationBtn">
                <span>Resend Email</span>
                <div class="loading" style="display: none;">
                    <div class="spinner"></div>
                </div>
            </button>
        </div>
        
        <div class="verification-note">
            Didn't receive the email? Check your spam folder or try resending.
        </div>
    </div>
</div>
    <script>
       // College-Program mapping from Django context
const collegePrograms = {
    'CASS': [
        'Bachelor of Arts in English',
        'Bachelor of Arts in Literature',
        'Bachelor of Arts in Social Sciences',
        'Bachelor of Arts in Development Communication',
        'Bachelor of Arts in Psychology'
    ],
    'CEN': [
        'Bachelor of Science in Civil Engineering',
        'Bachelor of Science in Information Technology',
        'Bachelor of Science in Agricultural Biosystems Engineering',
    ],
    'CBA': [
        'Bachelor of Science in Accountancy',
        'Bachelor of Science in Business Administration',
        'Bachelor of Science in Entrepreneurship',
        'Bachelor of Science in Management Accounting'
    ],
    'COF': [
        'Bachelor of Science in Fisheries'
    ],
    'CAG': [
        'Bachelor of Science in Agriculture',
        'Bachelor of Science in Agribusiness',
        'Bachelor of Science in Animal Science',
        'Bachelor of Science in Crop Science'
    ],
    'CHSI': [
        'Bachelor of Science in Food Technology',
        'Bachelor of Science in Fashion and Textile Technology',
        'Bachelor of Science in Hospitality Management',
        'Bachelor of Science in Tourism Management'
    ],
    'CED': [
        'Bachelor of Elementary Education',
        'Bachelor of Secondary Education',
        'Bachelor of Cultural and Arts Education',
        'Bachelor of Early Childhood Education',
    ],
    'COS': [
        'Bachelor of Science in Biology',
        'Bachelor of Science in Chemistry',
        'Bachelor of Science in Environmental Science',
        'Bachelor of Science in Mathematics',
        'Bachelor of Science in Statistics',
        'Bachelor of Science in Meteorology'
    ],
    'CVSM': [
        'Doctor of Veterinary Medicine'
    ]
};

// Form step management
let currentStep = 1;
const totalSteps = 3;

const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const submitBtn = document.getElementById('submitBtn');
const btnText = document.querySelector('#submitBtn .btn-text');
const loading = document.querySelector('#submitBtn .loading');
const formDataStore = {};
// Update program dropdown when college changes
document.getElementById('college').addEventListener('change', function() {
    const college = this.value;
    const programSelect = document.getElementById('program');
    
    // Clear existing options
    programSelect.innerHTML = '<option value="">Select a Program</option>';
    
    if (college && collegePrograms[college]) {
        collegePrograms[college].forEach(program => {
            const option = document.createElement('option');
            option.value = program;
            option.textContent = program;
            programSelect.appendChild(option);
        });
    }
});

function saveCurrentStepData() {
    const currentSection = document.querySelector(`[data-section="${currentStep}"]`);
    if (currentSection) {
        const inputs = currentSection.querySelectorAll('input, select');
        inputs.forEach(input => {
            formDataStore[input.name] = input.value;
        });
    }
}

function restoreStepData(step) {
    const section = document.querySelector(`[data-section="${step}"]`);
    if (section) {
        const inputs = section.querySelectorAll('input, select');
        inputs.forEach(input => {
            if (formDataStore[input.name]) {
                input.value = formDataStore[input.name];
            }
        });
    }
}
// Step navigation
function showStep(step) {
    // Save data from current step before switching
    saveCurrentStepData();
    
    // Hide all sections
    document.querySelectorAll('.form-section').forEach(section => {
        if (section) section.classList.remove('active');
    });
    
    // Show current section
    const currentSection = document.querySelector(`[data-section="${step}"]`);
    if (currentSection) {
        currentSection.classList.add('active');
        // Restore data for this step
        restoreStepData(step);
    }
    
    // Update step indicators
    document.querySelectorAll('.step').forEach((stepEl, index) => {
        if (stepEl) {
            stepEl.classList.remove('active', 'completed');
            if (index + 1 < step) {
                stepEl.classList.add('completed');
            } else if (index + 1 === step) {
                stepEl.classList.add('active');
            }
        }
    });
    
    // Update navigation buttons
    if (prevBtn) prevBtn.style.display = step === 1 ? 'none' : 'block';
    if (nextBtn) nextBtn.style.display = step === totalSteps ? 'none' : 'block';
    if (submitBtn) submitBtn.style.display = step === totalSteps ? 'block' : 'none';
}

// Validate current step
function validateStep(step) {
    const section = document.querySelector(`[data-section="${step}"]`);
    if (!section) return false;

    const inputs = section.querySelectorAll('input[data-required], select[data-required]');
    let isValid = true;

    // Clear previous errors
    section.querySelectorAll('.error-message').forEach(el => {
        el.style.display = 'none';
    });

    // Validate required fields
    for (let input of inputs) {
        input.classList.remove('error');
        
        if (!input.value.trim()) {
            input.classList.add('error');
            const errorElement = input.closest('.input-group')?.querySelector('.error-message');
            if (errorElement) {
                errorElement.textContent = 'This field is required';
                errorElement.style.display = 'block';
            }
            isValid = false;
        }
    }

    // Additional validation for step 1
    if (step === 1) {
        const password1 = document.getElementById('password1');
        const password2 = document.getElementById('password2');
        
        if (password1 && password2 && password1.value !== password2.value) {
            password1.classList.add('error');
            password2.classList.add('error');
            const errorElement = password2.closest('.input-group')?.querySelector('.error-message');
            if (errorElement) {
                errorElement.textContent = 'Passwords do not match!';
                errorElement.style.display = 'block';
            }
            isValid = false;
        }
    }

    return isValid;
}


// Next button click
nextBtn.addEventListener('click', function() {
    // Validate current step before proceeding
    if (validateStep(currentStep)) {
        currentStep++;
        showStep(currentStep);
    }
});

// Previous button click
prevBtn.addEventListener('click', function() {
    currentStep--;
    showStep(currentStep);
});

// Check username availability
async function checkUsernameAvailability(username) {
    try {
        const response = await fetch("{% url 'validate_field_ajax' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                field: 'username',
                value: username
            })
        });
        return await response.json();
    } catch (error) {
        console.error('Error checking username:', error);
        return { valid: false, errors: ['Unable to validate username'] };
    }
}

// Validate password
function validatePassword(password) {
    if (password.length < 8) {
        return {
            valid: false,
            message: "Password must be at least 8 characters long"
        };
    }
    return { valid: true };
}

// Password requirements validation
function validatePasswordRequirements(password) {
    const username = document.getElementById('username')?.value || '';
    
    const requirements = {
        length: password.length >= 8,
        username: !password.toLowerCase().includes(username.toLowerCase()) && username.length > 0,
        common: !isCommonPassword(password),
        numeric: !/^\d+$/.test(password)
    };
    
    // Update UI for each requirement
    const reqElements = {
        length: document.getElementById('req-length'),
        username: document.getElementById('req-username'),
        common: document.getElementById('req-common'),
        numeric: document.getElementById('req-numeric')
    };
    
    // Update each requirement element
    Object.keys(requirements).forEach(req => {
        const element = reqElements[req];
        if (element) {
            const icon = element.querySelector('i');
            if (requirements[req]) {
                element.classList.add('valid');
                element.classList.remove('invalid');
                if (icon) icon.className = 'bx bx-check-circle';
            } else {
                element.classList.add('invalid');
                element.classList.remove('valid');
                if (icon) icon.className = 'bx bx-circle';
            }
        }
    });
    
    return requirements;
}

// Check if password is commonly used
function isCommonPassword(password) {
    const commonPasswords = [
        'password', '123456', '123456789', 'qwerty', 'abc123',
        'password123', 'admin', 'letmein', 'welcome', 'monkey',
        'dragon', 'master', 'hello', 'freedom', 'whatever',
        'qazwsx', 'trustno1', 'jordan', 'harley', 'ranger',
        'jennifer', 'hunter', 'buster', 'soccer', 'baseball',
        'tiger', 'charlie', 'andrew', 'michelle', 'love',
        'sunshine', 'jessica', 'asshole', 'magic', 'shadow',
        'michael', 'mustang', 'superman', 'batman', 'spider'
    ];
    return commonPasswords.includes(password.toLowerCase());
}

// Form submission
document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Show loading state
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    const btnText = submitBtn.querySelector('.btn-text');
    const loading = submitBtn.querySelector('.loading');
    btnText.style.opacity = '0';
    loading.style.display = 'block';
    
    try {
        // Email will be constructed in the form's clean method

        const response = await fetch(this.action, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: new FormData(this)
        });
        
        // First check if response is JSON
        const contentType = response.headers.get('content-type');
        if (contentType && contentType.includes('application/json')) {
            const data = await response.json();
            
            if (data.success) {
                // Always show modal on success
                showVerificationModal(data.email || '');
            } else {
                // Handle form errors
                handleFormErrors(data.errors || { general: data.error });
            }
        } else {
            // If not JSON, handle as HTML response
            const html = await response.text();
            if (response.redirected) {
                // If Django redirected, follow the redirect
                window.location.href = response.url;
            } else {
                // Otherwise replace content (fallback for non-JS)
                document.open();
                document.write(html);
                document.close();
            }
        }
    } catch (error) {
        console.error('Registration failed:', error);
        handleFormErrors({ general: 'An unexpected error occurred. Please try again.' });
    } finally {
        submitBtn.disabled = false;
        if (btnText) btnText.style.opacity = '1';
        if (loading) loading.style.display = 'none';
    }
});

// Enhanced modal show function
function showVerificationModal(email) {
    const modal = document.getElementById('verificationModal');
    const emailSpan = document.getElementById('verificationEmail');
    
    if (!modal || !emailSpan) {
        // Fallback if modal elements don't exist
        alert(`Verification email sent to ${email}. Please check your inbox.`);
        window.location.href = "{% url 'verify_prompt' %}";
        return;
    }
    
    emailSpan.textContent = email;
    modal.style.display = 'flex';
    
    // Close modal after 10 seconds if not manually closed
    setTimeout(() => {
        if (modal.style.display !== 'none') {
            modal.style.display = 'none';
            window.location.href = "{% url 'verify_prompt' %}";
        }
    }, 10000);
}

// Error handling function
function handleFormErrors(errors) {
    // Clear previous errors
    document.querySelectorAll('.error-message').forEach(el => {
        el.style.display = 'none';
    });
    document.querySelectorAll('.error').forEach(el => {
        el.classList.remove('error');
    });

    // Show new errors
    for (const [field, errorList] of Object.entries(errors)) {
        const input = document.querySelector(`[name="${field}"]`);
        const errorElement = input?.closest('.input-group')?.querySelector('.error-message');
        
        if (input && errorElement) {
            input.classList.add('error');
            errorElement.textContent = errorList[0]?.message || errorList[0];
            errorElement.style.display = 'block';
        } else if (field === 'general') {
            // Show general error message at top of form
            const errorContainer = document.querySelector('.register-form');
            const errorElement = document.createElement('div');
            errorElement.className = 'error-message';
            errorElement.style.color = '#e74c3c';
            errorElement.style.marginBottom = '1rem';
            errorElement.style.textAlign = 'center';
            errorElement.textContent = errorList[0]?.message || errorList[0];
            errorContainer.prepend(errorElement);
        }
    }
}

// Add these new functions for verification modal
function showVerificationModal(email) {
    const modal = document.getElementById('verificationModal');
    const emailSpan = document.getElementById('verificationEmail');
    
    if (emailSpan) emailSpan.textContent = email;
    if (modal) modal.style.display = 'flex';
}

function hideVerificationModal() {
    const modal = document.getElementById('verificationModal');
    if (modal) modal.style.display = 'none';
}

// Close modal button
document.getElementById('closeVerificationModal')?.addEventListener('click', hideVerificationModal);

// Resend verification email
document.getElementById('resendVerificationBtn')?.addEventListener('click', async function() {
    const btn = this;
    const btnText = btn.querySelector('span');
    const loading = btn.querySelector('.loading');
    
    btn.disabled = true;
    if (btnText) btnText.style.opacity = '0';
    if (loading) loading.style.display = 'block';
    
    try {
        const email = document.getElementById('verificationEmail').textContent;
        const response = await fetch("{% url 'resend_verification' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email: email })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.error || 'Failed to resend verification email');
        }
        
        alert('Verification email resent successfully!');
    } catch (error) {
        console.error('Error resending verification:', error);
        alert(error.message || 'An error occurred while resending the verification email');
    } finally {
        btn.disabled = false;
        if (btnText) btnText.style.opacity = '1';
        if (loading) loading.style.display = 'none';
    }
});

// Email input validation
document.getElementById('emailPrefix').addEventListener('input', function() {
    const emailError = document.getElementById('emailError');
    const emailPattern = /^[a-zA-Z0-9._\-]+$/;
    
    if (!emailPattern.test(this.value)) {
        this.classList.add('error');
        if (emailError) {
            emailError.textContent = 'Only letters, numbers, dots, hyphens, and underscores allowed';
            emailError.style.display = 'block';
        }
    } else {
        this.classList.remove('error');
        if (emailError) {
            emailError.style.display = 'none';
        }
    }
});

// Password input validation
const passwordInput = document.getElementById('password1');
if (passwordInput) {
    passwordInput.addEventListener('input', function() {
        validatePasswordRequirements(this.value);
    });
}

// Input focus effects
const inputs = document.querySelectorAll('.register-form input, .register-form select');
inputs.forEach(input => {
    input.addEventListener('focus', function() {
        const icon = this.parentElement.querySelector('i');
        if (icon) {
            icon.style.color = '#2ecc71';
        }
    });
    
    input.addEventListener('blur', function() {
        const icon = this.parentElement.querySelector('i');
        if (icon && !this.value) {
            icon.style.color = '#999';
        }
    });

    // Form validation feedback
    input.addEventListener('input', function() {
        const icon = this.parentElement.querySelector('i');
        if (this.validity.valid && this.value.trim()) {
            this.style.borderColor = '#2ecc71';
            if (icon) icon.style.color = '#2ecc71';
        } else if (this.value.length > 0) {
            this.style.borderColor = '#e74c3c';
            if (icon) icon.style.color = '#e74c3c';
        } else {
            this.style.borderColor = '#e0e0e0';
            if (icon) icon.style.color = '#999';
        }
    });
});

// Password visibility toggle
function togglePasswordVisibility(inputId) {
    const passwordInput = document.getElementById(inputId);
    const icon = passwordInput.parentElement.querySelector('i');
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.className = 'bx bx-show';
    } else {
        passwordInput.type = 'password';
        icon.className = 'bx bx-lock-alt';
    }
}

// Add click event to password icons for visibility toggle
document.querySelectorAll('.input-group i.bx-lock-alt').forEach(icon => {
    icon.addEventListener('click', function() {
        const inputId = this.parentElement.querySelector('input').id;
        togglePasswordVisibility(inputId);
    });
    icon.style.cursor = 'pointer';
});

// Initialize form
showStep(1);
        
        // If there are Django errors, show the relevant step
        {% if form.errors %}
            {% if 'username' in form.errors or 'email' in form.errors or 'password1' in form.errors or 'password2' in form.errors %}
                showStep(1);
            {% elif 'full_name' in form.errors or 'student_id' in form.errors or 'age' in form.errors or 'gender' in form.errors %}
                showStep(2);
            {% elif 'college' in form.errors or 'program' in form.errors or 'year_level' in form.errors %}
                showStep(3);
            {% endif %}
        {% endif %}
    </script>
</body>
</html>